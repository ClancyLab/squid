
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Examples &#8212; Squid 2.0.0 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Codebase" href="codebase.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="codebase.html" title="Codebase"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Squid 2.0.0 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="examples">
<h1>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h1>
<p>Here we supply some example uses of the Squid codebase.  These examples can all be found and run
in the git repository.</p>
<div class="section" id="geometry-smoothing-out-a-reaction-coordinate">
<h2>Geometry - Smoothing out a Reaction Coordinate<a class="headerlink" href="#geometry-smoothing-out-a-reaction-coordinate" title="Permalink to this headline">¶</a></h2>
<p>The below code shows how, given a folder of steps in a reaction coordinate, we can smooth out
the full reaction.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># System imports</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="c1"># Squid imports</span>
<span class="kn">from</span> <span class="nn">squid</span> <span class="kn">import</span> <span class="n">files</span>
<span class="kn">from</span> <span class="nn">squid</span> <span class="kn">import</span> <span class="n">geometry</span>

<span class="c1"># First we want to read in the manually made iterations</span>
<span class="n">fptrs</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.xyz&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s2">&quot;reaction_coordinate&quot;</span><span class="p">)]</span>
<span class="n">fptrs</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

<span class="c1"># Now, we loop through all files in numerical order and append to our reaction coordinate</span>
<span class="n">rxn</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fptrs</span><span class="p">:</span>
        <span class="n">rxn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">files</span><span class="o">.</span><span class="n">read_xyz</span><span class="p">(</span><span class="s2">&quot;reaction_coordinate/</span><span class="si">%d</span><span class="s2">.xyz&quot;</span> <span class="o">%</span> <span class="n">f</span><span class="p">))</span>

<span class="c1"># Save an example of this rough reaction we made</span>
<span class="n">files</span><span class="o">.</span><span class="n">write_xyz</span><span class="p">(</span><span class="n">rxn</span><span class="p">,</span> <span class="s2">&quot;reaction_coordinate_rough&quot;</span><span class="p">)</span>

<span class="c1"># Now, we smooth it out.  There are many ways of doing so.  We&#39;ll only show the main two methods here</span>
<span class="c1"># Here we just make a copy of the frames for the second method</span>
<span class="n">held_rough_reaction</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">rxn</span><span class="p">)</span>

<span class="c1"># Method 1 - Procrustes to minimize rotations and translations between consecutive frames</span>
<span class="n">geometry</span><span class="o">.</span><span class="n">procrustes</span><span class="p">(</span><span class="n">rxn</span><span class="p">)</span>
<span class="n">files</span><span class="o">.</span><span class="n">write_xyz</span><span class="p">(</span><span class="n">rxn</span><span class="p">,</span> <span class="s2">&quot;reaction_coordinate_procrustes&quot;</span><span class="p">)</span>

<span class="c1"># Method 2 - Procrustes plus linear interpolation</span>
<span class="c1"># Note, R_MAX is the maximum average change in atomic positions between adjacent frames (in angstroms)</span>
<span class="c1">#       F_MAX is the maximum number of frames we want in the final reaction coordinate</span>
<span class="n">rxn</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">held_rough_reaction</span><span class="p">)</span> <span class="c1"># Grab the previously rough reaction</span>
<span class="n">geometry</span><span class="o">.</span><span class="n">smooth_xyz</span><span class="p">(</span><span class="n">rxn</span><span class="p">,</span> <span class="n">R_MAX</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">F_MAX</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">PROCRUSTES</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">outName</span><span class="o">=</span><span class="s2">&quot;reaction_coordinate_smooth&quot;</span><span class="p">,</span> <span class="n">write_xyz</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>The rough reaction coordinate initially appears smooth, but as we reach the final frame we see that there is clearly
a change in reference frame.  This is due to the fact that when optimizing in DFT we usually get some residual rotations
due to switching between internal coordinates and cartesian coordinates.</p>
<img alt="_images/reaction_coordinate_rough.gif" src="_images/reaction_coordinate_rough.gif" />
<p>However, when using the procrustes method we remove the rigid rotation associated with this change of coordinate system.</p>
<img alt="_images/reaction_coordinate_procrustes.gif" src="_images/reaction_coordinate_procrustes.gif" />
<p>Finally, with the added linear interpolations we end up with a smooth reaction coordinate.</p>
<img alt="_images/reaction_coordinate_smooth.gif" src="_images/reaction_coordinate_smooth.gif" />
</div>
<div class="section" id="dft-geometry-optimization-of-acetic-acid">
<h2>DFT - Geometry Optimization of Acetic Acid<a class="headerlink" href="#dft-geometry-optimization-of-acetic-acid" title="Permalink to this headline">¶</a></h2>
<p>The below code shows how to use Orca to optimize the geometry of an acetic
acid dimer.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">squid</span> <span class="kn">import</span> <span class="n">orca</span>
<span class="kn">from</span> <span class="nn">squid</span> <span class="kn">import</span> <span class="n">files</span>

<span class="c1"># Read in the xyz file</span>
<span class="n">frames</span> <span class="o">=</span> <span class="n">files</span><span class="o">.</span><span class="n">read_xyz</span><span class="p">(</span><span class="s2">&quot;acetic_acid_dimer.xyz&quot;</span><span class="p">)</span>
<span class="c1"># Run a simulation locally using the Hartree Fock method (with 3 corrections)</span>
<span class="n">orca</span><span class="o">.</span><span class="n">job</span><span class="p">(</span><span class="s2">&quot;aa_dimer_local&quot;</span><span class="p">,</span><span class="s2">&quot;! HF-3c Opt&quot;</span><span class="p">,</span><span class="n">atoms</span><span class="o">=</span><span class="n">frames</span><span class="p">,</span><span class="n">queue</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="dft-molecular-orbitals-post-processing">
<h2>DFT - Molecular Orbitals Post Processing<a class="headerlink" href="#dft-molecular-orbitals-post-processing" title="Permalink to this headline">¶</a></h2>
<p>The below code shows how to use g09 and vmd to generate and display molecular orbitals
of a DFT simulation.  Note, this uses g09’s cubegen and formchk code.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">squid</span> <span class="kn">import</span> <span class="n">g09</span>
<span class="kn">from</span> <span class="nn">squid</span> <span class="kn">import</span> <span class="n">files</span>


<span class="c1"># Run water simulation</span>
<span class="k">def</span> <span class="nf">opt_water</span><span class="p">():</span>
        <span class="n">frames</span> <span class="o">=</span> <span class="n">files</span><span class="o">.</span><span class="n">read_xyz</span><span class="p">(</span><span class="s1">&#39;water.xyz&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">g09</span><span class="o">.</span><span class="n">job</span><span class="p">(</span><span class="s1">&#39;water&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;HSEH1PBE/cc-pVTZ OPT=() SCRF(Solvent=Toluene)&#39;</span><span class="p">,</span>
                                   <span class="n">atoms</span><span class="o">=</span><span class="n">frames</span><span class="p">,</span>
                                   <span class="n">queue</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                                   <span class="n">force</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>


<span class="n">job</span> <span class="o">=</span> <span class="n">opt_water</span><span class="p">()</span>
<span class="n">job</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
<span class="n">g09</span><span class="o">.</span><span class="n">cubegen_analysis</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">,</span> <span class="n">orbital</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>This will optimize the geometry of a water molecule and then automatically generate a VMD
session with various representations.  In the console output it’ll show the following in
blue:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Representations are as follows:

        1 - CPK of atoms
        2 - LUMO Positive
        3 - HOMO Positive
        4 - LUMO Negative
        5 - HOMO Negative
        6 - Potential Surface
        7 - MO 3
</pre></div>
</div>
<p>Choosing only displays 1, 3, and 5 we can see the HOMO level of water as follows (positive
being blue and negative being red):</p>
<img alt="_images/water_HOMO.gif" src="_images/water_HOMO.gif" />
<p>Recent updates now allow this for orca as well.  NOTE! By default Orca does not take
into account degenerate energy states when populating.  To do so, ensure the following is
in your extra_section before trying the visualization:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>%scf FracOcc true end
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">squid</span> <span class="kn">import</span> <span class="n">orca</span>
<span class="kn">from</span> <span class="nn">squid</span> <span class="kn">import</span> <span class="n">structures</span>

<span class="n">ROUTE_OPT</span> <span class="o">=</span> <span class="s1">&#39;! B97-D3 def2-TZVP OPT&#39;</span>
<span class="n">EXTRA_SECTION</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

<span class="n">frames</span> <span class="o">=</span> <span class="p">[</span><span class="n">structures</span><span class="o">.</span><span class="n">Atom</span><span class="p">(</span><span class="s2">&quot;O&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.730404</span><span class="p">,</span> <span class="mf">2.443498</span><span class="p">,</span> <span class="mf">0.004930</span><span class="p">),</span>
          <span class="n">structures</span><span class="o">.</span><span class="n">Atom</span><span class="p">(</span><span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="mf">0.227213</span><span class="p">,</span> <span class="mf">2.402054</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.008942</span><span class="p">),</span>
          <span class="n">structures</span><span class="o">.</span><span class="n">Atom</span><span class="p">(</span><span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.008399</span><span class="p">,</span> <span class="mf">1.573518</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.286267</span><span class="p">)]</span>

<span class="n">j</span> <span class="o">=</span> <span class="n">orca</span><span class="o">.</span><span class="n">job</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">,</span> <span class="n">ROUTE_OPT</span><span class="p">,</span>
             <span class="n">atoms</span><span class="o">=</span><span class="n">frames</span><span class="p">,</span>
             <span class="n">extra_section</span><span class="o">=</span><span class="n">EXTRA_SECTION</span><span class="p">,</span>
             <span class="n">queue</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">procs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mem</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>

<span class="n">j</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

<span class="n">orca</span><span class="o">.</span><span class="n">mo_analysis</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">,</span>
                 <span class="n">orbital</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
                 <span class="n">HOMO</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">LUMO</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">wireframe</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="dft-electrostatic-potential-mapped-on-electron-density-post-processing">
<h2>DFT - Electrostatic Potential Mapped on Electron Density Post Processing<a class="headerlink" href="#dft-electrostatic-potential-mapped-on-electron-density-post-processing" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">squid</span> <span class="kn">import</span> <span class="n">orca</span>
<span class="kn">from</span> <span class="nn">squid</span> <span class="kn">import</span> <span class="n">structures</span>

<span class="n">ROUTE_OPT</span> <span class="o">=</span> <span class="s1">&#39;! B97-D3 def2-TZVP OPT&#39;</span>
<span class="n">EXTRA_SECTION</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

<span class="n">frames</span> <span class="o">=</span> <span class="p">[</span><span class="n">structures</span><span class="o">.</span><span class="n">Atom</span><span class="p">(</span><span class="s2">&quot;O&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.730404</span><span class="p">,</span> <span class="mf">2.443498</span><span class="p">,</span> <span class="mf">0.004930</span><span class="p">),</span>
          <span class="n">structures</span><span class="o">.</span><span class="n">Atom</span><span class="p">(</span><span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="mf">0.227213</span><span class="p">,</span> <span class="mf">2.402054</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.008942</span><span class="p">),</span>
          <span class="n">structures</span><span class="o">.</span><span class="n">Atom</span><span class="p">(</span><span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.008399</span><span class="p">,</span> <span class="mf">1.573518</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.286267</span><span class="p">)]</span>

<span class="n">j</span> <span class="o">=</span> <span class="n">orca</span><span class="o">.</span><span class="n">job</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">,</span> <span class="n">ROUTE_OPT</span><span class="p">,</span>
             <span class="n">atoms</span><span class="o">=</span><span class="n">frames</span><span class="p">,</span>
             <span class="n">extra_section</span><span class="o">=</span><span class="n">EXTRA_SECTION</span><span class="p">,</span>
             <span class="n">queue</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">procs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mem</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>

<span class="n">j</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

<span class="n">orca</span><span class="o">.</span><span class="n">pot_analysis</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">,</span> <span class="n">wireframe</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">npoints</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/water.png" src="_images/water.png" />
</div>
<div class="section" id="dft-nudged-elastic-band-of-cnh-isomerization">
<h2>DFT - Nudged Elastic Band of CNH Isomerization<a class="headerlink" href="#dft-nudged-elastic-band-of-cnh-isomerization" title="Permalink to this headline">¶</a></h2>
<p>The below code shows how to use the Nudged Elastic Band method (NEB) to optimize for the
minimum energy pathway.  Note, this is a rough example, and in reality one would make sure
to optimize both endpoints of <em>frames</em> at the same level of theory and then to proceed
with the NEB simulation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">squid</span> <span class="kn">import</span> <span class="n">neb</span>
<span class="kn">from</span> <span class="nn">squid</span> <span class="kn">import</span> <span class="n">files</span>

<span class="n">frames</span> <span class="o">=</span> <span class="n">files</span><span class="o">.</span><span class="n">read_xyz</span><span class="p">(</span><span class="s2">&quot;CNH_HCN.xyz&quot;</span><span class="p">)</span>
<span class="n">new_opt_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;step_size&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
                                  <span class="s1">&#39;step_size_adjustment&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
                                  <span class="s1">&#39;max_step&#39;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>
                                  <span class="s1">&#39;linesearch&#39;</span><span class="p">:</span> <span class="s1">&#39;backtrack&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;accelerate&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                                  <span class="s1">&#39;reset_step_size&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">neb</span><span class="o">.</span><span class="n">NEB</span><span class="p">(</span><span class="s2">&quot;neb_test&quot;</span><span class="p">,</span>
                                        <span class="n">frames</span><span class="p">,</span>
                                        <span class="s2">&quot;! HF-3c&quot;</span><span class="p">,</span>
                                        <span class="n">opt</span><span class="o">=</span><span class="s2">&quot;LBFGS&quot;</span><span class="p">,</span>
                                        <span class="n">new_opt_params</span><span class="o">=</span><span class="n">new_opt_params</span><span class="p">)</span>
<span class="n">optimizer</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>
</pre></div>
</div>
<p>Example output is as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>------------------------------------------------------------------------------------------
Run_Name = neb_test
DFT Package = orca
Spring Constant for NEB: 0.1837 Ha/Ang = 4.99928 eV/Ang

Running neb with optimization method LBFGS
        step_size = 0.1
        step_size_adjustment = 0.5
        Linesearch method used is backtrack
        Will reset stored parameters and gradients when stepped bad.
        Will reset step_size after 5 good steps.
        Will accelerate step_size after 5 good steps.
        Will use procrustes to remove rigid rotations and translations
Convergence Criteria:
        g_rms = 0.001 (Ha/Ang) = 0.0272144 (eV/Ang)
        g_max = 0.001 (Ha/Ang) = 0.0272144 (eV/Ang)
        maxiter = 1000
---------------------------------------------
Step    RMS_F (eV/Ang)  MAX_F (eV/Ang)  MAX_E (kT_300)  MAX Translational Force (eV/Ang)        Energies (kT_300)
----
0       53.2607         95.8912         733.9           0.0000                                  -92.232 +  13.1 273.4 269.5 695.5 733.9 693.2 610.5 384.1 262.4 -17.0 -24.2
1       13.2722         31.0298         192.3           0.0000                                  -92.232 +   9.0 153.6  67.9 184.2 192.3 177.8 167.8 158.1  93.5 -19.4 -24.2
2       5.6462          9.9857          159.4           0.0000                                  -92.232 +   7.6  50.0  60.8 147.6 159.4 145.9 114.6  68.2  27.7 -19.4 -24.2
3       3.4829          6.7076          140.3           0.0000                                  -92.232 +   5.7  37.6  59.4 129.9 140.3 129.7 105.3  62.9  12.6 -20.0 -24.2
4       2.4373          5.1388          128.9           0.0000                                  -92.232 +   4.8  36.1  59.2 119.6 128.9 121.9 102.3  61.3   8.9 -20.6 -24.2
5       1.7959          4.0514          122.2           0.0000                                  -92.232 +   4.4  35.7  59.4 113.6 122.2 118.6 101.2  60.8   7.6 -20.9 -24.2
6       1.3715          3.2678          118.4           0.0000                                  -92.232 +   4.3  35.5  59.7 110.0 118.4 117.0 100.7  60.6   7.2 -21.1 -24.2
7       0.8475          2.0949          115.5           0.0000                                  -92.232 +   4.4  35.5  60.5 106.0 114.3 115.5 100.3  60.4   7.0 -21.1 -24.2
8       0.6027          1.3783          115.0           0.0000                                  -92.232 +   4.6  35.2  61.1 104.2 113.0 115.0  99.9  60.0   7.1 -21.0 -24.2
9       0.4495          0.9335          114.8           0.0000                                  -92.232 +   4.9  34.5  61.7 103.1 112.5 114.8  99.6  59.2   7.3 -20.8 -24.2
10      0.3571          0.799           114.7           0.0000                                  -92.232 +   5.2  34.0  62.1 102.1 112.3 114.7  99.3  58.6   7.5 -20.5 -24.2
11      0.2806          0.6794          114.7           0.0000                                  -92.232 +   5.5  33.7  62.4 101.3 112.4 114.7  99.0  58.0   7.8 -20.3 -24.2
12      0.2343          0.5628          114.6           0.0000                                  -92.232 +   5.8  33.5  62.7 100.5 112.4 114.6  98.7  57.6   8.0 -20.0 -24.2
13      0.1914          0.3947          114.6           0.0000                                  -92.232 +   6.3  33.0  63.2  98.9 112.7 114.6  98.0  57.0   8.4 -19.5 -24.2
14      0.1686          0.3585          114.6           0.0000                                  -92.232 +   6.8  32.7  63.5  97.7 112.8 114.6  97.4  56.5   9.1 -19.1 -24.2
15      0.1405          0.2894          114.6           0.0000                                  -92.232 +   7.3  32.5  63.6  96.6 112.9 114.6  96.8  56.1   9.9 -18.6 -24.2
16      0.1261          0.2586          114.6           0.0000                                  -92.232 +   7.7  32.4  63.7  95.8 112.9 114.6  96.3  55.8  10.5 -18.2 -24.2
17      0.1447          0.4157          114.6           0.0000                                  -92.232 +   7.9  32.4  64.0  95.0 113.0 114.6  95.8  55.5  10.8 -17.7 -24.2
18      0.1113          0.2416          114.6           0.0000                                  -92.232 +   7.8  32.4  63.6  95.4 112.9 114.6  96.1  55.7  10.6 -18.0 -24.2
19      0.1099          0.2155          114.5           0.0000                                  -92.232 +   7.9  32.4  63.5  95.1 112.9 114.5  95.9  55.5  10.8 -17.8 -24.2
20      0.1017          0.1878          114.5           0.0000                                  -92.232 +   8.0  32.4  63.3  94.8 112.9 114.5  95.6  55.4  11.0 -17.6 -24.2
21      0.0941          0.1725          114.4           0.0000                                  -92.232 +   8.1  32.4  63.1  94.5 112.8 114.4  95.4  55.3  11.1 -17.5 -24.2
22      0.0882          0.1662          114.4           0.0000                                  -92.232 +   8.2  32.5  62.9  94.2 112.8 114.4  95.2  55.2  11.3 -17.3 -24.2
23      0.0833          0.1592          114.3           0.0000                                  -92.232 +   8.3  32.5  62.8  93.9 112.8 114.3  95.0  55.1  11.4 -17.2 -24.2
24      0.0753          0.1452          114.3           0.0000                                  -92.232 +   8.4  32.5  62.6  93.4 112.7 114.3  94.7  54.9  11.7 -16.9 -24.2
25      0.0693          0.1317          114.2           0.0000                                  -92.232 +   8.6  32.5  62.4  92.9 112.6 114.2  94.3  54.7  12.0 -16.6 -24.2
26      0.0641          0.1202          114.1           0.0000                                  -92.232 +   8.7  32.5  62.2  92.5 112.6 114.1  94.0  54.5  12.2 -16.4 -24.2
27      0.0593          0.1102          114.1           0.0000                                  -92.232 +   8.8  32.5  62.0  92.1 112.5 114.1  93.7  54.4  12.4 -16.2 -24.2
28      0.055           0.1016          114.0           0.0000                                  -92.232 +   8.9  32.6  61.8  91.7 112.4 114.0  93.4  54.2  12.6 -16.0 -24.2
29      0.051           0.094           114.0           0.0000                                  -92.232 +   9.0  32.6  61.6  91.3 112.4 114.0  93.1  54.1  12.8 -15.8 -24.2
30      0.044           0.0809          113.9           0.0000                                  -92.232 +   9.2  32.6  61.3  90.7 112.2 113.9  92.6  53.9  13.2 -15.4 -24.2
31      0.0382          0.0711          113.8           0.0000                                  -92.232 +   9.3  32.6  60.9  90.2 112.1 113.8  92.2  53.7  13.5 -15.1 -24.2
32      0.0334          0.0633          113.8           0.0000                                  -92.232 +   9.4  32.6  60.6  89.7 112.0 113.8  91.9  53.5  13.7 -14.9 -24.2
33      0.0298          0.0565          113.7           0.0000                                  -92.232 +   9.5  32.7  60.3  89.2 111.9 113.7  91.6  53.4  13.9 -14.7 -24.2
34      0.0271          0.0509          113.7           0.0000                                  -92.232 +   9.5  32.8  60.0  88.8 111.8 113.7  91.3  53.2  14.1 -14.5 -24.2

NEB converged the RMS force.
------------------------------------------------------------------------------------------
</pre></div>
</div>
<p>With the following graph made using:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>scanDFT neb_test-^-%d 1 10 -neb neb_test-0-0,neb_test-0-11 -c ^,0,34 -t &quot;NEB of CNH Isomerization&quot; -lx &quot;Reaction Coordinate&quot; -ly &quot;Energy (kT_300)&quot; -u kT_300
</pre></div>
</div>
<img alt="_images/zoomed_plot_scaled.png" src="_images/zoomed_plot_scaled.png" />
</div>
<div class="section" id="md-equilibration-of-solvent-box">
<h2>MD - Equilibration of Solvent Box<a class="headerlink" href="#md-equilibration-of-solvent-box" title="Permalink to this headline">¶</a></h2>
<p>Below is a method of using squid to (1) read in a solvent molecule, (2) utilize the packmol hook to pack a box, and (3)
equilibrate the system via NPT and NVT calculations.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">squid</span> <span class="kn">import</span> <span class="n">units</span>
<span class="kn">from</span> <span class="nn">squid</span> <span class="kn">import</span> <span class="n">structures</span>
<span class="kn">from</span> <span class="nn">squid</span> <span class="kn">import</span> <span class="n">lammps_job</span>

<span class="c1"># Generate the system object to hold our solvent</span>
<span class="n">solvent_box</span> <span class="o">=</span> <span class="n">structures</span><span class="o">.</span><span class="n">System</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;solv_box&quot;</span><span class="p">,</span> <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="mf">15.0</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">),</span> <span class="n">box_angles</span><span class="o">=</span><span class="p">(</span><span class="mf">90.0</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">),</span> <span class="n">periodic</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># Read in our molecule</span>
<span class="c1"># Note, we specified our forcefield indices in the cml file</span>
<span class="n">acetone</span> <span class="o">=</span> <span class="n">structures</span><span class="o">.</span><span class="n">Molecule</span><span class="p">(</span><span class="s2">&quot;acetone.cml&quot;</span><span class="p">)</span>

<span class="c1"># Using packmol, pack this box with acetic acids</span>
<span class="n">solvent_box</span><span class="o">.</span><span class="n">packmol</span><span class="p">([</span><span class="n">acetone</span><span class="p">],</span> <span class="n">density</span><span class="o">=</span><span class="mf">0.791</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">21321</span><span class="p">)</span>

<span class="c1"># Now we can run an NPT simulation using lammps</span>
<span class="c1">## Get a list of elements for dump_modify.  By default we organize types by heaviest to lightest, so do so here.</span>
<span class="n">atom_types</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">elems</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">molec</span> <span class="ow">in</span> <span class="n">solvent_box</span><span class="o">.</span><span class="n">molecules</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">molec</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">element_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">atom_types</span><span class="p">:</span>
                        <span class="n">atom_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">element_name</span><span class="p">)</span>
                        <span class="n">elems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">element</span><span class="p">)</span>
<span class="n">elem_mass</span> <span class="o">=</span> <span class="p">[</span><span class="n">units</span><span class="o">.</span><span class="n">elem_weight</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">elems</span><span class="p">]</span>
<span class="n">elem_str</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">elem_mass</span><span class="p">,</span><span class="n">elems</span><span class="p">))][::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

<span class="n">input_script</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;units real</span>
<span class="s2">atom_style full</span>
<span class="s2">pair_style lj/cut/coul/cut 10.0</span>
<span class="s2">bond_style harmonic</span>
<span class="s2">angle_style harmonic</span>
<span class="s2">dihedral_style opls</span>

<span class="s2">boundary p p p</span>
<span class="s2">read_data solv_box.data</span>

<span class="s2">dump 1 all xyz 100 solv_box.xyz</span>
<span class="s2">dump_modify 1 element &quot;&quot;&quot;</span><span class="o">+</span><span class="n">elem_str</span><span class="o">+</span><span class="s2">&quot;&quot;&quot;</span>

<span class="s2">thermo_style custom ke pe temp press</span>
<span class="s2">thermo 100</span>

<span class="s2">minimize 1.0e-4 1.0e-6 1000 10000</span>

<span class="s2">velocity all create 300.0 23123 rot yes dist gaussian</span>
<span class="s2">timestep 1.0</span>

<span class="s2">fix motion_npt all npt temp 300.0 300.0 100.0 iso 0.0 0.0 1000.0</span>
<span class="s2">run 10000</span>
<span class="s2">unfix motion_npt</span>

<span class="s2">fix motion_nvt all nvt temp 300.0 300.0 300.0</span>
<span class="s2">run 10000</span>
<span class="s2">unfix motion_nvt</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">lammps_job</span><span class="o">.</span><span class="n">job</span><span class="p">(</span><span class="s2">&quot;solv_box&quot;</span><span class="p">,</span> <span class="n">input_script</span><span class="p">,</span> <span class="n">solvent_box</span><span class="p">,</span> <span class="n">queue</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">hybrid_angle</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Plotting the pressure and temperature we can verify equilibration (note, this is a rough demo
so there is still a lot of noise).</p>
<img alt="_images/press.png" src="_images/press.png" />
<img alt="_images/temp.png" src="_images/temp.png" />
</div>
<div class="section" id="optimizers">
<h2>Optimizers<a class="headerlink" href="#optimizers" title="Permalink to this headline">¶</a></h2>
<p>Using the built in optimizers, you’re able to extend them to mathematical problems.  Take,
for example, the following equation:</p>
<p><img class="math" src="_images/math/1f34b54c0f772438ec3a32e3cefd97a2418a0c60.png" alt="y = 2x^2+x^5-ln(x)"/></p>
<p><img class="math" src="_images/math/08858ee0ef5b359c7375e87cbb6066bb2ce96a72.png" alt="\frac{\partial y}{\partial x} = 4x+5x^4-\frac{1}{4}"/></p>
<p>Using the following, you are able to determine the value of x that would minimize y.  Note,
currently <code class="xref py py-func docutils literal notranslate"><span class="pre">quick_min()</span></code> does not work in this regard.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">squid.optimizers.bfgs</span> <span class="kn">import</span> <span class="n">bfgs</span>
<span class="c1"># from lbfgs import lbfgs</span>
<span class="c1"># from steepest_descent import steepest_descent</span>
<span class="c1"># from fire import fire</span>


<span class="k">def</span> <span class="nf">grad</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
        <span class="c1"># Function is y = 2x^2 + x^5 - ln(x)</span>
        <span class="c1"># Derivative is y = 4x + 5x^4 - 1/x</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">x</span><span class="p">)])</span>


<span class="k">def</span> <span class="nf">grad2</span><span class="p">(</span><span class="n">params2</span><span class="p">):</span>
        <span class="c1"># Function is z = (x-3)^2 + (y+2)^2 + x*y</span>
        <span class="c1"># Derivative is:</span>
        <span class="c1">#     dz/dx = 2(x-3) + y</span>
        <span class="c1">#     dz/dy = 2(y+2) + x</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">params2</span>
        <span class="n">a</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">+</span> <span class="n">y</span>
        <span class="n">b</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">+</span> <span class="n">x</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">])</span>


<span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="mf">3.0</span><span class="p">]</span>
<span class="n">params2</span> <span class="o">=</span> <span class="p">[</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">]</span>

<span class="k">print</span> <span class="n">bfgs</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">grad</span><span class="p">,</span> <span class="n">new_opt_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dimensions&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="c1"># print lbfgs(params, grad, new_opt_params={&#39;dimensions&#39;: 1})</span>
<span class="c1"># print steepest_descent(params, grad, new_opt_params={&#39;dimensions&#39;: 1})</span>
<span class="c1"># print fire(params, grad)</span>

<span class="k">print</span> <span class="n">bfgs</span><span class="p">(</span><span class="n">params2</span><span class="p">,</span> <span class="n">grad2</span><span class="p">,</span> <span class="n">new_opt_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dimensions&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span>
</pre></div>
</div>
<p>Due to the implementation of the optimizers, you must specify the dimensionality
of your problem.  A second example has been included in the above code for a
two dimensional problem.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="squid.html">Squid</a></li>
<li class="toctree-l1"><a class="reference internal" href="codebase.html">Codebase</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#geometry-smoothing-out-a-reaction-coordinate">Geometry - Smoothing out a Reaction Coordinate</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dft-geometry-optimization-of-acetic-acid">DFT - Geometry Optimization of Acetic Acid</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dft-molecular-orbitals-post-processing">DFT - Molecular Orbitals Post Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dft-electrostatic-potential-mapped-on-electron-density-post-processing">DFT - Electrostatic Potential Mapped on Electron Density Post Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dft-nudged-elastic-band-of-cnh-isomerization">DFT - Nudged Elastic Band of CNH Isomerization</a></li>
<li class="toctree-l2"><a class="reference internal" href="#md-equilibration-of-solvent-box">MD - Equilibration of Solvent Box</a></li>
<li class="toctree-l2"><a class="reference internal" href="#optimizers">Optimizers</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="codebase.html"
                        title="previous chapter">Codebase</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/examples.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="codebase.html" title="Codebase"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Squid 2.0.0 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Henry Herbol.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
  </body>
</html>