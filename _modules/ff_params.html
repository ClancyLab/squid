
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>ff_params &#8212; Squid 0.0.1 documentation</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Squid 0.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for ff_params</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The Parameters class contains: </span>

<span class="sd">- :class:`Parameters`</span>

<span class="sd">------------</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">sysconst</span>
<span class="kn">from</span> <span class="nn">forcefields.lj</span> <span class="k">import</span> <span class="n">LJ</span>
<span class="kn">from</span> <span class="nn">forcefields.morse</span> <span class="k">import</span> <span class="n">Morse</span>
<span class="kn">from</span> <span class="nn">forcefields.coulomb</span> <span class="k">import</span> <span class="n">Coul</span>
<span class="kn">from</span> <span class="nn">forcefields.tersoff</span> <span class="k">import</span> <span class="n">Tersoff</span><span class="p">,</span> <span class="n">verify_tersoff_2body_symmetry</span><span class="p">,</span> <span class="n">sorted_force_2body_symmetry</span><span class="p">,</span> <span class="n">tag_tersoff_for_duplicate_2bodies</span>
<span class="kn">from</span> <span class="nn">forcefields.connectors</span> <span class="k">import</span> <span class="n">Bond</span><span class="p">,</span> <span class="n">Angle</span><span class="p">,</span> <span class="n">Dihedral</span>
<span class="kn">from</span> <span class="nn">forcefields.smooth_sin</span> <span class="k">import</span> <span class="n">SmoothSin</span>
<span class="kn">import</span> <span class="nn">forcefields.helper</span> <span class="k">as</span> <span class="nn">ffh</span>

<span class="n">SUPPORTED_STYLES</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;lj/cut/coul/cut&quot;</span><span class="p">,</span> <span class="s2">&quot;morse&quot;</span><span class="p">,</span> <span class="s2">&quot;tersoff&quot;</span><span class="p">,</span> <span class="s2">&quot;opls&quot;</span><span class="p">,</span> <span class="s2">&quot;smooth&quot;</span><span class="p">]</span>
<span class="n">SMRFF_DICT</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;lj&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;sigma&quot;</span><span class="p">,</span> <span class="s2">&quot;epsilon&quot;</span><span class="p">],</span>
    <span class="s2">&quot;coul&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;charge&quot;</span><span class="p">],</span>
    <span class="s2">&quot;morse&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;D0&quot;</span><span class="p">,</span> <span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="s2">&quot;r0&quot;</span><span class="p">,</span> <span class="s2">&quot;rc&quot;</span><span class="p">],</span>
    <span class="s2">&quot;tersoff&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="s2">&quot;gamma&quot;</span><span class="p">,</span> <span class="s2">&quot;lambda3&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="s2">&quot;costheta0&quot;</span><span class="p">,</span>
             <span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;beta&quot;</span><span class="p">,</span> <span class="s2">&quot;lambda2&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="s2">&quot;lambda1&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">]</span>
<span class="p">}</span>
<span class="n">OPLS_STRUCTURES</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;BONDS&quot;</span><span class="p">,</span> <span class="s2">&quot;ANGLES&quot;</span><span class="p">,</span> <span class="s2">&quot;DIHEDRALS&quot;</span><span class="p">]</span>


<div class="viewcode-block" id="Parameters"><a class="viewcode-back" href="../codebase.html#ff_params.Parameters">[docs]</a><span class="k">class</span> <span class="nc">Parameters</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Parameters object that holds all parameters pointed out by fptr.</span>

<span class="sd">    **Parameters**</span>

<span class="sd">        fptr: *list, tuple, str, str, optional*</span>
<span class="sd">            A list of tuples, holding two strings: the force field type</span>
<span class="sd">            (either OPLS or SMRFF right now), and the path to the</span>
<span class="sd">            parameter file.  If no path is specified, we will try to grab</span>
<span class="sd">            the one assigned in sysconst.</span>
<span class="sd">        restrict: *list, str, optional*</span>
<span class="sd">            A list of strings specifying which types are to be used.</span>
<span class="sd">            Note, you must have unique types, lest they be overwritten.</span>

<span class="sd">    **Returns**</span>

<span class="sd">        params: :class:`Parameters`</span>
<span class="sd">            This object.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fptr</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;OPLS&quot;</span><span class="p">,</span> <span class="n">sysconst</span><span class="o">.</span><span class="n">opls_path</span><span class="p">)],</span> <span class="n">restrict</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Initialize empty data</span>
        <span class="c1">#####################################</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coul_params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">morse_params</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bond_params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angle_params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_params</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SR_SMOOTHS</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LR_SMOOTHS</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">#####################################</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lj_mask</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coul_mask</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tersoff_mask</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">morse_mask</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bond_mask</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angle_mask</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_mask</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">smooth_mask</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#####################################</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sr_cut</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lr_cut</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smrff_types</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opls_types</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">system_name</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Force restrict to be that of strings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">restrict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">restrict</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opls_structure_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write_tfile</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Load in all the parameters</span>
        <span class="k">if</span> <span class="n">fptr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ff</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">fptr</span><span class="p">:</span>
                <span class="n">ff</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                <span class="k">assert</span> <span class="n">ff</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;SMRFF&quot;</span><span class="p">,</span> <span class="s2">&quot;OPLS&quot;</span><span class="p">],</span> <span class="s2">&quot;Error - </span><span class="si">%s</span><span class="s2"> is unsupported.&quot;</span> <span class="o">%</span> <span class="n">ff</span>

                <span class="k">if</span> <span class="n">ff</span> <span class="o">==</span> <span class="s2">&quot;SMRFF&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">load_smrff</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">ff</span> <span class="o">==</span> <span class="s2">&quot;OPLS&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">path</span> <span class="o">=</span> <span class="n">sysconst</span><span class="o">.</span><span class="n">opls_path</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">load_opls</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lj_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lj_mask</span> <span class="ow">or</span> <span class="n">other</span><span class="o">.</span><span class="n">lj_mask</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coul_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coul_mask</span> <span class="ow">or</span> <span class="n">other</span><span class="o">.</span><span class="n">coul_mask</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tersoff_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tersoff_mask</span> <span class="ow">or</span> <span class="n">other</span><span class="o">.</span><span class="n">tersoff_mask</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bond_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bond_mask</span> <span class="ow">or</span> <span class="n">other</span><span class="o">.</span><span class="n">bond_mask</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angle_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle_mask</span> <span class="ow">or</span> <span class="n">other</span><span class="o">.</span><span class="n">angle_mask</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_mask</span> <span class="ow">or</span> <span class="n">other</span><span class="o">.</span><span class="n">dihedral_mask</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smooth_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smooth_mask</span> <span class="ow">or</span> <span class="n">other</span><span class="o">.</span><span class="n">smooth_mask</span>

        <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">sr_cut</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sr_cut</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sr_cut</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">sr_cut</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sr_cut</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sr_cut</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">sr_cut</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">lr_cut</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr_cut</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lr_cut</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">lr_cut</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lr_cut</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lr_cut</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">lr_cut</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">smrff_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">smrff_types</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">smrff_types</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">smrff_types</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">smrff_types</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">smrff_types</span>
        <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">opls_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">opls_types</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">opls_types</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">opls_types</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">opls_types</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">opls_types</span>
 
        <span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span> <span class="o">+=</span> <span class="p">[</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">lj_params</span> <span class="k">if</span> <span class="n">o</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coul_params</span> <span class="o">+=</span> <span class="p">[</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">coul_params</span> <span class="k">if</span> <span class="n">o</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coul_params</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span> <span class="o">+=</span> <span class="p">[</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">tersoff_params</span> <span class="k">if</span> <span class="n">o</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span><span class="p">]</span>
        <span class="n">verify_tersoff_2body_symmetry</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">morse_params</span> <span class="o">+=</span> <span class="p">[</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">morse_params</span> <span class="k">if</span> <span class="n">o</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">morse_params</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bond_params</span> <span class="o">+=</span> <span class="p">[</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">bond_params</span> <span class="k">if</span> <span class="n">o</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bond_params</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angle_params</span> <span class="o">+=</span> <span class="p">[</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">angle_params</span> <span class="k">if</span> <span class="n">o</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle_params</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_params</span> <span class="o">+=</span> <span class="p">[</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">dihedral_params</span> <span class="k">if</span> <span class="n">o</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_params</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SR_SMOOTHS</span> <span class="o">+=</span> <span class="p">[</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">SR_SMOOTHS</span> <span class="k">if</span> <span class="n">o</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">SR_SMOOTHS</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LR_SMOOTHS</span> <span class="o">+=</span> <span class="p">[</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">LR_SMOOTHS</span> <span class="k">if</span> <span class="n">o</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">LR_SMOOTHS</span><span class="p">]</span>

        <span class="c1"># Force restrict to be that of strings</span>
        <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">restrict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">restrict</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">restrict</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">opls_structure_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">opls_structure_dict</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>


    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This prints out a representation of the parameter object, in the format</span>
<span class="sd">        that is output to the smrff parameter file.</span>

<span class="sd">        **Returns**</span>

<span class="sd">            params: *str*</span>
<span class="sd">                A string representation of parameters.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">param_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_param_list</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">opls_structure_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">restrict_structures</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">restrict_structures</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">opls_structure_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">]</span>

        <span class="c1"># Handle smrff list</span>
        <span class="k">if</span> <span class="n">param_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">param_type</span><span class="p">,</span> <span class="n">param_string</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">param_list</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">param_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">param_string</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="k">if</span> <span class="n">param_string</span> <span class="ow">in</span> <span class="n">OPLS_STRUCTURES</span><span class="p">:</span>
                        <span class="n">params</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">param_type</span> <span class="k">if</span> <span class="n">ffh</span><span class="o">.</span><span class="n">check_restriction</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">restrict_structures</span><span class="p">)])</span>
                    <span class="k">else</span><span class="p">:</span>    
                        <span class="n">params</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">param_type</span> <span class="k">if</span> <span class="n">ffh</span><span class="o">.</span><span class="n">check_restriction</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">)])</span>
                    <span class="n">params</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">END&quot;</span>

        <span class="k">return</span> <span class="n">params</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

<div class="viewcode-block" id="Parameters.forcefield"><a class="viewcode-back" href="../codebase.html#ff_params.Parameters.forcefield">[docs]</a>    <span class="k">def</span> <span class="nf">forcefield</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">short_range</span><span class="p">,</span> <span class="n">sr_cut</span><span class="p">,</span> <span class="n">sr_smooth</span><span class="p">,</span> <span class="n">long_range</span><span class="p">,</span> <span class="n">lr_cut</span><span class="p">,</span> <span class="n">lr_smooth</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This will assign masks appropriately for the input forcefield.  It</span>
<span class="sd">        will also assign any necessary parameters for the desired forcefield.</span>

<span class="sd">        NOTE! This is a rudimentary starting point and should be improved on.</span>
<span class="sd">        pair style smrff allows for N transitions, whereas the way this is</span>
<span class="sd">        currently written only allows for short-range to long-range.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            short_range: *str*</span>
<span class="sd">                What potential to use in the short range region.  NOTE! This</span>
<span class="sd">                MUST be different than the long_range potential.</span>
<span class="sd">            sr_cut: *float*</span>
<span class="sd">                The global cutoff for the short_range potential.</span>
<span class="sd">            sr_smooth: *str*</span>
<span class="sd">                What type of smoothing function to assign the short_range</span>
<span class="sd">                potential (NULL, ters_r, ters_l, sin_r, sin_l, sin_inout).</span>
<span class="sd">            long_range: *str*</span>
<span class="sd">                What potential to use in the long range region.  NOTE! This</span>
<span class="sd">                MUST be different than the short_range potential.</span>
<span class="sd">            lr_cut: *float*</span>
<span class="sd">                The global cutoff for the long_range potential.</span>
<span class="sd">            lr_smooth: *str*</span>
<span class="sd">                What type of smoothing function to assign the long_range</span>
<span class="sd">                potential (NULL, ters_r, ters_l, sin_r, sin_l, sin_inout).</span>

<span class="sd">        **Returns**</span>

<span class="sd">            None</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># Ensure styles are supported</span>
        <span class="k">assert</span> <span class="n">short_range</span> <span class="ow">in</span> <span class="n">SUPPORTED_STYLES</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> not supported!&quot;</span> <span class="o">%</span> <span class="n">short_range</span>
        <span class="k">assert</span> <span class="n">long_range</span> <span class="ow">in</span> <span class="n">SUPPORTED_STYLES</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> not supported!&quot;</span> <span class="o">%</span> <span class="n">long_range</span>
        <span class="c1"># Ensure we are not transitioning to/from OPLS (not possible)</span>
        <span class="k">assert</span> <span class="n">short_range</span> <span class="o">!=</span> <span class="s2">&quot;OPLS&quot;</span><span class="p">,</span> <span class="s2">&quot;OPLS not supported as short/long range&quot;</span>
        <span class="k">assert</span> <span class="n">long_range</span> <span class="o">!=</span> <span class="s2">&quot;OPLS&quot;</span><span class="p">,</span> <span class="s2">&quot;OPLS not supported as short/long range&quot;</span>

        <span class="c1"># Set masks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_mask</span><span class="p">(</span><span class="s2">&quot;smooth&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_mask</span><span class="p">(</span><span class="n">short_range</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_mask</span><span class="p">(</span><span class="n">long_range</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">short_range</span> <span class="o">=</span> <span class="n">short_range</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">long_range</span> <span class="o">=</span> <span class="n">long_range</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sr_smooth</span> <span class="o">=</span> <span class="n">sr_smooth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lr_smooth</span> <span class="o">=</span> <span class="n">lr_smooth</span>

        <span class="c1"># Set cutoffs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sr_cut</span> <span class="o">=</span> <span class="n">sr_cut</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lr_cut</span> <span class="o">=</span> <span class="n">lr_cut</span></div>

<div class="viewcode-block" id="Parameters.generate"><a class="viewcode-back" href="../codebase.html#ff_params.Parameters.generate">[docs]</a>    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elems</span><span class="p">,</span> <span class="n">signs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">couple_smooths</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="s2">&quot;original&quot;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        For every mask that is true, we will generate random data.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            elems: *list, str*</span>
<span class="sd">                A list of the elements, matching 1-to-1 with the given smrff_types.</span>

<span class="sd">            signs: *list, float*</span>
<span class="sd">                A list of charge signs, matching 1-to-1 with the given smrff_types.</span>

<span class="sd">            couple_smooths: *bool, optional*</span>
<span class="sd">                Whether to couple together like smooths.  If true, when you have a</span>
<span class="sd">                situation in which, say, sin_l and sin_r match up, then this will</span>
<span class="sd">                ensure that these two overlap perfectly.</span>

<span class="sd">            form: *str*</span>
<span class="sd">                Whether to use the original form (m=3, gamma=1) or the</span>
<span class="sd">                Albe et al form (m=1, beta=1) for tersoff parameters.</span>
<span class="sd">                Must be original or albe.</span>

<span class="sd">        **Returns**</span>

<span class="sd">            None</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">smrff_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Error - you must define smrff_types first!&quot;</span>
        <span class="c1"># assert self.opls_types is not None, &quot;Error - you must define opls_types first!&quot;</span>

        <span class="c1"># Generate our smooth functions</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">smooth_mask</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sr_smooth</span> <span class="o">==</span> <span class="s2">&quot;NULL&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">sr_smooth</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;ters&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">SR_SMOOTHS</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">sr_smooth</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;sin&quot;</span><span class="p">):</span>
                <span class="n">couple_smooths</span> <span class="o">=</span> <span class="n">couple_smooths</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr_smooth</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;sin&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">SR_SMOOTHS</span> <span class="o">=</span> <span class="n">SmoothSin</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">smrff_types</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sr_smooth</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sr_cut</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">coupled</span><span class="o">=</span><span class="n">couple_smooths</span><span class="p">,</span>
                    <span class="n">coupled_lr_smooth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lr_smooth</span><span class="p">,</span> <span class="n">coupled_lr_cut</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lr_cut</span><span class="p">,</span>
                    <span class="n">coupled_smooth_index</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr_smooth</span> <span class="o">==</span> <span class="s2">&quot;NULL&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr_smooth</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;ters&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">LR_SMOOTHS</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr_smooth</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;sin&quot;</span><span class="p">):</span>
                <span class="c1"># If already coupled, we don&#39;t need LR_SMOOTHS</span>
                <span class="k">if</span> <span class="n">couple_smooths</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">LR_SMOOTHS</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">LR_SMOOTHS</span> <span class="o">=</span> <span class="n">SmoothSin</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">smrff_types</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr_smooth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr_cut</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lj_mask</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span> <span class="o">=</span> <span class="n">LJ</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smrff_types</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coul_mask</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">signs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Error - you need to specify signs for coulomb.&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coul_params</span> <span class="o">=</span> <span class="n">Coul</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smrff_types</span><span class="p">,</span> <span class="n">elems</span><span class="p">,</span> <span class="n">signs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">morse_mask</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">morse_params</span> <span class="o">=</span> <span class="n">Morse</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smrff_types</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tersoff_mask</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span> <span class="o">=</span> <span class="n">Tersoff</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smrff_types</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">)</span>
            <span class="c1">#self.tersoff_params = sorted_force_2body_symmetry(self.tersoff_params)</span>
            <span class="n">sorted_force_2body_symmetry</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span><span class="p">)</span>
            <span class="n">verify_tersoff_2body_symmetry</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span><span class="p">)</span></div>

<span class="c1">#    def opls_atom_2_struct(self):</span>
<span class="c1">#        &#39;&#39;&#39;</span>
<span class="c1">#        Get a dictionary that correlates OPLS atom types to structure types.</span>
<span class="c1">#        Note, this relies on the fact that self.restrict and</span>
<span class="c1">#        self.restrict_structure are assigned appropriately.</span>
<span class="c1">#</span>
<span class="c1">#        **Returns**</span>
<span class="c1">#</span>
<span class="c1">#            atom_2_struct: *dict, str, str*</span>
<span class="c1">#                A dictionary that has keys being OPLS atom types, and values</span>
<span class="c1">#                being OPLS structure types.</span>
<span class="c1">#        &#39;&#39;&#39;</span>
<span class="c1">#        if self.restrict is None:</span>
<span class="c1">#            return None</span>
<span class="c1">#        return {ra: self.restrict_structure_dict[ra] for ra in self.restrict}</span>

<div class="viewcode-block" id="Parameters.set_all_masks"><a class="viewcode-back" href="../codebase.html#ff_params.Parameters.set_all_masks">[docs]</a>    <span class="k">def</span> <span class="nf">set_all_masks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">set_on</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Either turn all masks to being on or off.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            set_on: *bool*</span>
<span class="sd">                What to set all values to (True/False).</span>

<span class="sd">        **Returns**</span>

<span class="sd">            None</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lj_mask</span> <span class="o">=</span> <span class="n">set_on</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coul_mask</span> <span class="o">=</span> <span class="n">set_on</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tersoff_mask</span> <span class="o">=</span> <span class="n">set_on</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">morse_mask</span> <span class="o">=</span> <span class="n">set_on</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bond_mask</span> <span class="o">=</span> <span class="n">set_on</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angle_mask</span> <span class="o">=</span> <span class="n">set_on</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_mask</span> <span class="o">=</span> <span class="n">set_on</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">smooth_mask</span> <span class="o">=</span> <span class="n">set_on</span></div>

<div class="viewcode-block" id="Parameters.set_mask"><a class="viewcode-back" href="../codebase.html#ff_params.Parameters.set_mask">[docs]</a>    <span class="k">def</span> <span class="nf">set_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Given a style, turn on the respective masks.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            mask: *str*</span>
<span class="sd">                The potential for which masks should be turned on (ex. morse)</span>

<span class="sd">        **Returns**</span>

<span class="sd">            None</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">assert</span> <span class="n">mask</span> <span class="ow">in</span> <span class="n">SUPPORTED_STYLES</span><span class="p">,</span> <span class="s2">&quot;Error - style (</span><span class="si">%s</span><span class="s2">) is not recognized!&quot;</span> <span class="o">%</span> <span class="n">mask</span>
        <span class="k">if</span> <span class="n">mask</span> <span class="o">==</span> <span class="s2">&quot;morse&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">morse_mask</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">mask</span> <span class="o">==</span> <span class="s2">&quot;lj/cut/coul/cut&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lj_mask</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coul_mask</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">mask</span> <span class="o">==</span> <span class="s2">&quot;tersoff&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tersoff_mask</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">mask</span> <span class="o">==</span> <span class="s2">&quot;OPLS&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lj_mask</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coul_mask</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bond_mask</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">angle_mask</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_mask</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">mask</span> <span class="o">==</span> <span class="s2">&quot;smooth&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">smooth_mask</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Parameters.set_opls_mask"><a class="viewcode-back" href="../codebase.html#ff_params.Parameters.set_opls_mask">[docs]</a>    <span class="k">def</span> <span class="nf">set_opls_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Turn off ALL masks, but leave OPLS ones on.</span>

<span class="sd">        **Returns**</span>

<span class="sd">            None</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># Turn off all masks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_all_masks</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># Turn on only OPLS ones</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lj_mask</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coul_mask</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bond_mask</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angle_mask</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_mask</span> <span class="o">=</span> <span class="kc">True</span></div>

    <span class="k">def</span> <span class="nf">_get_param_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trim_tersoff_2body</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        A unified function to ensure we always read in parameters in the same order</span>
<span class="sd">        throughout the code.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            trim_tersoff_2body: *bool, optional*</span>
<span class="sd">                Whether to trim the tersoff list to remove the 2-body duplicates.</span>

<span class="sd">        **Returns**</span>

<span class="sd">            params: *list, list, objs*</span>
<span class="sd">                A list of lists, each holding all parameter objects associated with some FF.</span>
<span class="sd">            param_strings: *list, str*</span>
<span class="sd">                A list of the names that the params list correlates to.  For example, if</span>
<span class="sd">                param_strings[0] is &quot;COULOMB&quot;, then params[0] is a list of coulomb objects.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">trim_tersoff_2body</span><span class="p">:</span>
            <span class="c1">#self.tersoff_params = tag_tersoff_for_duplicate_2bodies(self.tersoff_params)</span>
            <span class="n">tag_tersoff_for_duplicate_2bodies</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span><span class="p">)</span>

        <span class="n">param_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;COULOMB&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coul_params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coul_mask</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;LENNARD-JONES&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lj_mask</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;TERSOFF&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tersoff_mask</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;MORSE&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">morse_params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">morse_mask</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;BONDS&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bond_params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bond_mask</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;ANGLES&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle_params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle_mask</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;DIHEDRALS&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_mask</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;SMOOTHS&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SR_SMOOTHS</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">LR_SMOOTHS</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">smooth_mask</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="n">params</span><span class="p">,</span> <span class="n">param_strings</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ps</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">param_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                <span class="n">param_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">params</span><span class="p">,</span> <span class="n">param_strings</span>

<div class="viewcode-block" id="Parameters.load_opls"><a class="viewcode-back" href="../codebase.html#ff_params.Parameters.load_opls">[docs]</a>    <span class="k">def</span> <span class="nf">load_opls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Given an OPLS file name, in the Tinker format, parse it and load it</span>
<span class="sd">        into this parameters object.  Note, you should specify restrict before</span>
<span class="sd">        calling this function or else everything in the file will be loaded.</span>
<span class="sd">        If restrict is specified, then restrict_structure will be</span>
<span class="sd">        automatically generated during this function call.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            fname: *str*</span>
<span class="sd">                The path to the opls file.</span>

<span class="sd">        **Returns**</span>

<span class="sd">            None</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="kn">import</span> <span class="nn">forcefields.opls</span> <span class="k">as</span> <span class="nn">opls_utils</span>
        <span class="c1"># Read in and parse the opls parameter file</span>
        <span class="n">atom_types</span><span class="p">,</span> <span class="n">bond_types</span><span class="p">,</span> <span class="n">angle_types</span><span class="p">,</span> <span class="n">dihedral_types</span> <span class="o">=</span> <span class="n">opls_utils</span><span class="o">.</span><span class="n">parse_pfile</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">translate_AtomID_to_StructID</span> <span class="o">=</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">index</span><span class="p">):</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">index2</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">atom_types</span><span class="p">}</span>

            <span class="c1"># Add in special 1-to-1 translation for all other types not accounted for</span>
            <span class="c1"># This is because we also handle restictions on other FFs</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">r</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">translate_AtomID_to_StructID</span><span class="p">:</span>
                    <span class="n">translate_AtomID_to_StructID</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

            <span class="c1"># Add in special translation for * and 0</span>
            <span class="n">translate_AtomID_to_StructID</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span>
            <span class="n">translate_AtomID_to_StructID</span><span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">opls_structure_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">r</span><span class="p">:</span> <span class="n">translate_AtomID_to_StructID</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">)]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">opls_structure_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># For each possible param type, check if it exists and load it</span>
        <span class="n">lj_params</span> <span class="o">=</span> <span class="n">LJ</span><span class="o">.</span><span class="n">load_opls</span><span class="p">(</span><span class="n">atom_types</span><span class="p">,</span> <span class="n">pfptr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">restrict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">lj</span> <span class="ow">in</span> <span class="n">lj_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lj</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lj</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lj_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">lj</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">[</span><span class="n">lj_index</span><span class="p">]</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">lj</span><span class="o">.</span><span class="n">unpack</span><span class="p">())</span>

        <span class="n">coul_params</span> <span class="o">=</span> <span class="n">Coul</span><span class="o">.</span><span class="n">load_opls</span><span class="p">(</span><span class="n">atom_types</span><span class="p">,</span> <span class="n">pfptr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">restrict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">coul</span> <span class="ow">in</span> <span class="n">coul_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">coul</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coul_params</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coul_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coul</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">coul_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coul_params</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">coul</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coul_params</span><span class="p">[</span><span class="n">coul_index</span><span class="p">]</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">coul</span><span class="o">.</span><span class="n">unpack</span><span class="p">())</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">opls_structure_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">restrict_structures</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">restrict_structures</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">opls_structure_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bond_params</span> <span class="o">+=</span> <span class="n">Bond</span><span class="o">.</span><span class="n">load_opls</span><span class="p">(</span><span class="n">bond_types</span><span class="p">,</span> <span class="n">pfptr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">restrict</span><span class="o">=</span><span class="n">restrict_structures</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angle_params</span> <span class="o">+=</span> <span class="n">Angle</span><span class="o">.</span><span class="n">load_opls</span><span class="p">(</span><span class="n">angle_types</span><span class="p">,</span> <span class="n">pfptr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">restrict</span><span class="o">=</span><span class="n">restrict_structures</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_params</span> <span class="o">+=</span> <span class="n">Dihedral</span><span class="o">.</span><span class="n">load_opls</span><span class="p">(</span><span class="n">dihedral_types</span><span class="p">,</span> <span class="n">pfptr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">restrict</span><span class="o">=</span><span class="n">restrict_structures</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.load_smrff"><a class="viewcode-back" href="../codebase.html#ff_params.Parameters.load_smrff">[docs]</a>    <span class="k">def</span> <span class="nf">load_smrff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        A function to read in a SMRFF parameter file.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            fname: *str*</span>
<span class="sd">                The path to a smrff parameter file.</span>
<span class="sd">                ???.smrff</span>

<span class="sd">        **Returns**</span>

<span class="sd">            None</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Parse the input file to clean out comments, empty lines, and</span>
        <span class="c1"># trailing whitespace</span>
        <span class="kn">import</span> <span class="nn">forcefields.smrff</span> <span class="k">as</span> <span class="nn">smrff_utils</span>

        <span class="n">raw</span> <span class="o">=</span> <span class="n">smrff_utils</span><span class="o">.</span><span class="n">parse_pfile</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>

        <span class="c1"># For each possible param type, check if it exists and load it</span>
        <span class="n">lj_params</span> <span class="o">=</span> <span class="n">LJ</span><span class="o">.</span><span class="n">load_smrff</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">pfptr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">restrict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">lj</span> <span class="ow">in</span> <span class="n">lj_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lj</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lj</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lj_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">lj</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">[</span><span class="n">lj_index</span><span class="p">]</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">lj</span><span class="o">.</span><span class="n">unpack</span><span class="p">())</span>

        <span class="n">coul_params</span> <span class="o">=</span> <span class="n">Coul</span><span class="o">.</span><span class="n">load_smrff</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">pfptr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">restrict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">coul</span> <span class="ow">in</span> <span class="n">coul_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">coul</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coul_params</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coul_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coul</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">coul_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coul_params</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">coul</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coul_params</span><span class="p">[</span><span class="n">coul_index</span><span class="p">]</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">coul</span><span class="o">.</span><span class="n">unpack</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span> <span class="o">+=</span> <span class="n">Tersoff</span><span class="o">.</span><span class="n">load_smrff</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">pfptr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">restrict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">)</span>
        <span class="n">verify_tersoff_2body_symmetry</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">morse_params</span> <span class="o">+=</span> <span class="n">Morse</span><span class="o">.</span><span class="n">load_smrff</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">pfptr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">restrict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SR_SMOOTHS</span> <span class="o">+=</span> <span class="n">SmoothSin</span><span class="o">.</span><span class="n">load_smrff</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">pfptr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">restrict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.write_smrff"><a class="viewcode-back" href="../codebase.html#ff_params.Parameters.write_smrff">[docs]</a>    <span class="k">def</span> <span class="nf">write_smrff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        A function to save a SMRFF parameter file.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            fname: *str*</span>
<span class="sd">                The file name to save the parameters to.</span>

<span class="sd">        **Returns**</span>

<span class="sd">            None</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">params</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">param_types</span><span class="p">,</span> <span class="n">param_string_identifiers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_param_list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">param_type</span><span class="p">,</span> <span class="n">param_string</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">param_types</span><span class="p">,</span> <span class="n">param_string_identifiers</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">param_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">param_string</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">params</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">param_type</span> <span class="k">if</span> <span class="n">ffh</span><span class="o">.</span><span class="n">check_restriction</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">)])</span>
                <span class="n">params</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">END&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="n">fptr</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">fptr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="n">fptr</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="Parameters.unpack"><a class="viewcode-back" href="../codebase.html#ff_params.Parameters.unpack">[docs]</a>    <span class="k">def</span> <span class="nf">unpack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">with_indices</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">with_bounds</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Unpacks the parameters object into a 1D array for parameterization.</span>
<span class="sd">        This means that the indices are not included during unpacking!  Note,</span>
<span class="sd">        this can be overridden though if needed.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            with_indices: *bool, optional*</span>
<span class="sd">                Whether to also include the indices in the flat array.</span>
<span class="sd">            with_bounds: *bool, optional*</span>
<span class="sd">                Whether to also output the bounds for the parameters.</span>

<span class="sd">        **Returns**</span>

<span class="sd">            flat_array: *list, float/int*</span>
<span class="sd">                A list of floats/ints of our parameters.</span>
<span class="sd">            bounds_lower: *list, float/int*</span>
<span class="sd">                If with_bounds is specified, then the lower bounds are returned.</span>
<span class="sd">            bounds_upper: *list, float/int*</span>
<span class="sd">                If with_bounds is specified, then the upper bounds are returned.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">verify_tersoff_2body_symmetry</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span><span class="p">)</span>

        <span class="n">param_types</span><span class="p">,</span> <span class="n">param_string_identifiers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_param_list</span><span class="p">(</span><span class="n">trim_tersoff_2body</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">out</span><span class="p">,</span> <span class="n">bounds_lower</span><span class="p">,</span> <span class="n">bounds_upper</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">param_type</span> <span class="ow">in</span> <span class="n">param_types</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">param_type</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">ffh</span><span class="o">.</span><span class="n">check_restriction</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">with_bounds</span><span class="p">:</span>
                    <span class="n">local_out</span><span class="p">,</span> <span class="n">local_bounds_l</span><span class="p">,</span> <span class="n">local_bounds_u</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">with_indices</span><span class="p">,</span> <span class="n">with_bounds</span><span class="o">=</span><span class="n">with_bounds</span><span class="p">)</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="n">local_out</span>
                    <span class="n">bounds_lower</span> <span class="o">+=</span> <span class="n">local_bounds_l</span>
                    <span class="n">bounds_upper</span> <span class="o">+=</span> <span class="n">local_bounds_u</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="n">p</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">with_indices</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">with_bounds</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">out</span><span class="p">,</span> <span class="n">bounds_lower</span><span class="p">,</span> <span class="n">bounds_upper</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="Parameters.pack"><a class="viewcode-back" href="../codebase.html#ff_params.Parameters.pack">[docs]</a>    <span class="k">def</span> <span class="nf">pack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">with_indices</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Packs the parameters object from a 1D array.  NOTE! This is done in</span>
<span class="sd">        primarily for parameterization; which means the 1D array will NOT have</span>
<span class="sd">        the indices in it.  This can be overridden, however, by specifying the</span>
<span class="sd">        with_indices flag.</span>

<span class="sd">        Keep in mind, to maintain symmetry requirements in tersoff (where</span>
<span class="sd">        the two-body parameters are the same between A-B B and B-A A), this</span>
<span class="sd">        function will be tied closely to the unpack function.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            params: *list, float/int*</span>
<span class="sd">                A list of parameters</span>
<span class="sd">            with_indices: *bool, optional*</span>
<span class="sd">                Whether to account for the indices in the flat array.</span>

<span class="sd">        **Returns**</span>

<span class="sd">            None</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">param_types</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_param_list</span><span class="p">(</span><span class="n">trim_tersoff_2body</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">param_type</span> <span class="ow">in</span> <span class="n">param_types</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">param_type</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ffh</span><span class="o">.</span><span class="n">check_restriction</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">):</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">N_params</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">with_indices</span><span class="p">)])</span>
                <span class="n">offset</span> <span class="o">+=</span> <span class="n">p</span><span class="o">.</span><span class="n">N_params</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">with_indices</span><span class="p">)</span>

        <span class="c1">#self.tersoff_params = sorted_force_2body_symmetry(self.tersoff_params)</span>
        <span class="n">sorted_force_2body_symmetry</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span><span class="p">)</span></div>
        

<div class="viewcode-block" id="Parameters.dump_style"><a class="viewcode-back" href="../codebase.html#ff_params.Parameters.dump_style">[docs]</a>    <span class="k">def</span> <span class="nf">dump_style</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tfile_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tstyle_smrff</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">write_file</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function will dump LAMMPS commands &quot;pair_coeff&quot; for chosen styles.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            style: *str*</span>
<span class="sd">                Whether to ignore the universal bounds, assigned in this smrff.py file.smrff</span>
<span class="sd">            tfile_name: *str*</span>
<span class="sd">                The name of the tersoff file.</span>
<span class="sd">            tstyle_smrff: *bool, optional*</span>
<span class="sd">                Whether to output for SMRFF style (one line allocates memory,</span>
<span class="sd">                the rest overwrites the parameters) or not.</span>
<span class="sd">            write_file: *bool, optional*</span>
<span class="sd">                Whether to write any files (ex. tersoff files) or not.</span>

<span class="sd">        **Returns**</span>
<span class="sd">            lammps_command: *str*</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="n">style</span> <span class="ow">in</span> <span class="n">SUPPORTED_STYLES</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;all&quot;</span><span class="p">],</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is an undefined function&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">style</span><span class="p">)</span>

        <span class="n">script</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write_tfile</span> <span class="o">=</span> <span class="n">write_file</span>

        <span class="k">if</span> <span class="n">style</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;lj/cut/coul/cut&quot;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">lj_mask</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coul_mask</span><span class="p">]):</span>
            <span class="n">script</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dump_lj_cut_coul_cut</span><span class="p">())</span>
            <span class="n">script</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dump_set_charge</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">style</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;morse&quot;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">morse_mask</span><span class="p">:</span>
            <span class="n">script</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dump_morse</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">style</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;smooth&quot;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">smooth_mask</span><span class="p">:</span>
            <span class="n">script</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dump_smooths</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">style</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;tersoff&quot;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tersoff_mask</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tfile_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">tfile_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">system_name</span>
                <span class="k">if</span> <span class="n">tfile_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">tfile_name</span> <span class="o">=</span> <span class="s2">&quot;ters_params&quot;</span>
            <span class="n">script</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dump_tersoff</span><span class="p">(</span><span class="n">tfile_name</span><span class="p">,</span> <span class="n">tstyle_smrff</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">style</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;opls&quot;</span><span class="p">]:</span>
            <span class="n">script</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dump_bonds</span><span class="p">())</span>
            <span class="n">script</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dump_angles</span><span class="p">())</span>
            <span class="n">script</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dump_dihedrals</span><span class="p">())</span>

        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">script</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.mapper"><a class="viewcode-back" href="../codebase.html#ff_params.Parameters.mapper">[docs]</a>    <span class="k">def</span> <span class="nf">mapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        A generalized function to map indices of atom types to structure types.</span>
<span class="sd">        Note, this is generalized and should allow for a wide range of x</span>
<span class="sd">        objects.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            x: *list or tuple or int or str or obj*</span>
<span class="sd">                Some way of identifing the atom type.  Note, if obj, then it</span>
<span class="sd">                will check for a .index, .indices, or .index2s property.</span>

<span class="sd">        **Returns**</span>

<span class="sd">            mapper_obj: *list, str or str*</span>
<span class="sd">                The structure type, as either a list (if bond/angle/dihedral)</span>
<span class="sd">                or a string (if charge/lj).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">ffh</span><span class="o">.</span><span class="n">map_to_lmp_index</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">opls_structure_dict</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.dump_bonds"><a class="viewcode-back" href="../codebase.html#ff_params.Parameters.dump_bonds">[docs]</a>    <span class="k">def</span> <span class="nf">dump_bonds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get a string for lammps input in regards to assigning bond coeffs.</span>

<span class="sd">        **Returns**</span>

<span class="sd">            coeffs: *str*</span>
<span class="sd">                A string of bond coeffs, with new line characters between</span>
<span class="sd">                different bonds.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">lammps_command</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">opls_structure_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">restrict_structures</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">restrict_structures</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">opls_structure_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">]</span>

        <span class="c1"># Loop through all possible bond parameters</span>
        <span class="n">index</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bond_params</span><span class="p">:</span>
            <span class="c1"># Skip those that are not included</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ffh</span><span class="o">.</span><span class="n">check_restriction</span><span class="p">(</span><span class="n">bond</span><span class="p">,</span> <span class="n">restrict_structures</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="c1"># Get the bond coeff string</span>
            <span class="n">lammps_command</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;bond_coeff </span><span class="si">%d</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">bond</span><span class="o">.</span><span class="n">printer</span><span class="p">(</span><span class="n">map_indices</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="p">)))</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lammps_command</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.dump_angles"><a class="viewcode-back" href="../codebase.html#ff_params.Parameters.dump_angles">[docs]</a>    <span class="k">def</span> <span class="nf">dump_angles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get a string for lammps input in regards to assigning angle coeffs.</span>

<span class="sd">        **Returns**</span>

<span class="sd">            coeffs: *str*</span>
<span class="sd">                A string of angle coeffs, with new line characters between</span>
<span class="sd">                different angles.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">lammps_command</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">opls_structure_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">restrict_structures</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">restrict_structures</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">opls_structure_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">]</span>

        <span class="c1"># Loop through all possible angle parameters</span>
        <span class="n">index</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle_params</span><span class="p">:</span>
            <span class="c1"># Skip those that are not included</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ffh</span><span class="o">.</span><span class="n">check_restriction</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">restrict_structures</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="c1"># Get the angle coeff string</span>
            <span class="n">lammps_command</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;angle_coeff </span><span class="si">%d</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">angle</span><span class="o">.</span><span class="n">printer</span><span class="p">(</span><span class="n">map_indices</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="p">)))</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lammps_command</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.dump_dihedrals"><a class="viewcode-back" href="../codebase.html#ff_params.Parameters.dump_dihedrals">[docs]</a>    <span class="k">def</span> <span class="nf">dump_dihedrals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get a string for lammps input in regards to assigning dihedral coeffs.</span>

<span class="sd">        **Returns**</span>

<span class="sd">            coeffs: *str*</span>
<span class="sd">                A string of dihedral coeffs, with new line characters between</span>
<span class="sd">                different dihedrals.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">lammps_command</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">opls_structure_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">restrict_structures</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">restrict_structures</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">opls_structure_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">]</span>

        <span class="c1"># Loop through all possible dihedral parameters</span>
        <span class="n">index</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">dihedral</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_params</span><span class="p">:</span>
            <span class="c1"># Skip those that are not included</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ffh</span><span class="o">.</span><span class="n">check_restriction</span><span class="p">(</span><span class="n">dihedral</span><span class="p">,</span> <span class="n">restrict_structures</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="c1"># Get the dihedral coeff string</span>
            <span class="n">lammps_command</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;dihedral_coeff </span><span class="si">%d</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">dihedral</span><span class="o">.</span><span class="n">printer</span><span class="p">(</span><span class="n">map_indices</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="p">)))</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lammps_command</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.dump_lj_cut_coul_cut"><a class="viewcode-back" href="../codebase.html#ff_params.Parameters.dump_lj_cut_coul_cut">[docs]</a>    <span class="k">def</span> <span class="nf">dump_lj_cut_coul_cut</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function will get the lammps command line argument for</span>
<span class="sd">        lj/cut/coul/cut of everything within the Parameters object.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            None</span>

<span class="sd">        **Returns**</span>

<span class="sd">            cmds: *str*</span>
<span class="sd">                A string, separated with new lines, with pair_coeff for each</span>
<span class="sd">                lj/cut/coul/cut command possible within this parameter set.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">lammps_command</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">)):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">ffh</span><span class="o">.</span><span class="n">check_restriction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">ffh</span><span class="o">.</span><span class="n">check_restriction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="n">sigma_ij</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">sigma</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">sigma</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>
                <span class="n">epsilon_ij</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">epsilon</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>
                <span class="n">type_i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">type_j</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">type_i</span><span class="p">,</span> <span class="n">type_j</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">type_i</span><span class="p">,</span> <span class="n">type_j</span><span class="p">])</span>
                <span class="n">lammps_command</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;pair_coeff </span><span class="si">%d</span><span class="s1"> </span><span class="si">%d</span><span class="s1"> lj/cut/coul/cut </span><span class="si">%f</span><span class="s1"> </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">type_i</span><span class="p">,</span> <span class="n">type_j</span><span class="p">,</span> <span class="n">epsilon_ij</span><span class="p">,</span> <span class="n">sigma_ij</span><span class="p">))</span>

        <span class="n">lammps_command</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lammps_command</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lammps_command</span></div>

<div class="viewcode-block" id="Parameters.dump_smooths"><a class="viewcode-back" href="../codebase.html#ff_params.Parameters.dump_smooths">[docs]</a>    <span class="k">def</span> <span class="nf">dump_smooths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function will get the lammps command line argument for</span>
<span class="sd">        smrff smooths of everything within the Parameters object.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            None</span>

<span class="sd">        **Returns**</span>

<span class="sd">            cmds: *str*</span>
<span class="sd">                A string, separated with new lines, with pair_coeff for each</span>
<span class="sd">                smrff smooth command possible within this parameter set.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">lammps_command</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">sr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">SR_SMOOTHS</span><span class="p">:</span>
            <span class="n">lammps_command</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sr</span><span class="o">.</span><span class="n">dump_pair_coeffs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">lr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">LR_SMOOTHS</span><span class="p">:</span>
            <span class="n">lammps_command</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lr</span><span class="o">.</span><span class="n">dump_pair_coeffs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">))</span>
        <span class="n">lammps_command</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lammps_command</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lammps_command</span></div>

<div class="viewcode-block" id="Parameters.dump_tersoff"><a class="viewcode-back" href="../codebase.html#ff_params.Parameters.dump_tersoff">[docs]</a>    <span class="k">def</span> <span class="nf">dump_tersoff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tfile_name</span><span class="p">,</span> <span class="n">tstyle_smrff</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function will get the lammps command line argument for</span>
<span class="sd">        tersoff of everything within the Parameters object.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            tfile_name: *str*</span>
<span class="sd">                The name of the tersoff file.</span>
<span class="sd">            tstyle_smrff: *bool, optional*</span>
<span class="sd">                Whether to output for SMRFF style (one line allocates memory,</span>
<span class="sd">                the rest overwrites the parameters) or not.  If True, this</span>
<span class="sd">                will NOT generate a tersoff file.</span>

<span class="sd">        **Returns**</span>

<span class="sd">            cmds: *str*</span>
<span class="sd">                A string, separated with new lines, with pair_coeff for each</span>
<span class="sd">                tersoff command possible within this parameter set.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">verify_tersoff_2body_symmetry</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span><span class="p">)</span>
        <span class="n">local_tersoff_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">local_tersoff_params</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span> <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">indices</span><span class="p">])</span>
            <span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_tfile</span><span class="p">:</span>
            <span class="n">tersoff_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">tfile_name</span> <span class="o">+</span> <span class="s2">&quot;.tersoff&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
            <span class="n">tersoff_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">local_tersoff_params</span><span class="p">]))</span>
            <span class="n">tersoff_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">lammps_command</span> <span class="o">=</span> <span class="s1">&#39;pair_coeff * * tersoff &#39;</span>
        <span class="n">lammps_command</span> <span class="o">+=</span> <span class="n">tfile_name</span> <span class="o">+</span> <span class="s1">&#39;.tersoff &#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tindices</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">local_tersoff_params</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">indices</span><span class="p">]</span>
            <span class="n">lammps_command</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">r</span> <span class="k">if</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">tindices</span> <span class="k">else</span> <span class="s2">&quot;NULL&quot;</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lammps_command</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tstyle_smrff</span><span class="p">:</span>
            <span class="n">lammps_command</span> <span class="o">=</span> <span class="p">[</span><span class="n">lammps_command</span><span class="p">]</span>
            <span class="n">lammps_command</span> <span class="o">+=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">dump_line</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">local_tersoff_params</span><span class="p">]</span>
            <span class="n">lammps_command</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lammps_command</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">lammps_command</span></div>

<div class="viewcode-block" id="Parameters.dump_morse"><a class="viewcode-back" href="../codebase.html#ff_params.Parameters.dump_morse">[docs]</a>    <span class="k">def</span> <span class="nf">dump_morse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function will get the lammps command line argument for</span>
<span class="sd">        morse of everything within the Parameters object.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            None</span>

<span class="sd">        **Returns**</span>

<span class="sd">            cmds: *str*</span>
<span class="sd">                A string, separated with new lines, with pair_coeff for each</span>
<span class="sd">                morse command possible within this parameter set.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">lammps_command</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">morse_params</span><span class="p">)):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ffh</span><span class="o">.</span><span class="n">check_restriction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">morse_params</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">index_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">morse_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">index_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">morse_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="n">index_i</span><span class="p">,</span> <span class="n">index_j</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">index_i</span><span class="p">,</span> <span class="n">index_j</span><span class="p">])</span>

            <span class="n">D0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">morse_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">D0</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">morse_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">alpha</span>
            <span class="n">r0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">morse_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">r0</span>
            <span class="n">rc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">morse_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">rc</span>
            <span class="n">lammps_command</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;pair_coeff &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index_i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index_j</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; morse </span><span class="si">%f</span><span class="s1"> </span><span class="si">%f</span><span class="s1"> </span><span class="si">%f</span><span class="s1"> </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">D0</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="n">rc</span><span class="p">))</span>
        <span class="n">lammps_command</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lammps_command</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lammps_command</span></div>

<div class="viewcode-block" id="Parameters.dump_set_charge"><a class="viewcode-back" href="../codebase.html#ff_params.Parameters.dump_set_charge">[docs]</a>    <span class="k">def</span> <span class="nf">dump_set_charge</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function will get the lammps command line argument for</span>
<span class="sd">        &quot;set type&quot; of everything within the Parameters object.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            None</span>

<span class="sd">        **Returns**</span>

<span class="sd">            cmds: *str*</span>
<span class="sd">                A string, separated with new lines, with pair_coeff for each</span>
<span class="sd">                morse command possible within this parameter set.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">lammps_command</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coul_params</span><span class="p">)):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ffh</span><span class="o">.</span><span class="n">check_restriction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coul_params</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">charge_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coul_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">charge</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coul_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="n">lammps_command</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;set type </span><span class="si">%d</span><span class="s1"> charge </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">charge_i</span><span class="p">))</span>
        <span class="n">lammps_command</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lammps_command</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lammps_command</span></div>

<div class="viewcode-block" id="Parameters.find_maximum"><a class="viewcode-back" href="../codebase.html#ff_params.Parameters.find_maximum">[docs]</a>    <span class="k">def</span> <span class="nf">find_maximum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">coeff</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function find the maximum value of some coefficient of some style.</span>

<span class="sd">        **Parameters**</span>
<span class="sd">            style: *str*</span>
<span class="sd">                the name (or type) of the style</span>
<span class="sd">            coeff: *str*</span>
<span class="sd">                the name (or type) of the coefficient</span>

<span class="sd">        **Returns**</span>
<span class="sd">            maximum_value: *str* or *float*</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">style</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">coeff</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">style</span> <span class="ow">in</span> <span class="n">SMRFF_DICT</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">coeff</span> <span class="ow">in</span> <span class="n">SMRFF_DICT</span><span class="p">[</span><span class="n">style</span><span class="p">]):</span>
                <span class="n">maximum_value</span> <span class="o">=</span> <span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;self.&quot;</span> <span class="o">+</span> <span class="n">style</span> <span class="o">+</span> <span class="s2">&quot;_params&quot;</span><span class="p">))):</span>
                    <span class="n">maximum_value</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maximum_value</span><span class="p">,</span> <span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;self.&quot;</span> <span class="o">+</span> <span class="n">style</span> <span class="o">+</span> <span class="s2">&quot;_params[&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;].&quot;</span> <span class="o">+</span> <span class="n">coeff</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">maximum_value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Style or coeff type NOT included in SMRFF.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Style or coeff type NOT declared.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.get_smrff_style"><a class="viewcode-back" href="../codebase.html#ff_params.Parameters.get_smrff_style">[docs]</a>    <span class="k">def</span> <span class="nf">get_smrff_style</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This will return the smrff style.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">short_range</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;ters&quot;</span><span class="p">):</span>
            <span class="n">sr</span> <span class="o">=</span> <span class="s2">&quot;tersoff&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">short_range</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sr_cut</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">long_range</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;ters&quot;</span><span class="p">):</span>
            <span class="n">lr</span> <span class="o">=</span> <span class="s2">&quot;tersoff&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">long_range</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lr_cut</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="s2">&quot;pair_style smrff </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> smooth </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">lr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sr_smooth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr_smooth</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.fix"><a class="viewcode-back" href="../codebase.html#ff_params.Parameters.fix">[docs]</a>    <span class="k">def</span> <span class="nf">fix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function will fix a specific style (coul, lj, morse, etc), label</span>
<span class="sd">        (where label is the atom label/type you want to fix), and the component</span>
<span class="sd">        (ex, sigma in LJ).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">style</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">style</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;coul&quot;</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coul_params</span><span class="p">,</span> <span class="s2">&quot;Label </span><span class="si">%s</span><span class="s2"> does not exist in coulomb list!&quot;</span> <span class="o">%</span> <span class="n">label</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coul_params</span><span class="p">)</span> <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="n">label</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coul_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">style</span> <span class="o">==</span> <span class="s2">&quot;lj&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">,</span> <span class="s2">&quot;Label </span><span class="si">%s</span><span class="s2"> does not exist in lj list!&quot;</span> <span class="o">%</span> <span class="n">label</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">)</span> <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="n">label</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">style</span> <span class="o">==</span> <span class="s2">&quot;morse&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">morse_params</span><span class="p">,</span> <span class="s2">&quot;Label </span><span class="si">%s</span><span class="s2"> does not exist in morse list!&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">morse_params</span><span class="p">)</span> <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="n">label</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">morse_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">style</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;ters&quot;</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span><span class="p">,</span> <span class="s2">&quot;Label </span><span class="si">%s</span><span class="s2"> does not exist in tersoff list!&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span><span class="p">)</span> <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="n">label</span><span class="p">]</span>
            <span class="n">two_body_strings</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;beta&quot;</span><span class="p">,</span> <span class="s2">&quot;lambda1&quot;</span><span class="p">,</span> <span class="s2">&quot;lambda2&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
                <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">indices</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="n">b</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">==</span> <span class="n">c</span> <span class="ow">and</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">two_body_strings</span><span class="p">:</span>
                    <span class="c1"># We must handle symmetry constraints for 2-body parameters!</span>
                    <span class="n">i2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span><span class="o">.</span><span class="n">index</span><span class="p">((</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span><span class="p">[</span><span class="n">i2</span><span class="p">]</span><span class="o">.</span><span class="n">update_2body</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">verify_tersoff_2body_symmetry</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Cannot handle the style </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">style</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.num_free_parameters"><a class="viewcode-back" href="../codebase.html#ff_params.Parameters.num_free_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">num_free_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function will return the number of unfixed parameters.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">pkg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">with_indices</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">with_bounds</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">pkg</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">low</span> <span class="o">==</span> <span class="n">val</span> <span class="o">==</span> <span class="n">up</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">up</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">pkg</span><span class="p">)])</span></div></div>

</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../squid.html">Squid</a></li>
<li class="toctree-l1"><a class="reference internal" href="../codebase.html">Codebase</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Squid 0.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Henry Herbol.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.4.
    </div>
  </body>
</html>