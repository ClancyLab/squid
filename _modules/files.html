
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>files &#8212; Squid 0.0.1 documentation</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="../index.html">Squid 0.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for files</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The files module contains various functions aiding in file input and output.</span>

<span class="sd">- :func:`read_cml`</span>
<span class="sd">- :func:`write_cml`</span>
<span class="sd">- :func:`read_xyz`</span>
<span class="sd">- :func:`write_xyz`</span>
<span class="sd">- :func:`read_lammpstrj`</span>
<span class="sd">- :func:`write_lammpstrj`</span>
<span class="sd">- :func:`read_lammps_data`</span>
<span class="sd">- :func:`write_lammps_data`</span>
<span class="sd">- :func:`last_modified`</span>
<span class="sd">- :func:`which`</span>

<span class="sd">------------</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># System imports</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">xml.etree.ElementTree</span> <span class="k">as</span> <span class="nn">xml</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">from</span> <span class="nn">warnings</span> <span class="k">import</span> <span class="n">warn</span>

<span class="c1"># Clancelot imports</span>
<span class="kn">import</span> <span class="nn">units</span>
<span class="kn">import</span> <span class="nn">structures</span>
<span class="kn">import</span> <span class="nn">results</span>
<span class="kn">import</span> <span class="nn">geometry</span>
<span class="kn">import</span> <span class="nn">sysconst</span>
<span class="kn">from</span> <span class="nn">frc_opls</span> <span class="k">import</span> <span class="n">set_forcefield_parameters</span> <span class="k">as</span> <span class="n">set_ffparams</span>


<span class="c1"># Read the Chemical Markup Language (CML)</span>
<div class="viewcode-block" id="read_cml"><a class="viewcode-back" href="../codebase.html#files.read_cml">[docs]</a><span class="k">def</span> <span class="nf">read_cml</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">parameter_file</span><span class="o">=</span><span class="n">sysconst</span><span class="o">.</span><span class="n">opls_path</span><span class="p">,</span> <span class="n">extra_parameters</span><span class="o">=</span><span class="p">{},</span>
             <span class="n">test_charges</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pair_style</span><span class="o">=</span><span class="s1">&#39;lj/cut&#39;</span><span class="p">,</span>
             <span class="n">default_angles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_molecules</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">test_consistency</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read in a file written in the Chemical Markup Language (CML) format.</span>
<span class="sd">    It should be mentioned that when reading a file with multiple molecules,</span>
<span class="sd">    if you do not specify return_molecules=True, then everything will be</span>
<span class="sd">    combined into one list.</span>

<span class="sd">    **Parameters**</span>

<span class="sd">        name: *str*</span>
<span class="sd">            File name.</span>
<span class="sd">        parameter_file: *str, optional*</span>
<span class="sd">            Path to the forcefield parameter file.</span>
<span class="sd">        extra_parameters: *dict, optional*</span>
<span class="sd">            Additional OPLS parameters to apply to the forcefield.</span>
<span class="sd">        test_charges: *bool, optional*</span>
<span class="sd">            Bypass inconsistencies in molecular charge (False) or throw errors</span>
<span class="sd">            when inconsistencies exist (True).</span>
<span class="sd">        allow_errors: *bool, optional*</span>
<span class="sd">            Permit constructions of ill-conditioned molecules, such as empty</span>
<span class="sd">            bonds (True), or throw errors (False).</span>
<span class="sd">        pair_style: *str, optional*</span>
<span class="sd">            Pair style to be used in the forcefield.</span>
<span class="sd">        default_angles: *dict, optional*</span>
<span class="sd">            A default forcefield angle type to be set if angle types are set</span>
<span class="sd">            to None.</span>
<span class="sd">        return_molecules: *bool, optional*</span>
<span class="sd">            Whether to have the return be formated as a</span>
<span class="sd">            :class:`structures.Molecule` object or not.</span>
<span class="sd">        test_consistency: *bool, optional*</span>
<span class="sd">            Whether to validate the input cml file against OPLS.</span>

<span class="sd">    **Returns**</span>

<span class="sd">        atoms: *list,* :class:`structures.Atom`</span>
<span class="sd">            A list of atoms read in from the CML file.</span>
<span class="sd">        bonds: *list,* :class:`structures.Bond`</span>
<span class="sd">            A list of bonds read in from the CML file.</span>
<span class="sd">        angles: *list,* :class:`structures.Angle`</span>
<span class="sd">            A list of angles read in from the CML file.</span>
<span class="sd">        dihedrals: *list,* :class:`structures.Dihedral`</span>
<span class="sd">            A list of dihedrals read in from the CML file.</span>

<span class="sd">        or</span>

<span class="sd">        molecules: *list,* :class:`structures.Molecule`</span>
<span class="sd">            A list of molecules in read in from the CML file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.cml&#39;</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">+=</span> <span class="s1">&#39;.cml&#39;</span>

    <span class="n">tree</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>

    <span class="c1"># If periodic box information was passed to cml file, first root is the</span>
    <span class="c1"># periodic box. If no periodic box info, first root is atomArray. Fill</span>
    <span class="c1"># appropriate section when it is found</span>
    <span class="n">atoms</span><span class="p">,</span> <span class="n">bonds</span><span class="p">,</span> <span class="n">angles</span><span class="p">,</span> <span class="n">dihedrals</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

    <span class="c1"># Parse the atoms of a cml file</span>
    <span class="k">def</span> <span class="nf">_parse_atoms</span><span class="p">(</span><span class="n">child</span><span class="p">):</span>
        <span class="n">child_atoms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">child</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">structures</span><span class="o">.</span><span class="n">Atom</span><span class="p">(</span><span class="n">element</span><span class="o">=</span><span class="n">atom</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;elementType&#39;</span><span class="p">],</span>
                                <span class="n">x</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;x3&#39;</span><span class="p">]),</span>
                                <span class="n">y</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;y3&#39;</span><span class="p">]),</span>
                                <span class="n">z</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;z3&#39;</span><span class="p">]))</span>
            <span class="n">a</span><span class="o">.</span><span class="n">bonded</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">a</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span>
            <span class="k">if</span> <span class="s1">&#39;label&#39;</span> <span class="ow">in</span> <span class="n">atom</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                <span class="n">a</span><span class="o">.</span><span class="n">type_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">])</span>
            <span class="n">child_atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">child_atoms</span>

    <span class="c1"># Parse the bonds of a cml file</span>
    <span class="k">def</span> <span class="nf">_parse_bonds</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">child_atoms</span><span class="p">):</span>
        <span class="n">c_bonds</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">child</span><span class="p">:</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">bond</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;atomRefs2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
            <span class="n">c_bonds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">structures</span><span class="o">.</span><span class="n">Bond</span><span class="p">(</span><span class="n">child_atoms</span><span class="p">[</span><span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
                                           <span class="n">child_atoms</span><span class="p">[</span><span class="n">b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span>
            <span class="n">child_atoms</span><span class="p">[</span><span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bonded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child_atoms</span><span class="p">[</span><span class="n">b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">child_atoms</span><span class="p">[</span><span class="n">b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bonded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child_atoms</span><span class="p">[</span><span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">c_angles</span><span class="p">,</span> <span class="n">c_dihedrals</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">get_angles_and_dihedrals</span><span class="p">(</span><span class="n">child_atoms</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">c_bonds</span><span class="p">,</span> <span class="n">c_angles</span><span class="p">,</span> <span class="n">c_dihedrals</span>

    <span class="n">molecules</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
        <span class="c1"># Strip away any {} info</span>
        <span class="k">if</span> <span class="s2">&quot;{&quot;</span> <span class="ow">in</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">:</span>
            <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Skip crystal information</span>
        <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;crystal&#39;</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="c1"># Add atoms</span>
        <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;atomArray&#39;</span><span class="p">:</span>
            <span class="n">c_atoms</span> <span class="o">=</span> <span class="n">_parse_atoms</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="n">atoms</span> <span class="o">+=</span> <span class="n">c_atoms</span>

        <span class="c1"># Add bonds</span>
        <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;bondArray&#39;</span><span class="p">:</span>
            <span class="n">c_bonds</span><span class="p">,</span> <span class="n">c_angles</span><span class="p">,</span> <span class="n">c_dihedrals</span> <span class="o">=</span> <span class="n">_parse_bonds</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">c_atoms</span><span class="p">)</span>
            <span class="n">bonds</span> <span class="o">+=</span> <span class="n">c_bonds</span>
            <span class="n">angles</span> <span class="o">+=</span> <span class="n">c_angles</span>
            <span class="n">dihedrals</span> <span class="o">+=</span> <span class="n">c_dihedrals</span>

        <span class="c1"># Read in molecules</span>
        <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;molecule&#39;</span><span class="p">:</span>
            <span class="n">c_atoms</span><span class="p">,</span> <span class="n">c_bonds</span><span class="p">,</span> <span class="n">c_angles</span><span class="p">,</span> <span class="n">c_dihedrals</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
            <span class="n">c2_atoms</span><span class="p">,</span> <span class="n">c2_bonds</span><span class="p">,</span> <span class="n">c2_angles</span><span class="p">,</span> <span class="n">c2_dihedrals</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">sub_child</span> <span class="ow">in</span> <span class="n">child</span><span class="p">:</span>
                <span class="c1"># Skip crystal information</span>
                <span class="k">if</span> <span class="n">sub_child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;crystal&#39;</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="c1"># Add atoms</span>
                <span class="k">if</span> <span class="n">sub_child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;atomArray&#39;</span><span class="p">:</span>
                    <span class="n">c_atoms</span> <span class="o">=</span> <span class="n">_parse_atoms</span><span class="p">(</span><span class="n">sub_child</span><span class="p">)</span>
                    <span class="n">c2_atoms</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">c_atoms</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">atoms</span> <span class="o">==</span> <span class="p">[]:</span>
                        <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">offset</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">a</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">])</span>
                    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">c2_atoms</span><span class="p">:</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">index</span> <span class="o">+=</span> <span class="n">offset</span>
                    <span class="n">atoms</span> <span class="o">+=</span> <span class="n">c2_atoms</span>

                <span class="c1"># Add bonds</span>
                <span class="k">if</span> <span class="n">sub_child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;bondArray&#39;</span><span class="p">:</span>
                    <span class="n">c_bonds</span><span class="p">,</span> <span class="n">c_angles</span><span class="p">,</span> <span class="n">c_dihedrals</span> <span class="o">=</span> <span class="n">_parse_bonds</span><span class="p">(</span><span class="n">sub_child</span><span class="p">,</span>
                                                                  <span class="n">c_atoms</span><span class="p">)</span>
                    <span class="n">c2_bonds</span><span class="p">,</span> <span class="n">c2_angles</span><span class="p">,</span> <span class="n">c2_dihedrals</span> <span class="o">=</span> <span class="n">_parse_bonds</span><span class="p">(</span><span class="n">sub_child</span><span class="p">,</span>
                                                                     <span class="n">c2_atoms</span><span class="p">)</span>
                    <span class="n">bonds</span> <span class="o">+=</span> <span class="n">c_bonds</span>
                    <span class="n">angles</span> <span class="o">+=</span> <span class="n">c_angles</span>
                    <span class="n">dihedrals</span> <span class="o">+=</span> <span class="n">c_dihedrals</span>

            <span class="k">if</span> <span class="n">parameter_file</span><span class="p">:</span>
                <span class="n">ffparams</span> <span class="o">=</span> <span class="n">set_ffparams</span><span class="p">(</span><span class="n">c_atoms</span><span class="p">,</span>
                                        <span class="n">bonds</span><span class="o">=</span><span class="n">c_bonds</span><span class="p">,</span>
                                        <span class="n">angles</span><span class="o">=</span><span class="n">c_angles</span><span class="p">,</span>
                                        <span class="n">dihedrals</span><span class="o">=</span><span class="n">c_dihedrals</span><span class="p">,</span>
                                        <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                                        <span class="n">parameter_file</span><span class="o">=</span><span class="n">parameter_file</span><span class="p">,</span>
                                        <span class="n">extra_parameters</span><span class="o">=</span><span class="n">extra_parameters</span><span class="p">,</span>
                                        <span class="n">test_charges</span><span class="o">=</span><span class="n">test_charges</span><span class="p">,</span>
                                        <span class="n">allow_errors</span><span class="o">=</span><span class="n">allow_errors</span><span class="p">,</span>
                                        <span class="n">pair_style</span><span class="o">=</span><span class="n">pair_style</span><span class="p">,</span>
                                        <span class="n">allow_no_ffp</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                        <span class="n">test_consistency</span><span class="o">=</span><span class="n">test_consistency</span><span class="p">)</span>
                <span class="n">c_atoms</span><span class="p">,</span> <span class="n">c_bonds</span><span class="p">,</span> <span class="n">c_angles</span><span class="p">,</span> <span class="n">c_dihedrals</span> <span class="o">=</span> <span class="n">ffparams</span>

            <span class="k">if</span> <span class="n">default_angles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ang</span> <span class="ow">in</span> <span class="n">c_angles</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ang</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">ang</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">default_angles</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
                        <span class="n">ang</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">angle</span> <span class="o">=</span> <span class="n">default_angles</span><span class="p">[</span><span class="s2">&quot;angle&quot;</span><span class="p">]</span>
                        <span class="n">ang</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">default_angles</span><span class="p">[</span><span class="s2">&quot;style&quot;</span><span class="p">]</span>
                        <span class="n">ang</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="n">default_angles</span><span class="p">[</span><span class="s2">&quot;e&quot;</span><span class="p">]</span>
                        <span class="n">ang</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">index2s</span> <span class="o">=</span> <span class="n">default_angles</span><span class="p">[</span><span class="s2">&quot;index2s&quot;</span><span class="p">]</span>

            <span class="n">molecules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">structures</span><span class="o">.</span><span class="n">Molecule</span><span class="p">(</span><span class="n">c_atoms</span><span class="p">,</span>
                                                 <span class="n">bonds</span><span class="o">=</span><span class="n">c_bonds</span><span class="p">,</span>
                                                 <span class="n">angles</span><span class="o">=</span><span class="n">c_angles</span><span class="p">,</span>
                                                 <span class="n">dihedrals</span><span class="o">=</span><span class="n">c_dihedrals</span><span class="p">,</span>
                                                 <span class="n">test_charges</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                 <span class="n">allow_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">parameter_file</span><span class="p">:</span>
        <span class="n">ffparams</span> <span class="o">=</span> <span class="n">set_ffparams</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span>
                                <span class="n">bonds</span><span class="o">=</span><span class="n">bonds</span><span class="p">,</span>
                                <span class="n">angles</span><span class="o">=</span><span class="n">angles</span><span class="p">,</span>
                                <span class="n">dihedrals</span><span class="o">=</span><span class="n">dihedrals</span><span class="p">,</span>
                                <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                                <span class="n">parameter_file</span><span class="o">=</span><span class="n">parameter_file</span><span class="p">,</span>
                                <span class="n">extra_parameters</span><span class="o">=</span><span class="n">extra_parameters</span><span class="p">,</span>
                                <span class="n">test_charges</span><span class="o">=</span><span class="n">test_charges</span><span class="p">,</span>
                                <span class="n">allow_errors</span><span class="o">=</span><span class="n">allow_errors</span><span class="p">,</span>
                                <span class="n">pair_style</span><span class="o">=</span><span class="n">pair_style</span><span class="p">,</span>
                                <span class="n">allow_no_ffp</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                <span class="n">test_consistency</span><span class="o">=</span><span class="n">test_consistency</span><span class="p">)</span>
        <span class="n">atoms</span><span class="p">,</span> <span class="n">bonds</span><span class="p">,</span> <span class="n">angles</span><span class="p">,</span> <span class="n">dihedrals</span> <span class="o">=</span> <span class="n">ffparams</span>

    <span class="k">if</span> <span class="n">default_angles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ang</span> <span class="ow">in</span> <span class="n">angles</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ang</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ang</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">default_angles</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
                <span class="n">ang</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">angle</span> <span class="o">=</span> <span class="n">default_angles</span><span class="p">[</span><span class="s2">&quot;angle&quot;</span><span class="p">]</span>
                <span class="n">ang</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">default_angles</span><span class="p">[</span><span class="s2">&quot;style&quot;</span><span class="p">]</span>
                <span class="n">ang</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="n">default_angles</span><span class="p">[</span><span class="s2">&quot;e&quot;</span><span class="p">]</span>
                <span class="n">ang</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">index2s</span> <span class="o">=</span> <span class="n">default_angles</span><span class="p">[</span><span class="s2">&quot;index2s&quot;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">return_molecules</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">molecules</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">structures</span><span class="o">.</span><span class="n">Molecule</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span>
                                        <span class="n">bonds</span><span class="o">=</span><span class="n">bonds</span><span class="p">,</span>
                                        <span class="n">angles</span><span class="o">=</span><span class="n">angles</span><span class="p">,</span>
                                        <span class="n">dihedrals</span><span class="o">=</span><span class="n">dihedrals</span><span class="p">,</span>
                                        <span class="n">test_charges</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                        <span class="n">allow_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">molecules</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">atoms</span><span class="p">,</span> <span class="n">bonds</span><span class="p">,</span> <span class="n">angles</span><span class="p">,</span> <span class="n">dihedrals</span></div>


<span class="c1"># 1st param: either a list of structures.Atom objects, a</span>
<span class="c1"># structures.Molecule object or a structures.System object</span>
<div class="viewcode-block" id="write_cml"><a class="viewcode-back" href="../codebase.html#files.write_cml">[docs]</a><span class="k">def</span> <span class="nf">write_cml</span><span class="p">(</span><span class="n">atoms_or_molecule_or_system</span><span class="p">,</span> <span class="n">bonds</span><span class="o">=</span><span class="p">[],</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write data in (list, :class:`structures.Atom`), or</span>
<span class="sd">    :class:`structures.Molecule`, or :class:`structures.System` to a file</span>
<span class="sd">    written in the Chemical Markup Language (CML) format. If a list of</span>
<span class="sd">    :class:`structures.Molecule` is passed, then a CML file is written in</span>
<span class="sd">    which each molecule is its own section.  Note, this cannot be read into</span>
<span class="sd">    Avogadro, and it is recommended that if you plan to use Avogadro to</span>
<span class="sd">    combine these into one :class:`structures.System`.</span>

<span class="sd">    **Parameters**</span>

<span class="sd">        atoms_or_molecule_or_system: :class:`structures.Atom` *or* :class:`structures.Molecule` *or* :class:`structures.System`</span>
<span class="sd">            Atomic data to be written to a CML file.</span>
<span class="sd">        bonds: *list,* :class:`structures.Bond` *, optional*</span>
<span class="sd">            A list of bonds within the system.  This is useful when the input</span>
<span class="sd">            is a list of :class:`structures.Atom` .</span>
<span class="sd">        name: *str, optional*</span>
<span class="sd">            The name of the output file (either ending or not in .cml).</span>

<span class="sd">    **Returns**</span>

<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;out&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.cml&#39;</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">+=</span> <span class="s1">&#39;.cml&#39;</span>

    <span class="c1"># Determine whether input is an atom list or a system object</span>
    <span class="c1"># If it is a system object, compile information to write cml file</span>
    <span class="n">child_flag</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">atoms_or_molecule_or_system</span><span class="p">,</span> <span class="n">structures</span><span class="o">.</span><span class="n">System</span><span class="p">):</span>
        <span class="n">system</span> <span class="o">=</span> <span class="n">atoms_or_molecule_or_system</span>
        <span class="n">atoms</span><span class="p">,</span> <span class="n">bonds</span><span class="p">,</span> <span class="n">periodic</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">atoms</span><span class="p">,</span> <span class="n">system</span><span class="o">.</span><span class="n">bonds</span><span class="p">,</span> <span class="n">system</span><span class="o">.</span><span class="n">periodic</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">atoms_or_molecule_or_system</span><span class="p">,</span> <span class="n">structures</span><span class="o">.</span><span class="n">Molecule</span><span class="p">):</span>
        <span class="n">molecule</span> <span class="o">=</span> <span class="n">atoms_or_molecule_or_system</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">atoms</span>
        <span class="n">bonds</span> <span class="o">=</span> <span class="n">bonds</span> <span class="ow">or</span> <span class="n">molecule</span><span class="o">.</span><span class="n">bonds</span>
        <span class="n">periodic</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">atoms_or_molecule_or_system</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">structures</span><span class="o">.</span><span class="n">Atom</span><span class="p">):</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="n">atoms_or_molecule_or_system</span>
        <span class="n">periodic</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">atoms_or_molecule_or_system</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">structures</span><span class="o">.</span><span class="n">Molecule</span><span class="p">):</span>
        <span class="n">molecules</span> <span class="o">=</span> <span class="n">atoms_or_molecule_or_system</span>
        <span class="n">child_flag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">periodic</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Unable to write cml file = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">))</span>

    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;molecule&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Write crystal information if provided. Assign it is a crystal</span>
    <span class="c1"># if it is periodic</span>
    <span class="k">if</span> <span class="n">periodic</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &lt;crystal&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  &lt;scalar title=&quot;a&quot; units=&quot;units:angstrom&quot;&gt;</span><span class="si">%3.6f</span><span class="s1">&lt;/scalar&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">box_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  &lt;scalar title=&quot;b&quot; units=&quot;units:angstrom&quot;&gt;</span><span class="si">%3.6f</span><span class="s1">&lt;/scalar&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">box_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  &lt;scalar title=&quot;c&quot; units=&quot;units:angstrom&quot;&gt;</span><span class="si">%3.6f</span><span class="s1">&lt;/scalar&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">box_size</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  &lt;scalar title=&quot;alpha&quot; units=&quot;units:degree&quot;&gt;</span><span class="si">%3.6f</span><span class="s1">&lt;/scalar&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">box_angles</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  &lt;scalar title=&quot;beta&quot; units=&quot;units:degree&quot;&gt;</span><span class="si">%3.6f</span><span class="s1">&lt;/scalar&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">box_angles</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  &lt;scalar title=&quot;gamma&quot; units=&quot;units:degree&quot;&gt;</span><span class="si">%3.6f</span><span class="s1">&lt;/scalar&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">box_angles</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &lt;/crystal&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># If writing molecule</span>
    <span class="k">if</span> <span class="n">child_flag</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">mol</span> <span class="ow">in</span> <span class="n">molecules</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  &lt;molecule&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    &lt;atomArray&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="c1"># Switch to 1 indexed instead of 0 indexed</span>
            <span class="n">offset_from_1</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="nb">min</span><span class="p">([</span><span class="n">a</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">mol</span><span class="o">.</span><span class="n">atoms</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">offset_from_1</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">bond_indices</span> <span class="o">=</span> <span class="p">[(</span><span class="n">b</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="n">offset_from_1</span><span class="p">,</span>
                             <span class="n">b</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="n">offset_from_1</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">mol</span><span class="o">.</span><span class="n">bonds</span><span class="p">]</span>
            <span class="n">bond_indices</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">atoms</span><span class="p">):</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;      &lt;atom id=&quot;a</span><span class="si">%d</span><span class="s1">&quot; elementType=&quot;</span><span class="si">%s</span><span class="s1">&quot; x3=&quot;</span><span class="si">%f</span><span class="s1">&quot; y3=&quot;</span><span class="si">%f</span><span class="s1">&quot;</span><span class="se">\</span>
<span class="s1"> z3=&quot;</span><span class="si">%f</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">element</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">z</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;type.charge&#39;</span><span class="p">):</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; formalCharge=&quot;</span><span class="si">%d</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">a</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">charge</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;type_index&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">a</span><span class="o">.</span><span class="n">type_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; label=&quot;</span><span class="si">%d</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">a</span><span class="o">.</span><span class="n">type_index</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">):</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; label=&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">label</span><span class="p">))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;/&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    &lt;/atomArray&gt;</span><span class="se">\n</span><span class="s1">    &lt;bondArray&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">bond_indices</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;      &lt;bond atomRefs2=&quot;a</span><span class="si">%d</span><span class="s1"> a</span><span class="si">%d</span><span class="s1">&quot; order=&quot;1&quot;/&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">pair</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    &lt;/bondArray&gt;</span><span class="se">\n</span><span class="s1">  &lt;/molecule&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;/molecule&gt;&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Switch to 1 indexed instead of 0 indexed</span>
        <span class="n">offset_from_1</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="nb">min</span><span class="p">([</span><span class="n">a</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">offset_from_1</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">bond_indices</span> <span class="o">=</span> <span class="p">[(</span><span class="n">b</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="n">offset_from_1</span><span class="p">,</span>
                         <span class="n">b</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="n">offset_from_1</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bonds</span><span class="p">]</span>
        <span class="n">bond_indices</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="c1"># Write atom information</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &lt;atomArray&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">atoms</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  &lt;atom id=&quot;a</span><span class="si">%d</span><span class="s1">&quot; elementType=&quot;</span><span class="si">%s</span><span class="s1">&quot; x3=&quot;</span><span class="si">%f</span><span class="s1">&quot; y3=&quot;</span><span class="si">%f</span><span class="s1">&quot; z3=&quot;</span><span class="si">%f</span><span class="s1">&quot;&#39;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">element</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">z</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;type.charge&#39;</span><span class="p">):</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; formalCharge=&quot;</span><span class="si">%d</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">a</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">charge</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;type_index&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">a</span><span class="o">.</span><span class="n">type_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; label=&quot;</span><span class="si">%d</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">a</span><span class="o">.</span><span class="n">type_index</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">):</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; label=&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">label</span><span class="p">))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;/&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &lt;/atomArray&gt;</span><span class="se">\n</span><span class="s1"> &lt;bondArray&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">bond_indices</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  &lt;bond atomRefs2=&quot;a</span><span class="si">%d</span><span class="s1"> a</span><span class="si">%d</span><span class="s1">&quot; order=&quot;1&quot;/&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">pair</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &lt;/bondArray&gt;</span><span class="se">\n</span><span class="s1">&lt;/molecule&gt;&#39;</span><span class="p">)</span></div>


<span class="c1"># Imports the atom style dump file from lammps. VMD automatically reads this</span>
<span class="c1"># when labelled as .lammpstrj. Default is to import everything but you will</span>
<span class="c1"># get better performance if you turn off the data you do not need</span>
<div class="viewcode-block" id="read_lammpstrj"><a class="viewcode-back" href="../codebase.html#files.read_lammpstrj">[docs]</a><span class="k">def</span> <span class="nf">read_lammpstrj</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">read_atoms</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">read_timesteps</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">read_num_atoms</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">read_box_bounds</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">last_frame</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">big_file</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Imports the atom style dump file from lammps.</span>

<span class="sd">    **Parameters**</span>

<span class="sd">        name: *str*</span>
<span class="sd">            Name of the .lammpstrj file to be read in. NOTE, this file MUST</span>
<span class="sd">            have the extension .lammpstrj.</span>
<span class="sd">        read_atoms: *bool, optional*</span>
<span class="sd">            Whether to read in the atomic information (True), or not (False).</span>
<span class="sd">        read_timesteps: *bool, optional*</span>
<span class="sd">            Whether to read in the timesteps (True), or not (False).</span>
<span class="sd">        read_num_atoms: *bool, optional*</span>
<span class="sd">            Whether to read in the number of atoms (True), or not (False).</span>
<span class="sd">        read_box_bounds: *bool, optional*</span>
<span class="sd">            Whether to read in the system box boundaries (True), or not</span>
<span class="sd">            (False).</span>
<span class="sd">        verbose: *bool, optional*</span>
<span class="sd">            Whether to output more to stdout (True), or not (False).</span>
<span class="sd">        last_frame: *bool, optional*</span>
<span class="sd">            Whether to output only the last iteration of the simulation</span>
<span class="sd">            (True), or all of it (False).</span>
<span class="sd">        big_file: *bool, optional*</span>
<span class="sd">            Whether to read through the file line-by-line to allow for reading</span>
<span class="sd">            of large files (True), or not (False). If True, this read</span>
<span class="sd">            operation will be slower.</span>

<span class="sd">    **Returns**</span>

<span class="sd">        data: :class:`results.sim_out`</span>
<span class="sd">            Return a sim_out object containing simulation output information.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Unless big_file flag is set to False, send all read_lammpstrj requests</span>
    <span class="c1"># to _read_lammpstrj_big</span>
    <span class="k">if</span> <span class="n">big_file</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_read_lammpstrj_big</span><span class="p">(</span><span class="n">name</span><span class="p">,</span>
                                   <span class="n">read_atoms</span><span class="o">=</span><span class="n">read_atoms</span><span class="p">,</span>
                                   <span class="n">read_timesteps</span><span class="o">=</span><span class="n">read_timesteps</span><span class="p">,</span>
                                   <span class="n">read_num_atoms</span><span class="o">=</span><span class="n">read_num_atoms</span><span class="p">,</span>
                                   <span class="n">read_box_bounds</span><span class="o">=</span><span class="n">read_box_bounds</span><span class="p">,</span>
                                   <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                                   <span class="n">last_frame</span><span class="o">=</span><span class="n">last_frame</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.lammpstrj&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;.&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">+=</span> <span class="s1">&#39;.lammpstrj&#39;</span>
    <span class="c1"># If file does not exist, return empty lammpstrj object</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
        <span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Expected lammps trajectory file does not exist at </span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">&#39;</span>
             <span class="o">%</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">name</span><span class="p">))</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="c1"># Compile data from only the last frame if last_frame=True</span>
    <span class="k">if</span> <span class="n">last_frame</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;ITEM: TIMESTEP&#39;</span>
        <span class="n">section</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">s</span> <span class="ow">in</span> <span class="n">section</span><span class="p">):</span>
            <span class="n">section</span> <span class="o">=</span> <span class="n">section</span><span class="p">[</span><span class="n">section</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):]</span>

        <span class="c1"># Rewrite data to only include last frame</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">section</span>

    <span class="c1"># Determine coordinate type</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">read_atoms</span><span class="p">:</span>
        <span class="n">section</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">if</span> <span class="s1">&#39;x y z&#39;</span> <span class="ow">in</span> <span class="n">section</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: Reading wrapped, unscaled atom coordinates&#39;</span>
                      <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">))</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="s1">&#39;x y z&#39;</span>

        <span class="k">elif</span> <span class="s1">&#39;xs ys zs&#39;</span> <span class="ow">in</span> <span class="n">section</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: Reading warpped, scaled atom coordinates&#39;</span>
                      <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">))</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="s1">&#39;xs ys zs&#39;</span>

        <span class="k">elif</span> <span class="s1">&#39;xu yu zu&#39;</span> <span class="ow">in</span> <span class="n">section</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: Reading unwrapped, unscaled atom coordinates&#39;</span>
                      <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">))</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="s1">&#39;xu yu zu&#39;</span>

        <span class="k">elif</span> <span class="s1">&#39;xsu ysu zsu&#39;</span> <span class="ow">in</span> <span class="n">section</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: Reading unwrapped, scaled atom coordinates&#39;</span>
                      <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">))</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="s1">&#39;xsu ysu zsu&#39;</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No valid coordinates found&#39;</span><span class="p">)</span>

    <span class="c1"># Get all the positions</span>
    <span class="n">section</span><span class="p">,</span> <span class="n">frames</span> <span class="o">=</span> <span class="n">data</span><span class="p">,</span> <span class="p">[]</span>
    <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;ITEM: ATOMS id type &#39;</span> <span class="o">+</span> <span class="n">coords</span>
    <span class="n">pass25</span><span class="p">,</span> <span class="n">pass50</span><span class="p">,</span> <span class="n">pass75</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span>
    <span class="k">while</span> <span class="n">read_atoms</span> <span class="ow">and</span> <span class="p">(</span><span class="n">s</span> <span class="ow">in</span> <span class="n">section</span><span class="p">):</span>
        <span class="n">section</span> <span class="o">=</span> <span class="n">section</span><span class="p">[</span><span class="n">section</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):]</span>
        <span class="n">atom_block</span> <span class="o">=</span> <span class="n">section</span><span class="p">[:</span><span class="n">section</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">ITEM: TIMESTEP&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">atom_block</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

            <span class="c1"># Check if atom has expected number of characteristics</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">frame</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">structures</span><span class="o">.</span><span class="n">Atom</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                             <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                                             <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
                                             <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span>
                                             <span class="n">index</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Atom skipped due to missing information&#39;</span><span class="p">)</span>

        <span class="n">frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

        <span class="c1"># Output how far along the file has been read</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="n">progress</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">section</span><span class="p">))</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span> <span class="o">*</span> <span class="mi">100</span>
            <span class="k">if</span> <span class="n">pass25</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">progress</span> <span class="o">&gt;</span> <span class="mf">25.0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: 25</span><span class="si">%%</span><span class="s1"> read&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">))</span>
                <span class="n">pass25</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">pass50</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">progress</span> <span class="o">&gt;</span> <span class="mf">50.0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: 50</span><span class="si">%%</span><span class="s1"> read&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">))</span>
                <span class="n">pass50</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">pass75</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">progress</span> <span class="o">&gt;</span> <span class="mf">75.0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: 75</span><span class="si">%%</span><span class="s1"> read&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">))</span>
                <span class="n">pass75</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Output after reading atom coordinates</span>
    <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="n">pass25</span> <span class="ow">and</span> <span class="n">pass50</span> <span class="ow">and</span> <span class="n">pass75</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: 100</span><span class="si">%%</span><span class="s1"> read&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">frames</span><span class="p">:</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="n">frames</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Get all timesteps</span>
    <span class="n">section</span><span class="p">,</span> <span class="n">timesteps</span> <span class="o">=</span> <span class="n">data</span><span class="p">,</span> <span class="p">[]</span>
    <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;ITEM: TIMESTEP&#39;</span>
    <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="n">read_timesteps</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reading timesteps&#39;</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">read_timesteps</span> <span class="ow">and</span> <span class="p">(</span><span class="n">s</span> <span class="ow">in</span> <span class="n">section</span><span class="p">):</span>
        <span class="n">num</span> <span class="o">=</span> <span class="n">section</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
        <span class="n">section</span> <span class="o">=</span> <span class="n">section</span><span class="p">[</span><span class="n">num</span><span class="p">:]</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">section</span><span class="p">[:</span><span class="n">section</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">ITEM: NUMBER OF ATOMS&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">tmp</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">timesteps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">timesteps</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">final_timestep</span> <span class="o">=</span> <span class="n">timesteps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">final_timestep</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Get number of atoms. Useful if number of atoms change during simulation,</span>
    <span class="c1"># such as during a deposition</span>
    <span class="n">section</span><span class="p">,</span> <span class="n">atom_counts</span> <span class="o">=</span> <span class="n">data</span><span class="p">,</span> <span class="p">[]</span>
    <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;ITEM: NUMBER OF ATOMS&#39;</span>
    <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="n">read_num_atoms</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reading number of atoms&#39;</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">read_num_atoms</span> <span class="ow">and</span> <span class="p">(</span><span class="n">s</span> <span class="ow">in</span> <span class="n">section</span><span class="p">):</span>
        <span class="n">section</span> <span class="o">=</span> <span class="n">section</span><span class="p">[</span><span class="n">section</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):]</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">section</span><span class="p">[:</span><span class="n">section</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">ITEM: BOX BOUNDS&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">tmp</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">atom_counts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">atom_counts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">atom_count</span> <span class="o">=</span> <span class="n">atom_counts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">atom_count</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Get box bounds</span>
    <span class="c1"># Currently only imports orthorhombic crystal information aka all</span>
    <span class="c1"># angles = 90 degrees</span>
    <span class="n">section</span><span class="p">,</span> <span class="n">box_bounds_list</span> <span class="o">=</span> <span class="n">data</span><span class="p">,</span> <span class="p">[]</span>
    <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;ITEM: BOX BOUNDS&#39;</span>
    <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="n">read_box_bounds</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reading box bounds&#39;</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">read_box_bounds</span> <span class="ow">and</span> <span class="p">(</span><span class="n">s</span> <span class="ow">in</span> <span class="n">section</span><span class="p">):</span>
        <span class="n">section</span> <span class="o">=</span> <span class="n">section</span><span class="p">[</span><span class="n">section</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):]</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">section</span><span class="p">[:</span><span class="n">section</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">ITEM: ATOMS&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">box_bounds</span> <span class="o">=</span> <span class="n">structures</span><span class="o">.</span><span class="n">Struct</span><span class="p">(</span><span class="n">xlo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xhi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                       <span class="n">yhi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zlo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zhi</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">tmp</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">box_bounds</span><span class="o">.</span><span class="n">xlo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">box_bounds</span><span class="o">.</span><span class="n">xlo</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">box_bounds</span><span class="o">.</span><span class="n">xhi</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">box_bounds</span><span class="o">.</span><span class="n">ylo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">box_bounds</span><span class="o">.</span><span class="n">ylo</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">box_bounds</span><span class="o">.</span><span class="n">yhi</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">box_bounds</span><span class="o">.</span><span class="n">zlo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">box_bounds</span><span class="o">.</span><span class="n">zlo</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">box_bounds</span><span class="o">.</span><span class="n">zhi</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">box_bounds_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">box_bounds</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">box_bounds_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">box_bounds</span> <span class="o">=</span> <span class="n">box_bounds_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">box_bounds</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Create object to store all results</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">sim_out</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;lammps&#39;</span><span class="p">)</span>

    <span class="c1"># Record all lammps trajectory data into results object</span>
    <span class="n">data</span><span class="o">.</span><span class="n">frames</span> <span class="o">=</span> <span class="n">frames</span>
    <span class="n">data</span><span class="o">.</span><span class="n">atoms</span> <span class="o">=</span> <span class="n">atoms</span>
    <span class="n">data</span><span class="o">.</span><span class="n">timesteps</span> <span class="o">=</span> <span class="n">timesteps</span>
    <span class="n">data</span><span class="o">.</span><span class="n">final_timestep</span> <span class="o">=</span> <span class="n">final_timestep</span>
    <span class="n">data</span><span class="o">.</span><span class="n">atom_counts</span> <span class="o">=</span> <span class="n">atom_counts</span>
    <span class="n">data</span><span class="o">.</span><span class="n">atom_count</span> <span class="o">=</span> <span class="n">atom_count</span>
    <span class="n">data</span><span class="o">.</span><span class="n">box_bounds_list</span> <span class="o">=</span> <span class="n">box_bounds_list</span>
    <span class="n">data</span><span class="o">.</span><span class="n">box_bounds</span> <span class="o">=</span> <span class="n">box_bounds</span>
    <span class="c1"># Stores when lammpstrj was last modified in seconds</span>
    <span class="n">data</span><span class="o">.</span><span class="n">last_modified</span> <span class="o">=</span> <span class="s1">&#39;Null&#39;</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># Imports the atom style dump file from lammps. VMD automatically reads this</span>
<span class="c1"># when labelled as .lammpstrj. Default is to import everything but you will</span>
<span class="c1"># get better performance if you turn off the data you do not need</span>
<span class="k">def</span> <span class="nf">_read_lammpstrj_big</span><span class="p">(</span><span class="n">name</span><span class="p">,</span>
                        <span class="n">read_atoms</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">read_timesteps</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">read_num_atoms</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">read_box_bounds</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">last_frame</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function for read_lammpstrj to read in larger files.</span>

<span class="sd">    **Parameters**</span>

<span class="sd">        name: *str*</span>
<span class="sd">            Name of the .lammpstrj file to be read in. NOTE, this file MUST</span>
<span class="sd">            have the extension .lammpstrj.</span>
<span class="sd">        read_atoms: *bool, optional*</span>
<span class="sd">            Whether to read in the atomic information (True), or not (False).</span>
<span class="sd">        read_timesteps: *bool, optional*</span>
<span class="sd">            Whether to read in the timesteps (True), or not (False).</span>
<span class="sd">        read_num_atoms: *bool, optional*</span>
<span class="sd">            Whether to read in the number of atoms (True), or not (False).</span>
<span class="sd">        read_box_bounds: *bool, optional*</span>
<span class="sd">            Whether to read in the system box boundaries (True), or not</span>
<span class="sd">            (False).</span>
<span class="sd">        verbose: *bool, optional*</span>
<span class="sd">            Whether to output more to stdout (True), or not (False).</span>
<span class="sd">        last_frame: *bool, optional*</span>
<span class="sd">            Whether to output only the last iteration of the simulation</span>
<span class="sd">            (True), or all of it (False).</span>

<span class="sd">    **Returns**</span>

<span class="sd">        data: :class:`results.sim_out`</span>
<span class="sd">            Return a sim_out object containing simulation output information.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.lammpstrj&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;.&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">+=</span> <span class="s1">&#39;.lammpstrj&#39;</span>
    <span class="c1"># If file does not exist, return empty lammpstrj object</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
        <span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Expected lammps trajectory file does not exist at </span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">&#39;</span>
             <span class="o">%</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">name</span><span class="p">))</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="c1"># Initialize embarrassedly</span>
    <span class="n">timesteps</span><span class="p">,</span> <span class="n">atom_counts</span><span class="p">,</span> <span class="n">box_bounds_list</span><span class="p">,</span> <span class="n">frames</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

    <span class="c1"># Use these flags to determine what section you are in</span>
    <span class="n">sect_timesteps</span><span class="p">,</span> <span class="n">sect_num_atoms</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span>
    <span class="n">sect_box_bounds</span><span class="p">,</span> <span class="n">sect_atoms</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span>

    <span class="c1"># Flag to keep track if this is the first step analyzed</span>
    <span class="n">first_step</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">skip_set</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">skip_count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">frame</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Iterate file line by line. This reduces the memory required since it</span>
    <span class="c1"># only loads the current line</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>

            <span class="c1"># Check for new section</span>
            <span class="k">if</span> <span class="s1">&#39;ITEM: TIMESTEP&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="c1"># If skipped previous frame, reset skip counter</span>
                <span class="k">if</span> <span class="n">skip_count</span> <span class="o">==</span> <span class="nb">max</span><span class="p">(</span><span class="n">skip_set</span><span class="p">):</span>
                    <span class="n">skip_count</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="c1"># Increment skip counter and skip if necessary</span>
                <span class="n">skip_count</span> <span class="o">=</span> <span class="n">skip_count</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">skip_count</span> <span class="ow">in</span> <span class="n">skip_set</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="n">sect_timesteps</span><span class="p">,</span> <span class="n">sect_num_atoms</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span>
                <span class="n">sect_box_bounds</span><span class="p">,</span> <span class="n">sect_atoms</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span>
                <span class="n">sect_timesteps</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="c1"># Add previous timestep to list of frames. Do not try for</span>
                <span class="c1"># first time step. Do not add if only looking for final frame</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">first_step</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">last_frame</span><span class="p">:</span>
                    <span class="n">frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

                <span class="k">continue</span>

            <span class="c1"># If it is not the timestep section, and a skip has triggered,</span>
            <span class="c1"># skip all lines till next timestep</span>
            <span class="k">elif</span> <span class="n">skip_count</span> <span class="ow">in</span> <span class="n">skip_set</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">elif</span> <span class="s1">&#39;ITEM: NUMBER OF ATOMS&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">sect_timesteps</span><span class="p">,</span> <span class="n">sect_num_atoms</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span>
                <span class="n">sect_box_bounds</span><span class="p">,</span> <span class="n">sect_atoms</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span>
                <span class="n">sect_num_atoms</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">continue</span>

            <span class="k">elif</span> <span class="s1">&#39;ITEM: BOX BOUNDS&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">sect_timesteps</span><span class="p">,</span> <span class="n">sect_num_atoms</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span>
                <span class="n">sect_box_bounds</span><span class="p">,</span> <span class="n">sect_atoms</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span>
                <span class="n">sect_box_bounds</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">box_bounds</span> <span class="o">=</span> <span class="n">structures</span><span class="o">.</span><span class="n">Struct</span><span class="p">(</span><span class="n">xlo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xhi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                               <span class="n">yhi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zlo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zhi</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="k">elif</span> <span class="s1">&#39;ITEM: ATOMS id type &#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">sect_timesteps</span><span class="p">,</span> <span class="n">sect_num_atoms</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span>
                <span class="n">sect_box_bounds</span><span class="p">,</span> <span class="n">sect_atoms</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span>
                <span class="n">sect_atoms</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">box_bounds_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">box_bounds</span><span class="p">)</span>
                <span class="n">frame</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="c1"># If this is the first time step analyzed, report the</span>
                <span class="c1"># coordinates style</span>
                <span class="k">if</span> <span class="n">first_step</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;x y z&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: Reading wrapped, unscaled atom coordinate&#39;</span>
                              <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">))</span>

                    <span class="k">elif</span> <span class="s1">&#39;xs ys zs&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: Reading wrapped, scaled atom coordinate&#39;</span>
                              <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">))</span>

                    <span class="k">elif</span> <span class="s1">&#39;xu yu zu&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: Reading unwrapped, unscaled atom coordinate&#39;</span>
                              <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">))</span>

                    <span class="k">elif</span> <span class="s1">&#39;xsu ysu zsu&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: Reading unwrapped, scaled atom coordinate&#39;</span>
                              <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">))</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No valid coordinate found&#39;</span><span class="p">)</span>

                <span class="n">first_step</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">continue</span>

            <span class="c1"># Record information as required by the section</span>
            <span class="k">if</span> <span class="n">sect_timesteps</span> <span class="ow">and</span> <span class="n">read_timesteps</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">timesteps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

            <span class="k">if</span> <span class="n">sect_num_atoms</span> <span class="ow">and</span> <span class="n">read_num_atoms</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">atom_counts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

            <span class="k">if</span> <span class="n">sect_box_bounds</span> <span class="ow">and</span> <span class="n">read_box_bounds</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">box_bounds</span><span class="o">.</span><span class="n">xlo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">box_bounds</span><span class="o">.</span><span class="n">xlo</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">box_bounds</span><span class="o">.</span><span class="n">xhi</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">box_bounds</span><span class="o">.</span><span class="n">ylo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">box_bounds</span><span class="o">.</span><span class="n">ylo</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">box_bounds</span><span class="o">.</span><span class="n">yhi</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">box_bounds</span><span class="o">.</span><span class="n">zlo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">box_bounds</span><span class="o">.</span><span class="n">zlo</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">box_bounds</span><span class="o">.</span><span class="n">zhi</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">sect_atoms</span> <span class="ow">and</span> <span class="n">read_atoms</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

                <span class="c1"># Check if atom has expected number of characteristics</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                    <span class="n">frame</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">structures</span><span class="o">.</span><span class="n">Atom</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                 <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                                                 <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
                                                 <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span>
                                                 <span class="n">index</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Atom skipped due to missing information&#39;</span><span class="p">)</span>

    <span class="c1"># Add final frame</span>
    <span class="n">frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

    <span class="c1"># Record final data point as necessary</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">timesteps</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">final_timestep</span> <span class="o">=</span> <span class="n">timesteps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">final_timestep</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">atom_counts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">atom_count</span> <span class="o">=</span> <span class="n">atom_counts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">atom_count</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">box_bounds_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">box_bounds</span> <span class="o">=</span> <span class="n">box_bounds_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">box_bounds</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">frames</span><span class="p">:</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="n">frames</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># If only looking for final frame, erase all other timesteps</span>
    <span class="k">if</span> <span class="n">last_frame</span><span class="p">:</span>
        <span class="n">timesteps</span> <span class="o">=</span> <span class="p">[</span><span class="n">timesteps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">atom_counts</span> <span class="o">=</span> <span class="p">[</span><span class="n">atom_counts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">box_bounds_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">box_bounds_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">frames</span> <span class="o">=</span> <span class="p">[</span><span class="n">frames</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

    <span class="c1"># Create object to store all results</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">sim_out</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;lammps&#39;</span><span class="p">)</span>

    <span class="c1"># Record all lammps trajectory data into results object</span>
    <span class="n">data</span><span class="o">.</span><span class="n">frames</span> <span class="o">=</span> <span class="n">frames</span>
    <span class="n">data</span><span class="o">.</span><span class="n">atoms</span> <span class="o">=</span> <span class="n">atoms</span>
    <span class="n">data</span><span class="o">.</span><span class="n">timesteps</span> <span class="o">=</span> <span class="n">timesteps</span>
    <span class="n">data</span><span class="o">.</span><span class="n">final_timestep</span> <span class="o">=</span> <span class="n">final_timestep</span>
    <span class="n">data</span><span class="o">.</span><span class="n">atom_counts</span> <span class="o">=</span> <span class="n">atom_counts</span>
    <span class="n">data</span><span class="o">.</span><span class="n">atom_count</span> <span class="o">=</span> <span class="n">atom_count</span>
    <span class="n">data</span><span class="o">.</span><span class="n">box_bounds_list</span> <span class="o">=</span> <span class="n">box_bounds_list</span>
    <span class="n">data</span><span class="o">.</span><span class="n">box_bounds</span> <span class="o">=</span> <span class="n">box_bounds</span>
    <span class="c1"># Stores when lammpstrj was last modified in seconds</span>
    <span class="n">data</span><span class="o">.</span><span class="n">last_modified</span> <span class="o">=</span> <span class="s1">&#39;Null&#39;</span>

    <span class="k">return</span> <span class="n">data</span>


<span class="c1"># Write lammpstrj file from system or from atom frames. Currently supports:</span>
<span class="c1"># id, type, x, xs, xu, xsu, vx, fx</span>
<span class="c1"># VMD automatically reads this when labelled as .lammpstrj</span>
<span class="k">def</span> <span class="nf">write_lammpstrj</span><span class="p">(</span><span class="n">frames_or_system</span><span class="p">,</span> <span class="n">name_or_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timesteps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">box_bounds_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="s1">&#39;id type x y z&#39;</span><span class="p">):</span>
    <span class="c1"># Set to default filename if not set (out.lammpstrj)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">name_or_file</span><span class="p">:</span>
        <span class="n">name_or_file</span> <span class="o">=</span> <span class="s1">&#39;out&#39;</span>

    <span class="c1"># If filename is provided, open it</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">name_or_file</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name_or_file</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.lammpstrj&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="c1"># If open file is provided, just append to it</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">name_or_file</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Writing lammpstrj: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">attrs</span><span class="p">))</span>

    <span class="c1"># Determine whether input is an atom list (frames) or a system object</span>
    <span class="c1"># If it is a system object, compile information to write lammpstrj file</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">frames_or_system</span><span class="p">,</span> <span class="n">structures</span><span class="o">.</span><span class="n">System</span><span class="p">):</span>
        <span class="n">system</span> <span class="o">=</span> <span class="n">frames_or_system</span>
        <span class="n">frames</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">atoms</span>
        <span class="n">box_bounds_list</span> <span class="o">=</span> <span class="n">structures</span><span class="o">.</span><span class="n">Struct</span><span class="p">(</span><span class="n">xlo</span><span class="o">=</span><span class="n">system</span><span class="o">.</span><span class="n">xlo</span><span class="p">,</span>
                                            <span class="n">xhi</span><span class="o">=</span><span class="n">system</span><span class="o">.</span><span class="n">xhi</span><span class="p">,</span>
                                            <span class="n">ylo</span><span class="o">=</span><span class="n">system</span><span class="o">.</span><span class="n">ylo</span><span class="p">,</span>
                                            <span class="n">yhi</span><span class="o">=</span><span class="n">system</span><span class="o">.</span><span class="n">yhi</span><span class="p">,</span>
                                            <span class="n">zlo</span><span class="o">=</span><span class="n">system</span><span class="o">.</span><span class="n">zlo</span><span class="p">,</span>
                                            <span class="n">zhi</span><span class="o">=</span><span class="n">system</span><span class="o">.</span><span class="n">zhi</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">frames</span> <span class="o">=</span> <span class="n">frames_or_system</span>

    <span class="c1"># Create default box_bounds_list if it was not previously initialized</span>
    <span class="k">if</span> <span class="n">box_bounds_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">box_bounds_list</span> <span class="o">=</span> <span class="n">structures</span><span class="o">.</span><span class="n">Struct</span><span class="p">(</span><span class="n">xlo</span><span class="o">=-</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">xhi</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">ylo</span><span class="o">=-</span><span class="mf">10.0</span><span class="p">,</span>
                                            <span class="n">yhi</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">zlo</span><span class="o">=-</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">zhi</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>

    <span class="c1"># Convert to list of frames if it is not</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">frames</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">structures</span><span class="o">.</span><span class="n">Atom</span><span class="p">):</span>
        <span class="n">frames</span> <span class="o">=</span> <span class="p">[</span><span class="n">frames</span><span class="p">]</span>

    <span class="c1"># Convert to list of box_bounds if it is not</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">box_bounds_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">structures</span><span class="o">.</span><span class="n">Struct</span><span class="p">):</span>
        <span class="n">box_bounds_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">box_bounds_list</span><span class="p">]</span>

    <span class="c1"># Define default timesteps and and expand box_bounds_list to equal number</span>
    <span class="c1"># of timesteps if necessary</span>
    <span class="k">if</span> <span class="n">timesteps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">timesteps</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">frames</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">box_bounds_list</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">timesteps</span><span class="p">):</span>
        <span class="n">constant_box_bounds</span> <span class="o">=</span> <span class="n">box_bounds_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">box_bounds_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">constant_box_bounds</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">timesteps</span><span class="p">]</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="n">timestep</span><span class="p">,</span> <span class="n">box_bounds</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">frames</span><span class="p">,</span>
                                             <span class="n">timesteps</span><span class="p">,</span>
                                             <span class="n">box_bounds_list</span><span class="p">):</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;ITEM: TIMESTEP</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">timestep</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;ITEM: NUMBER OF ATOMS</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atoms</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;ITEM: BOX BOUNDS pp pp pp</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%3.5f</span><span class="s1"> </span><span class="si">%3.5f</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">box_bounds</span><span class="o">.</span><span class="n">xlo</span><span class="p">,</span> <span class="n">box_bounds</span><span class="o">.</span><span class="n">xhi</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%3.5f</span><span class="s1"> </span><span class="si">%3.5f</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">box_bounds</span><span class="o">.</span><span class="n">ylo</span><span class="p">,</span> <span class="n">box_bounds</span><span class="o">.</span><span class="n">yhi</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%3.5f</span><span class="s1"> </span><span class="si">%3.5f</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">box_bounds</span><span class="o">.</span><span class="n">zlo</span><span class="p">,</span> <span class="n">box_bounds</span><span class="o">.</span><span class="n">zhi</span><span class="p">))</span>
        <span class="n">atom_attrs</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ITEM: ATOMS &quot;</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span>
                                           <span class="o">%</span> <span class="p">(</span><span class="n">attr</span><span class="p">)</span>
                                           <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">atom_attrs</span><span class="p">]))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">atom_attrs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">attr</span> <span class="o">==</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">element</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;xs&#39;</span><span class="p">,</span> <span class="s1">&#39;xu&#39;</span><span class="p">,</span> <span class="s1">&#39;xsu&#39;</span><span class="p">]:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%3.5f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">x</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;ys&#39;</span><span class="p">,</span> <span class="s1">&#39;yu&#39;</span><span class="p">,</span> <span class="s1">&#39;ysu&#39;</span><span class="p">]:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%3.5f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;zs&#39;</span><span class="p">,</span> <span class="s1">&#39;zu&#39;</span><span class="p">,</span> <span class="s1">&#39;zsu&#39;</span><span class="p">]:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%3.5f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">z</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s1">&#39;vx&#39;</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%3.5f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">vx</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s1">&#39;vy&#39;</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%3.5f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">vy</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s1">&#39;vz&#39;</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%3.5f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">vz</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s1">&#39;fx&#39;</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%3.5f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">fx</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s1">&#39;fy&#39;</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%3.5f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">fy</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s1">&#39;fz&#39;</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%3.5f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">fz</span><span class="p">))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Close file if it was opened outside of this function</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">name_or_file</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<div class="viewcode-block" id="read_xyz"><a class="viewcode-back" href="../codebase.html#files.read_xyz">[docs]</a><span class="k">def</span> <span class="nf">read_xyz</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read in a file written in the XYZ file format.</span>

<span class="sd">    **Parameters**</span>

<span class="sd">        name: *str*</span>
<span class="sd">            File name with or without .xyz file extension.</span>

<span class="sd">    **Returns**</span>

<span class="sd">        frames: *list, list,* :class:`structures.Atom`</span>
<span class="sd">            A list of atoms read in from the xyz file.  If there is only one</span>
<span class="sd">            frame, then only a *list* of :class:`structures.Atom` is returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.xyz&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;.&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">+=</span> <span class="s1">&#39;.xyz&#39;</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">atom_count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">lines_by_frame</span> <span class="o">=</span> <span class="p">[</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">atom_count</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>
                      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span> <span class="n">atom_count</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)]</span>

    <span class="n">frames</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">lines_by_frame</span><span class="p">:</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">frame</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]]</span>
                <span class="n">atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">structures</span><span class="o">.</span><span class="n">Atom</span><span class="p">(</span><span class="n">element</span><span class="o">=</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                             <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span>
                                             <span class="n">index</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">frames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">frames</span></div>


<div class="viewcode-block" id="read_xyz_2"><a class="viewcode-back" href="../codebase.html#files.read_xyz_2">[docs]</a><span class="k">def</span> <span class="nf">read_xyz_2</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;element&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read in a file written in the XYZ file format.  This is an improved</span>
<span class="sd">    version, accounting for xyz files of varying atom numbers.</span>

<span class="sd">    **Parameters**</span>

<span class="sd">        name: *str*</span>
<span class="sd">            File name with or without .xyz file extension.</span>

<span class="sd">    **Returns**</span>

<span class="sd">        frames: *list, list,* :class:`structures.Atom`</span>
<span class="sd">            A list of atoms read in from the xyz file.  If there is only one</span>
<span class="sd">            frame, then only a *list* of :class:`structures.Atom` is returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.xyz&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;.&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">+=</span> <span class="s1">&#39;.xyz&#39;</span>

    <span class="n">frames</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">index</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">N</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">skip_comment</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">skip_comment</span><span class="p">:</span>
            <span class="n">skip_comment</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">continue</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">N</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">N</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">skip_comment</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
                <span class="n">frame</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">index</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">continue</span>

        <span class="n">element</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>
        <span class="k">if</span> <span class="s2">&quot;element&quot;</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
            <span class="n">element</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">elem_i2s</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">cols</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;element&quot;</span><span class="p">)])</span>
        <span class="k">if</span> <span class="s2">&quot;x&quot;</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">cols</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)])</span>
        <span class="k">if</span> <span class="s2">&quot;y&quot;</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">cols</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)])</span>
        <span class="k">if</span> <span class="s2">&quot;z&quot;</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
            <span class="n">z</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">cols</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">)])</span>
        <span class="n">frame</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">structures</span><span class="o">.</span><span class="n">Atom</span><span class="p">(</span><span class="n">element</span><span class="o">=</span><span class="n">element</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">))</span>
        <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">N</span> <span class="o">-=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">frames</span></div>


<div class="viewcode-block" id="write_xyz"><a class="viewcode-back" href="../codebase.html#files.write_xyz">[docs]</a><span class="k">def</span> <span class="nf">write_xyz</span><span class="p">(</span><span class="n">frames_or_system</span><span class="p">,</span> <span class="n">name_or_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ID</span><span class="o">=</span><span class="s1">&#39;Atoms&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write frames of atomic conformations to a file written in the XYZ file</span>
<span class="sd">    format.</span>

<span class="sd">    **Parameters**</span>

<span class="sd">        frames_or_system: *list,* :class:`structures.Atom` *or* :class:`structures.System`</span>
<span class="sd">            Atoms to be written to an xyz file.</span>
<span class="sd">        name_or_file: *str or fptr, optional*</span>
<span class="sd">            Either a filename (with or without the .xyz extension) or an open</span>
<span class="sd">            file buffer to write the xyz file.</span>
<span class="sd">        ID: *str, optional*</span>
<span class="sd">            What is to be written on the xyz comment line.</span>

<span class="sd">    **Returns**</span>

<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Determine whether input is an atom list (frames) or a system object</span>
    <span class="c1"># If it is a system object, compile information to write xyz file</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">frames_or_system</span><span class="p">,</span> <span class="n">structures</span><span class="o">.</span><span class="n">System</span><span class="p">):</span>
        <span class="n">system</span> <span class="o">=</span> <span class="n">frames_or_system</span>
        <span class="n">frames</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">atoms</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">frames_or_system</span><span class="p">,</span> <span class="n">structures</span><span class="o">.</span><span class="n">Molecule</span><span class="p">):</span>
        <span class="n">frames</span> <span class="o">=</span> <span class="p">[</span><span class="n">frames_or_system</span><span class="o">.</span><span class="n">atoms</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">frames</span> <span class="o">=</span> <span class="n">frames_or_system</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">name_or_file</span><span class="p">:</span>
        <span class="n">name_or_file</span> <span class="o">=</span> <span class="s1">&#39;out&#39;</span>

    <span class="c1"># if filename is provided, open it</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">name_or_file</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name_or_file</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.xyz&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;.&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">+=</span> <span class="s1">&#39;.xyz&#39;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="c1"># if open file is provided, just append to it</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">name_or_file</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">frames</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">structures</span><span class="o">.</span><span class="n">Atom</span><span class="p">):</span>
        <span class="c1"># we want to write a list of frames, so make it one</span>
        <span class="n">frames</span> <span class="o">=</span> <span class="p">[</span><span class="n">frames</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">atoms</span> <span class="ow">in</span> <span class="n">frames</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atoms</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">ID</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%f</span><span class="s1"> </span><span class="si">%f</span><span class="s1"> </span><span class="si">%f</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">element</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">z</span><span class="p">))</span>

    <span class="c1"># close file if we opened it</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">name_or_file</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="read_mdl"><a class="viewcode-back" href="../codebase.html#files.read_mdl">[docs]</a><span class="k">def</span> <span class="nf">read_mdl</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read in a file written in the molden file format.</span>

<span class="sd">    **Parameters**</span>

<span class="sd">        name: *str*</span>
<span class="sd">            File name with or without .mdl file extension.</span>

<span class="sd">    **Returns**</span>

<span class="sd">        frames: *list, list,* :class:`structures.Atom`</span>
<span class="sd">            A list of atoms read in from the xyz file.  If there is only one</span>
<span class="sd">            frame, then only a *list* of :class:`structures.Atom` is returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.mdl&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;.&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">+=</span> <span class="s1">&#39;.mdl&#39;</span>

    <span class="n">frames</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">read_flag</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;[ATOMS]&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">read_flag</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="s2">&quot;[&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">frame</span><span class="p">))</span>
                <span class="n">frame</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">read_flag</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">read_flag</span><span class="p">:</span>
            <span class="n">element</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">frame</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">structures</span><span class="o">.</span><span class="n">Atom</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
            <span class="p">)</span>

    <span class="k">return</span> <span class="n">frames</span></div>


<div class="viewcode-block" id="write_mdl"><a class="viewcode-back" href="../codebase.html#files.write_mdl">[docs]</a><span class="k">def</span> <span class="nf">write_mdl</span><span class="p">(</span><span class="n">frames</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;This code has yet to be written!&quot;</span><span class="p">)</span></div>


<span class="c1"># Imports the full atom style lammps data file.</span>
<span class="c1"># Default is to import everything but you might get better performance if you</span>
<span class="c1"># turn off the data you do not need</span>
<div class="viewcode-block" id="read_lammps_data"><a class="viewcode-back" href="../codebase.html#files.read_lammps_data">[docs]</a><span class="k">def</span> <span class="nf">read_lammps_data</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">read_atoms</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">read_bonds</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                     <span class="n">read_angles</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">read_dihedrals</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function for read_lammpstrj to read in larger files.</span>

<span class="sd">    **Parameters**</span>

<span class="sd">        name: *str*</span>
<span class="sd">            Name of the .lammpstrj file to be read in. NOTE, this file MUST</span>
<span class="sd">            have the extension .lammpstrj.</span>
<span class="sd">        read_atoms: *bool, optional*</span>
<span class="sd">            Whether to read in the atomic information (True), or not (False).</span>
<span class="sd">        read_bonds: *bool, optional*</span>
<span class="sd">            Whether to read in the bond information (True), or not (False).</span>
<span class="sd">        read_angles: *bool, optional*</span>
<span class="sd">            Whether to read in the angle information (True), or not (False).</span>
<span class="sd">        read_dihedrals: *bool, optional*</span>
<span class="sd">            Whether to read in the dihedral information (True), or not</span>
<span class="sd">            (False).</span>

<span class="sd">    **Returns**</span>

<span class="sd">        atoms: *list,* :class:`structures.Atom`</span>
<span class="sd">            A list of atoms read in from the data file.</span>
<span class="sd">        bonds: *list,* :class:`structures.Bond`</span>
<span class="sd">            A list of bonds read in from the data file.</span>
<span class="sd">        angles: *list,* :class:`structures.Angle`</span>
<span class="sd">            A list of angles read in from the data file.</span>
<span class="sd">        dihedrals: *list,* :class:`structures.Dihedral`</span>
<span class="sd">            A list of dihedrals read in from the data file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.data&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;.&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">+=</span> <span class="s1">&#39;.data&#39;</span>
    <span class="c1"># If file does not exist, return empty lammpstrj object</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
        <span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Expected lammps data file does not exist at </span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">&#39;</span>
             <span class="o">%</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">name</span><span class="p">))</span>

    <span class="c1"># Initialize variables</span>
    <span class="n">atom_types</span><span class="p">,</span> <span class="n">bond_types</span><span class="p">,</span> <span class="n">angle_types</span><span class="p">,</span> <span class="n">dihedral_types</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">atoms</span><span class="p">,</span> <span class="n">bonds</span><span class="p">,</span> <span class="n">angles</span><span class="p">,</span> <span class="n">dihedrals</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

    <span class="n">section_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Masses&#39;</span><span class="p">,</span> <span class="s1">&#39;Pair Coeffs&#39;</span><span class="p">,</span> <span class="s1">&#39;Bond Coeffs&#39;</span><span class="p">,</span> <span class="s1">&#39;Angle Coeffs&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Dihedral Coeffs&#39;</span><span class="p">,</span> <span class="s1">&#39;Atoms&#39;</span><span class="p">,</span> <span class="s1">&#39;Bonds&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Angles&#39;</span><span class="p">,</span> <span class="s1">&#39;Dihedrals&#39;</span><span class="p">]</span>
    <span class="n">section_flags</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">section_names</span><span class="p">}</span>

    <span class="c1"># Iterate file line by line. This reduces the memory required since it</span>
    <span class="c1"># only loads the current line</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

            <span class="c1"># Check for new section</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">section_names</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">section_flags</span><span class="p">:</span>
                    <span class="n">section_flags</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="n">section_flags</span><span class="p">[</span><span class="n">line</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">section_flags</span><span class="p">[</span><span class="s1">&#39;Masses&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">atom_type</span> <span class="o">=</span> <span class="n">structures</span><span class="o">.</span><span class="n">Struct</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                              <span class="n">mass</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                                              <span class="n">style</span><span class="o">=</span><span class="s1">&#39;lj/cut&#39;</span><span class="p">)</span>
                <span class="n">atom_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom_type</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">section_flags</span><span class="p">[</span><span class="s1">&#39;Pair Coeffs&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">atom_type_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">atom_types</span><span class="p">[</span><span class="n">atom_type_index</span><span class="p">]</span><span class="o">.</span><span class="n">vdw_e</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">atom_types</span><span class="p">[</span><span class="n">atom_type_index</span><span class="p">]</span><span class="o">.</span><span class="n">vdw_r</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">section_flags</span><span class="p">[</span><span class="s1">&#39;Bond Coeffs&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">bond_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">structures</span><span class="o">.</span><span class="n">Struct</span><span class="p">(</span><span class="n">e</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                                                    <span class="n">r</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                                                    <span class="n">style</span><span class="o">=</span><span class="s1">&#39;harmonic&#39;</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">section_flags</span><span class="p">[</span><span class="s1">&#39;Angle Coeffs&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">angle_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">structures</span><span class="o">.</span><span class="n">Struct</span><span class="p">(</span><span class="n">e</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                                                     <span class="n">angle</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                                                     <span class="n">style</span><span class="o">=</span><span class="s1">&#39;harmonic&#39;</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">section_flags</span><span class="p">[</span><span class="s1">&#39;Dihedral Coeffs&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">dihedral_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">structures</span><span class="o">.</span><span class="n">Struct</span><span class="p">(</span><span class="n">e</span><span class="o">=</span><span class="nb">tuple</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">info</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">]]),</span>
                                      <span class="n">style</span><span class="o">=</span><span class="s1">&#39;opls&#39;</span><span class="p">)</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">section_flags</span><span class="p">[</span><span class="s1">&#39;Atoms&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">read_atoms</span><span class="p">:</span>
                <span class="c1"># Check if atom has expected number of characteristics</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">7</span><span class="p">:</span>
                    <span class="c1"># Add charge to appropriate atom_type</span>
                    <span class="n">atom_type_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="n">atom_types</span><span class="p">[</span><span class="n">atom_type_index</span><span class="p">]</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

                    <span class="c1"># Create new atom and assign atom_type</span>
                    <span class="n">new_atom</span> <span class="o">=</span> <span class="n">structures</span><span class="o">.</span><span class="n">Atom</span><span class="p">(</span><span class="n">element</span><span class="o">=</span><span class="n">info</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                                               <span class="n">x</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span>
                                               <span class="n">y</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span>
                                               <span class="n">z</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">6</span><span class="p">]),</span>
                                               <span class="n">index</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                               <span class="n">bonded</span><span class="o">=</span><span class="p">[],</span>
                                               <span class="n">molecule_index</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="n">new_atom</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">atom_types</span><span class="p">[</span><span class="n">atom_type_index</span><span class="p">]</span>
                    <span class="n">atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_atom</span><span class="p">)</span>

                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Atom skipped due to missing information&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">section_flags</span><span class="p">[</span><span class="s1">&#39;Bonds&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">read_bonds</span><span class="p">:</span>
                <span class="c1"># Check if bond has expected number of characteristics</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                    <span class="n">bonds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">structures</span><span class="o">.</span><span class="n">Bond</span><span class="p">(</span><span class="n">atoms</span><span class="p">[</span><span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
                                                 <span class="n">atoms</span><span class="p">[</span><span class="n">b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
                                                 <span class="nb">type</span><span class="o">=</span><span class="n">bond_types</span><span class="p">[</span>
                                                 <span class="nb">int</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                                                 <span class="p">)</span>
                                 <span class="p">)</span>
                    <span class="n">atoms</span><span class="p">[</span><span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bonded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atoms</span><span class="p">[</span><span class="n">b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="n">atoms</span><span class="p">[</span><span class="n">b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bonded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atoms</span><span class="p">[</span><span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Bond skipped due to missing information&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">section_flags</span><span class="p">[</span><span class="s1">&#39;Angles&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">read_angles</span><span class="p">:</span>
                <span class="c1"># Check if angle has expected number of characteristics</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                    <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                    <span class="n">angles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">structures</span><span class="o">.</span><span class="n">Angle</span><span class="p">(</span><span class="n">atoms</span><span class="p">[</span><span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
                                  <span class="n">atoms</span><span class="p">[</span><span class="n">b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
                                  <span class="n">atoms</span><span class="p">[</span><span class="n">c</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
                                  <span class="nb">type</span><span class="o">=</span><span class="n">angle_types</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Angle skipped due to missing information&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">section_flags</span><span class="p">[</span><span class="s1">&#39;Dihedrals&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">read_dihedrals</span><span class="p">:</span>
                <span class="c1"># Check if angle has expected number of characteristics</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                    <span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                    <span class="n">dihedrals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">structures</span><span class="o">.</span><span class="n">Dihedral</span><span class="p">(</span><span class="n">atoms</span><span class="p">[</span><span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
                                            <span class="n">atoms</span><span class="p">[</span><span class="n">b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
                                            <span class="n">atoms</span><span class="p">[</span><span class="n">c</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
                                            <span class="n">atoms</span><span class="p">[</span><span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
                                            <span class="nb">type</span><span class="o">=</span><span class="n">dihedral_types</span><span class="p">[</span>
                                            <span class="nb">int</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                                            <span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dihedral skipped due to missing information&#39;</span><span class="p">)</span>

    <span class="c1"># Create atoms and bonds</span>
    <span class="k">return</span> <span class="n">atoms</span><span class="p">,</span> <span class="n">bonds</span><span class="p">,</span> <span class="n">angles</span><span class="p">,</span> <span class="n">dihedrals</span></div>


<div class="viewcode-block" id="write_lammps_data"><a class="viewcode-back" href="../codebase.html#files.write_lammps_data">[docs]</a><span class="k">def</span> <span class="nf">write_lammps_data</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pair_coeffs_included</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">hybrid_angle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hybrid_pair</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">default_angles</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes a lammps data file from the given system.</span>

<span class="sd">    Set pair_coeffs_included to True to write pair_coeffs in data file.</span>
<span class="sd">    Set hybrid_angle to True to detect different treatment of angles among</span>
<span class="sd">    different atom types.</span>
<span class="sd">    Set hybrid_pair to True to detect different treatment of pairing</span>
<span class="sd">    interactions</span>
<span class="sd">    among different atom types.</span>

<span class="sd">    **Parameters**</span>

<span class="sd">        system: :class:`structures.System`</span>
<span class="sd">            Atomic system to be written to a lammps data file.</span>
<span class="sd">        pair_coeffs_included: *bool, optional*</span>
<span class="sd">            Whether to write pair coefficients into the data file (True),</span>
<span class="sd">            or not (False).</span>
<span class="sd">        hybrid_angle: *bool, optional*</span>
<span class="sd">            Whether to detect different treatments of angles amongst different</span>
<span class="sd">            atom types (True), or not (False).</span>
<span class="sd">        hybrid_pair: *bool, optional*</span>
<span class="sd">            Whether to detect different treatments of pairing interactions</span>
<span class="sd">            amongst different atom types(True), or not (False).</span>

<span class="sd">    **Returns**</span>

<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">system</span><span class="o">.</span><span class="n">set_types</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
        <span class="c1"># default filename is out.xyz</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">name</span>

    <span class="c1"># start writing file</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.data&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;LAMMPS Description</span><span class="se">\n\n</span><span class="si">%d</span><span class="s1"> atoms</span><span class="se">\n</span><span class="si">%d</span><span class="s1"> bonds</span><span class="se">\n</span><span class="si">%d</span><span class="s1"> angles</span><span class="se">\n\</span>
<span class="si">%d</span><span class="s1"> dihedrals</span><span class="se">\n</span><span class="s1">0  impropers</span><span class="se">\n\n</span><span class="s1">&#39;</span>
            <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">atoms</span><span class="p">),</span>
               <span class="nb">len</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">bonds</span><span class="p">),</span>
               <span class="nb">len</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">angles</span><span class="p">),</span>
               <span class="nb">len</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">dihedrals</span><span class="p">)))</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> atom types</span><span class="se">\n</span><span class="si">%d</span><span class="s1"> bond types</span><span class="se">\n</span><span class="si">%d</span><span class="s1"> angle types</span><span class="se">\n</span><span class="si">%d</span><span class="s1"> dihedral types</span><span class="se">\n\</span>
<span class="s1">0  improper types</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">atom_types</span><span class="p">),</span>
               <span class="nb">len</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">bond_types</span><span class="p">),</span>
               <span class="nb">len</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">angle_types</span><span class="p">),</span>
               <span class="nb">len</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">dihedral_types</span><span class="p">)))</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%3.5f</span><span class="s1"> </span><span class="si">%3.5f</span><span class="s1"> xlo xhi</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">xlo</span><span class="p">,</span> <span class="n">system</span><span class="o">.</span><span class="n">xhi</span><span class="p">))</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%3.5f</span><span class="s1"> </span><span class="si">%3.5f</span><span class="s1"> ylo yhi</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">ylo</span><span class="p">,</span> <span class="n">system</span><span class="o">.</span><span class="n">yhi</span><span class="p">))</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%3.5f</span><span class="s1"> </span><span class="si">%3.5f</span><span class="s1"> zlo zhi</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">zlo</span><span class="p">,</span> <span class="n">system</span><span class="o">.</span><span class="n">zhi</span><span class="p">))</span>
    <span class="c1"># If the system is triclinic box</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">box_angles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">90</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.001</span> <span class="ow">or</span>
            <span class="nb">abs</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">box_angles</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">90</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.001</span> <span class="ow">or</span>
            <span class="nb">abs</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">box_angles</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">90</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.001</span><span class="p">):</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%3.5f</span><span class="s1"> </span><span class="si">%3.5f</span><span class="s1"> </span><span class="si">%3.5f</span><span class="s1"> xy xz yz</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">xy</span><span class="p">,</span> <span class="n">system</span><span class="o">.</span><span class="n">xz</span><span class="p">,</span> <span class="n">system</span><span class="o">.</span><span class="n">yz</span><span class="p">))</span>

    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">Masses</span>

<span class="s1">&#39;&#39;&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%d</span><span class="se">\t</span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">lammps_type</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">mass</span><span class="p">)</span>
                  <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">system</span><span class="o">.</span><span class="n">atom_types</span><span class="p">]))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pair_coeffs_included</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Pair Coeffs</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">hybrid_pair</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">system</span><span class="o">.</span><span class="n">atom_types</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s2">&quot;pair_type&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">pair_type</span> <span class="o">==</span> <span class="s2">&quot;nm/cut&quot;</span><span class="p">):</span>
                    <span class="c1"># hybrid with nm/cut</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">lammps_type</span><span class="p">,</span> <span class="s2">&quot;nm/cut&quot;</span><span class="p">,</span>
                            <span class="n">t</span><span class="o">.</span><span class="n">vdw_e</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">r0</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">m</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="c1"># Update here with elif statements for the syntax of different</span>
                <span class="c1"># pair_styles. Currently only nm and lj are implemented.</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Assume lj/cut potential</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">((</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">lammps_type</span><span class="p">,</span> <span class="s2">&quot;lj/cut&quot;</span><span class="p">,</span>
                             <span class="n">t</span><span class="o">.</span><span class="n">vdw_e</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">vdw_r</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Assume lj/cut potential since no hybrids are included</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">system</span><span class="o">.</span><span class="n">atom_types</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s2">&quot;pair_type&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">pair_type</span> <span class="o">==</span> <span class="s2">&quot;nm/cut&quot;</span><span class="p">):</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">lammps_type</span><span class="p">,</span>
                            <span class="n">t</span><span class="o">.</span><span class="n">vdw_e</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">r0</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">m</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">((</span><span class="s2">&quot;</span><span class="si">%d</span><span class="se">\t</span><span class="si">%f</span><span class="se">\t</span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">lammps_type</span><span class="p">,</span>
                             <span class="n">t</span><span class="o">.</span><span class="n">vdw_e</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">vdw_r</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">system</span><span class="o">.</span><span class="n">bonds</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Bond Coeffs</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%d</span><span class="se">\t</span><span class="si">%f</span><span class="se">\t</span><span class="si">%f</span><span class="s2">&quot;</span>
                           <span class="o">%</span> <span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">lammps_type</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">e</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">r</span><span class="p">)</span>
                           <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">system</span><span class="o">.</span><span class="n">bond_types</span><span class="p">]))</span>
    <span class="k">if</span> <span class="n">system</span><span class="o">.</span><span class="n">angles</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">hybrid_angle</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Angle Coeffs</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%d</span><span class="se">\t</span><span class="si">%s</span><span class="se">\t</span><span class="si">%f</span><span class="se">\t</span><span class="si">%f</span><span class="s2">&quot;</span>
                               <span class="o">%</span> <span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">lammps_type</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">style</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">e</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">angle</span><span class="p">)</span>
                               <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">system</span><span class="o">.</span><span class="n">angle_types</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Angle Coeffs</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%d</span><span class="se">\t</span><span class="si">%f</span><span class="se">\t</span><span class="si">%f</span><span class="s2">&quot;</span>
                               <span class="o">%</span> <span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">lammps_type</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">e</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">angle</span><span class="p">)</span>
                               <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">system</span><span class="o">.</span><span class="n">angle_types</span><span class="p">]))</span>
    <span class="k">if</span> <span class="n">system</span><span class="o">.</span><span class="n">dihedrals</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Dihedral Coeffs</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%d</span><span class="se">\t</span><span class="si">%f</span><span class="se">\t</span><span class="si">%f</span><span class="se">\t</span><span class="si">%f</span><span class="se">\t</span><span class="si">%f</span><span class="s2">&quot;</span>
                           <span class="o">%</span> <span class="p">((</span><span class="n">t</span><span class="o">.</span><span class="n">lammps_type</span><span class="p">,)</span> <span class="o">+</span>
                               <span class="nb">tuple</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span>
                               <span class="p">((</span><span class="mf">0.0</span><span class="p">,)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">e</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">else</span> <span class="p">()))</span>
                           <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">system</span><span class="o">.</span><span class="n">dihedral_types</span><span class="p">]))</span>


    <span class="c1"># atom (molecule type charge x y z)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Atoms</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">+</span>
            <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
                                 <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                           <span class="n">a</span><span class="o">.</span><span class="n">molecule_index</span><span class="p">,</span>
                                           <span class="n">a</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">lammps_type</span><span class="p">,</span>
                                           <span class="n">a</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span>
                                           <span class="n">a</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                                           <span class="n">a</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                                           <span class="n">a</span><span class="o">.</span><span class="n">z</span><span class="p">]])</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">system</span><span class="o">.</span><span class="n">atoms</span><span class="p">]))</span>

    <span class="k">if</span> <span class="n">system</span><span class="o">.</span><span class="n">bonds</span><span class="p">:</span>
        <span class="c1"># bond (type a b)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">Bonds</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
                                      <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                                <span class="n">b</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">lammps_type</span><span class="p">,</span>
                                                <span class="n">b</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                                <span class="n">b</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">]])</span>
                          <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">bonds</span><span class="p">)]))</span>
    <span class="k">if</span> <span class="n">system</span><span class="o">.</span><span class="n">angles</span><span class="p">:</span>
        <span class="c1"># ID type atom1 atom2 atom3</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">Angles</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
                                      <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                                <span class="n">a</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">lammps_type</span><span class="p">]</span> <span class="o">+</span>
                                     <span class="p">[</span><span class="n">atom</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">atoms</span><span class="p">]])</span>
                          <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">angles</span><span class="p">)]))</span>
    <span class="k">if</span> <span class="n">system</span><span class="o">.</span><span class="n">dihedrals</span><span class="p">:</span>
        <span class="c1"># ID type a b c d</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">Dihedrals</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
                                      <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                                <span class="n">d</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">lammps_type</span><span class="p">]</span> <span class="o">+</span>
                                     <span class="p">[</span><span class="n">atom</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">atoms</span><span class="p">]])</span>
                          <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">dihedrals</span><span class="p">)]))</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<span class="c1"># Returns the last time a file was modified in seconds</span>
<div class="viewcode-block" id="last_modified"><a class="viewcode-back" href="../codebase.html#files.last_modified">[docs]</a><span class="k">def</span> <span class="nf">last_modified</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determine when a file was last modified in seconds.</span>

<span class="sd">    **Parameters**</span>

<span class="sd">        name: *str*</span>
<span class="sd">            Name of the file.</span>

<span class="sd">    **Returns**</span>

<span class="sd">        time: *datetime.datetime*</span>
<span class="sd">            The last time this file was modified in the standard python</span>
<span class="sd">            datetime format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
        <span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Expected lammps trajectory file does not exist at </span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">&#39;</span>
             <span class="o">%</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">name</span><span class="p">))</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="n">statinfo</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">statinfo</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">)</span></div>


<div class="viewcode-block" id="which"><a class="viewcode-back" href="../codebase.html#files.which">[docs]</a><span class="k">def</span> <span class="nf">which</span><span class="p">(</span><span class="n">program</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A function to return the full path of a system executable.</span>

<span class="sd">    **Parameters**</span>

<span class="sd">        program: *str*</span>
<span class="sd">            The name of the system executable to find.</span>

<span class="sd">    **Returns**</span>

<span class="sd">        path: *str or None*</span>
<span class="sd">            The path to the system executable. If none exists, then None.</span>

<span class="sd">    **References**</span>

<span class="sd">        * http://stackoverflow.com/a/377028</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">import</span> <span class="nn">os</span>

    <span class="k">def</span> <span class="nf">is_exe</span><span class="p">(</span><span class="n">fpath</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">X_OK</span><span class="p">)</span>

    <span class="n">fpath</span><span class="p">,</span> <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">program</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fpath</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">is_exe</span><span class="p">(</span><span class="n">program</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">program</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;PATH&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">):</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
            <span class="n">exe_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">program</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">is_exe</span><span class="p">(</span><span class="n">exe_file</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">exe_file</span>

    <span class="k">return</span> <span class="kc">None</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../squid.html">Squid</a></li>
<li class="toctree-l1"><a class="reference internal" href="../codebase.html">Codebase</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="../index.html">Squid 0.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Henry Herbol.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.6.
    </div>
  </body>
</html>