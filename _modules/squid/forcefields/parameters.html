
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>squid.forcefields.parameters &#8212; Squid 2.0.0 documentation</title>
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Squid 2.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for squid.forcefields.parameters</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">squid.forcefields.lj</span> <span class="k">import</span> <span class="n">LJ</span>
<span class="kn">import</span> <span class="nn">squid.forcefields.helper</span> <span class="k">as</span> <span class="nn">ffh</span>
<span class="kn">from</span> <span class="nn">squid.forcefields.morse</span> <span class="k">import</span> <span class="n">Morse</span>
<span class="kn">from</span> <span class="nn">squid.forcefields.coulomb</span> <span class="k">import</span> <span class="n">Coul</span>
<span class="kn">from</span> <span class="nn">squid.forcefields.tersoff</span> <span class="k">import</span> <span class="n">Tersoff</span>
<span class="kn">from</span> <span class="nn">squid.forcefields</span> <span class="k">import</span> <span class="n">opls</span> <span class="k">as</span> <span class="n">opls_utils</span>
<span class="kn">from</span> <span class="nn">squid.forcefields</span> <span class="k">import</span> <span class="n">smrff</span> <span class="k">as</span> <span class="n">smrff_utils</span>
<span class="kn">from</span> <span class="nn">squid.forcefields.tersoff</span> <span class="k">import</span> <span class="n">verify_tersoff_2body_symmetry</span>
<span class="kn">from</span> <span class="nn">squid.forcefields.tersoff</span> <span class="k">import</span> <span class="n">sorted_force_2body_symmetry</span>
<span class="kn">from</span> <span class="nn">squid.forcefields.tersoff</span> <span class="k">import</span> <span class="n">tag_tersoff_for_duplicate_2bodies</span>
<span class="kn">from</span> <span class="nn">squid.forcefields.connectors</span> <span class="k">import</span> <span class="n">Bond</span><span class="p">,</span> <span class="n">Angle</span><span class="p">,</span> <span class="n">Dihedral</span>
<span class="kn">from</span> <span class="nn">squid.forcefields.sinSmooth.lr</span> <span class="k">import</span> <span class="n">SmoothSinLR</span>
<span class="kn">from</span> <span class="nn">squid.forcefields.sinSmooth.inout</span> <span class="k">import</span> <span class="n">SmoothSinInOut</span>
<span class="kn">from</span> <span class="nn">squid.forcefields.sinSmooth.coupled</span> <span class="k">import</span> <span class="n">SmoothSinCoupled</span>

<span class="n">SUPPORTED_STYLES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;lj/cut/coul/cut&quot;</span><span class="p">,</span>
    <span class="s2">&quot;lj/cut/coul/long&quot;</span><span class="p">,</span>
    <span class="s2">&quot;morse&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tersoff&quot;</span><span class="p">,</span>
    <span class="s2">&quot;opls&quot;</span><span class="p">,</span>
    <span class="s2">&quot;smooth&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">SUPPORTED_SMOOTHS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;null&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ters_l&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ters_r&quot;</span><span class="p">,</span>
    <span class="s2">&quot;sin_l&quot;</span><span class="p">,</span>
    <span class="s2">&quot;sin_r&quot;</span><span class="p">,</span>
    <span class="s2">&quot;sin_inout&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">SMRFF_DICT</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;lj&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;sigma&quot;</span><span class="p">,</span> <span class="s2">&quot;epsilon&quot;</span><span class="p">],</span>
    <span class="s2">&quot;coul&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;charge&quot;</span><span class="p">],</span>
    <span class="s2">&quot;morse&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;D0&quot;</span><span class="p">,</span> <span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="s2">&quot;r0&quot;</span><span class="p">,</span> <span class="s2">&quot;rc&quot;</span><span class="p">],</span>
    <span class="s2">&quot;tersoff&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="s2">&quot;gamma&quot;</span><span class="p">,</span> <span class="s2">&quot;lambda3&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="s2">&quot;costheta0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;beta&quot;</span><span class="p">,</span> <span class="s2">&quot;lambda2&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="s2">&quot;lambda1&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">]</span>
<span class="p">}</span>
<span class="n">OPLS_STRUCTURES</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;BONDS&quot;</span><span class="p">,</span> <span class="s2">&quot;ANGLES&quot;</span><span class="p">,</span> <span class="s2">&quot;DIHEDRALS&quot;</span><span class="p">]</span>
<span class="n">OPLS_FILE</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span>\
    <span class="s2">&quot;/potentials/oplsaa.prm&quot;</span>


<div class="viewcode-block" id="Parameters"><a class="viewcode-back" href="../../../codebase.html#squid.forcefields.parameters.Parameters">[docs]</a><span class="k">class</span> <span class="nc">Parameters</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A Parameters object that holds force field parameters.  It requires the</span>
<span class="sd">    input of which atom types to get parameters for, so as to not read in an</span>
<span class="sd">    entire force field.</span>

<span class="sd">    This object contains the following:</span>

<span class="sd">        - :func:`dump_angles`</span>
<span class="sd">        - :func:`dump_bonds`</span>
<span class="sd">        - :func:`dump_dihedrals`</span>
<span class="sd">        - :func:`dump_lj_cut_coul_cut`</span>
<span class="sd">        - :func:`dump_lj_cut_coul_long`</span>
<span class="sd">        - :func:`dump_morse`</span>
<span class="sd">        - :func:`dump_set_charge`</span>
<span class="sd">        - :func:`dump_smooths`</span>
<span class="sd">        - :func:`dump_style`</span>
<span class="sd">        - :func:`dump_tersoff`</span>
<span class="sd">        - :func:`fix`</span>
<span class="sd">        - :func:`generate`</span>
<span class="sd">        - :func:`get_smrff_style`</span>
<span class="sd">        - :func:`load_opls`</span>
<span class="sd">        - :func:`load_smrff`</span>
<span class="sd">        - :func:`mapper`</span>
<span class="sd">        - :func:`num_free_parameters`</span>
<span class="sd">        - :func:`pack`</span>
<span class="sd">        - :func:`set_smoothed_pair_potentials`</span>
<span class="sd">        - :func:`set_all_masks`</span>
<span class="sd">        - :func:`set_mask`</span>
<span class="sd">        - :func:`set_opls_mask`</span>
<span class="sd">        - :func:`unpack`</span>
<span class="sd">        - :func:`write_smrff`</span>

<span class="sd">    **Parameters**</span>

<span class="sd">        fptr: *list, tuple, str, str, optional*</span>
<span class="sd">            A list of tuples, holding two strings: the force field type</span>
<span class="sd">            (either OPLS or SMRFF right now), and the path to the</span>
<span class="sd">            parameter file.  If no path is specified, the default OPLS</span>
<span class="sd">            parameters stored in squid will be used.</span>
<span class="sd">        restrict: *list, str, optional*</span>
<span class="sd">            A list of strings specifying which types are to be used.</span>
<span class="sd">            Note, you must have unique types, lest they be overwritten.</span>

<span class="sd">    **Returns**</span>

<span class="sd">        params: :class:`Parameters`</span>
<span class="sd">            This object.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">restrict</span><span class="p">,</span> <span class="n">opls_file</span><span class="o">=</span><span class="n">OPLS_FILE</span><span class="p">,</span> <span class="n">smrff_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1">#####################################</span>
        <span class="c1"># Initialize empty data lists</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coul_params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">morse_params</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bond_params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angle_params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_params</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">smooth_params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">#####################################</span>
        <span class="c1"># Set all masks to True.  Masks are used to set whether a parameter</span>
        <span class="c1"># will be output or not when requested.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lj_mask</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coul_mask</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tersoff_mask</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">morse_mask</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bond_mask</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angle_mask</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_mask</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">smooth_mask</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#####################################</span>
        <span class="c1"># Default cutoffs are None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">short_gcut</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">long_gcut</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smrff_types</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">system_name</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Force restrict to be that of strings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">restrict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">restrict</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opls_structure_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write_tfile</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Load in all the parameters</span>
        <span class="k">if</span> <span class="n">opls_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_opls</span><span class="p">(</span><span class="n">opls_file</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">smrff_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_smrff</span><span class="p">(</span><span class="n">smrff_file</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This prints out a representation of the parameter object, in the format</span>
<span class="sd">        that is output to the smrff parameter file.</span>

<span class="sd">        **Returns**</span>

<span class="sd">            params: *str*</span>
<span class="sd">                A string representation of parameters.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">param_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_param_list</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">opls_structure_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">restrict_structures</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">restrict_structures</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">opls_structure_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">]</span>

        <span class="c1"># Handle smrff list</span>
        <span class="k">if</span> <span class="n">param_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">params</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">param_type</span><span class="p">,</span> <span class="n">param_string</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">param_list</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">param_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">param_string</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="k">if</span> <span class="n">param_string</span> <span class="ow">in</span> <span class="n">OPLS_STRUCTURES</span><span class="p">:</span>
                    <span class="n">params</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">param_type</span>
                        <span class="k">if</span> <span class="n">ffh</span><span class="o">.</span><span class="n">check_restriction</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">restrict_structures</span><span class="p">)])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">params</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">param_type</span>
                        <span class="k">if</span> <span class="n">ffh</span><span class="o">.</span><span class="n">check_restriction</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">)])</span>
                <span class="n">params</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">END&quot;</span>

        <span class="k">return</span> <span class="n">params</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

<div class="viewcode-block" id="Parameters.set_smoothed_pair_potentials"><a class="viewcode-back" href="../../../codebase.html#squid.forcefields.parameters.Parameters.set_smoothed_pair_potentials">[docs]</a>    <span class="k">def</span> <span class="nf">set_smoothed_pair_potentials</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">local_potentials</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This will assign masks appropriately for the input forcefield.  It</span>
<span class="sd">        will also assign any necessary parameters for the desired forcefield.</span>

<span class="sd">        NOTE! This is a rudimentary starting point and should be improved on.</span>
<span class="sd">        pair style smrff allows for N transitions, whereas the way this is</span>
<span class="sd">        currently written only allows for short-range to long-range.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            local_potentials: *list, tuple, ...*</span>
<span class="sd">                A list of tuples, each holding three values.  The first is the</span>
<span class="sd">                potential (such as morse or tersoff).  The second is the</span>
<span class="sd">                global cutoff (likely in Angstroms).  The final is the smooth</span>
<span class="sd">                function to apply to this potential (such as NULL for none,</span>
<span class="sd">                or some sin_X smooth).</span>

<span class="sd">        **Returns**</span>

<span class="sd">            None</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># Ensure correctly passed local_potentials</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">local_potentials</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span>\
            <span class="s2">&quot;Error - local_potentials should be a list.&quot;</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">local_potentials</span><span class="p">]),</span>\
            <span class="s2">&quot;Error - not all values in local_potentials are tuples!&quot;</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">local_potentials</span><span class="p">]),</span>\
            <span class="s2">&quot;Error - Some potentials have been incorrectly defined.&quot;</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">SUPPORTED_STYLES</span>
                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">local_potentials</span><span class="p">]),</span>\
            <span class="s2">&quot;Error - Unsupported potential specified.&quot;</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">SUPPORTED_SMOOTHS</span>
                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">local_potentials</span><span class="p">]),</span>\
            <span class="s2">&quot;Error - Unsupported smooth specified.&quot;</span>

        <span class="k">assert</span> <span class="s2">&quot;opls&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">local_potentials</span><span class="p">],</span>\
            <span class="s2">&quot;Error - OPLS not supported in forcefield specification as it </span><span class="se">\</span>
<span class="s2">is not a pair potential.&quot;</span>

        <span class="c1"># Set masks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_mask</span><span class="p">(</span><span class="s2">&quot;smooth&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">potential</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">local_potentials</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_mask</span><span class="p">(</span><span class="n">potential</span><span class="p">)</span>

        <span class="c1"># Save potentials</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smoothed_pair_potentials</span> <span class="o">=</span> <span class="n">local_potentials</span></div>

<div class="viewcode-block" id="Parameters.generate"><a class="viewcode-back" href="../../../codebase.html#squid.forcefields.parameters.Parameters.generate">[docs]</a>    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elems</span><span class="p">,</span> <span class="n">signs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">couple_smooths</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tersoff_form</span><span class="o">=</span><span class="s2">&quot;original&quot;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        For every mask that is true, we will generate random data.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            elems: *list, str*</span>
<span class="sd">                A list of the elements, matching 1-to-1 with the given</span>
<span class="sd">                smrff_types.</span>

<span class="sd">            signs: *list, float*</span>
<span class="sd">                A list of charge signs, matching 1-to-1 with the given</span>
<span class="sd">                smrff_types.</span>

<span class="sd">            couple_smooths: *bool, optional*</span>
<span class="sd">                Whether to couple together like smooths.  If true, when</span>
<span class="sd">                you have a situation in which, say, sin_l and sin_r match</span>
<span class="sd">                up, then this will ensure that these two overlap perfectly.</span>

<span class="sd">            tersoff_form: *str*</span>
<span class="sd">                Whether to use the original tersoff_form (m=3, gamma=1) or the</span>
<span class="sd">                Albe et al tersoff_form (m=1, beta=1) for tersoff parameters.</span>
<span class="sd">                Must be original or albe.</span>

<span class="sd">        **Returns**</span>

<span class="sd">            None</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">smrff_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>\
            <span class="s2">&quot;Error - you must define smrff_types first!&quot;</span>

        <span class="k">if</span> <span class="n">couple_smooths</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smoothed_pair_potentials</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span>\
                <span class="s2">&quot;Error - coupled smooth only works for exactly 2 potentials&quot;</span>

        <span class="c1"># Generate our smooth functions</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">smooth_mask</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">smooth_params</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">left</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smoothed_pair_potentials</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">couple_smooths</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">lhs_potential</span><span class="p">,</span> <span class="n">lhs_gcut</span><span class="p">,</span> <span class="n">lhs_smooth</span> <span class="o">=</span> <span class="n">left</span>

                <span class="c1"># If we aren&#39;t smoothing here, then don&#39;t smooth</span>
                <span class="c1"># But keep in mind, if we are coupling we may still be</span>
                <span class="c1"># smoothing</span>
                <span class="k">if</span> <span class="n">lhs_potential</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;null&quot;</span> <span class="ow">or</span>\
                    <span class="n">lhs_potential</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;ters&quot;</span><span class="p">)</span> <span class="ow">and</span>\
                        <span class="ow">not</span> <span class="n">couple_smooths</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="c1"># In case we are coupling, then grab the &quot;right&quot; potential</span>
                <span class="n">rhs_potential</span><span class="p">,</span> <span class="n">rhs_gcut</span><span class="p">,</span> <span class="n">rhs_smooth</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">couple_smooths</span><span class="p">:</span>
                    <span class="n">rhs_potential</span><span class="p">,</span> <span class="n">rhs_gcut</span><span class="p">,</span> <span class="n">rhs_smooth</span> <span class="o">=</span>\
                        <span class="bp">self</span><span class="o">.</span><span class="n">smoothed_pair_potentials</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

                <span class="c1"># Check again if we are smoothing RHS</span>
                <span class="k">if</span> <span class="n">rhs_smooth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">([</span>
                    <span class="n">rhs_smooth</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;null&quot;</span><span class="p">,</span>
                        <span class="n">rhs_smooth</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;ters&quot;</span><span class="p">)]):</span>
                    <span class="k">continue</span>

                <span class="c1"># If we are smoothing, determine if it&#39;s coupled or not and</span>
                <span class="c1"># handle accordingly</span>
                <span class="k">if</span> <span class="nb">all</span><span class="p">([</span>
                    <span class="n">couple_smooths</span><span class="p">,</span>
                    <span class="n">lhs_smooth</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;sin&quot;</span><span class="p">),</span>
                        <span class="n">rhs_smooth</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;sin&quot;</span><span class="p">)]):</span>
                    <span class="c1"># Determine cutoffs and which inout_index this is</span>
                    <span class="n">inout_index</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="nb">all</span><span class="p">([</span><span class="s2">&quot;inout&quot;</span> <span class="ow">in</span> <span class="n">lhs_smooth</span><span class="p">,</span>
                             <span class="s2">&quot;inout&quot;</span> <span class="ow">in</span> <span class="n">rhs_smooth</span><span class="p">]),</span>
                        <span class="s2">&quot;inout&quot;</span> <span class="ow">in</span> <span class="n">lhs_smooth</span><span class="p">,</span>
                        <span class="s2">&quot;inout&quot;</span> <span class="ow">in</span> <span class="n">rhs_smooth</span><span class="p">,</span>
                        <span class="kc">True</span>
                    <span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="c1"># Assign additional gcut values appropriately</span>
                    <span class="n">gcut_1</span><span class="p">,</span> <span class="n">gcut_2</span><span class="p">,</span> <span class="n">gcut_3</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="p">(</span><span class="n">lhs_gcut</span><span class="p">,</span> <span class="n">lhs_gcut</span><span class="p">,</span> <span class="n">rhs_gcut</span><span class="p">),</span>
                        <span class="p">(</span><span class="n">lhs_gcut</span><span class="p">,</span> <span class="n">lhs_gcut</span><span class="p">,</span> <span class="n">rhs_gcut</span><span class="p">),</span>
                        <span class="p">(</span><span class="n">lhs_gcut</span><span class="p">,</span> <span class="n">rhs_gcut</span><span class="p">,</span> <span class="n">rhs_gcut</span><span class="p">),</span>
                        <span class="p">(</span><span class="n">lhs_gcut</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="p">][</span><span class="n">inout_index</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">inout_index</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">inout_index</span> <span class="o">=</span> <span class="kc">None</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">smooth_params</span> <span class="o">+=</span>\
                        <span class="n">SmoothSinCoupled</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">smrff_types</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">gcut_1</span><span class="p">,</span>
                            <span class="n">gcut_2</span><span class="o">=</span><span class="n">gcut_2</span><span class="p">,</span> <span class="n">gcut_3</span><span class="o">=</span><span class="n">gcut_3</span><span class="p">,</span>
                            <span class="n">inout_index</span><span class="o">=</span><span class="n">inout_index</span>
                        <span class="p">)</span>
                <span class="k">elif</span> <span class="n">lhs_smooth</span> <span class="o">==</span> <span class="s2">&quot;sin_inout&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">smooth_params</span> <span class="o">+=</span>\
                        <span class="n">SmoothSinInOut</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">smrff_types</span><span class="p">,</span>
                            <span class="n">lhs_gcut</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">,</span> <span class="n">lhs_gcut</span><span class="p">,</span> <span class="n">i</span>
                        <span class="p">)</span>
                <span class="k">elif</span> <span class="n">lhs_smooth</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;sin_l&quot;</span><span class="p">,</span> <span class="s2">&quot;sin_r&quot;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">smooth_params</span> <span class="o">+=</span>\
                        <span class="n">SmoothSinLR</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">smrff_types</span><span class="p">,</span>
                            <span class="n">lhs_smooth</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                            <span class="n">lhs_gcut</span><span class="p">,</span> <span class="n">i</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Error - Invalide smooth (</span><span class="si">%s</span><span class="s2">)&quot;</span>
                                    <span class="o">%</span> <span class="n">lhs_smooth</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lj_mask</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span> <span class="o">=</span> <span class="n">LJ</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smrff_types</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coul_mask</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">signs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>\
                <span class="s2">&quot;Error - you need to specify signs for coulomb.&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coul_params</span> <span class="o">=</span> <span class="n">Coul</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smrff_types</span><span class="p">,</span> <span class="n">elems</span><span class="p">,</span> <span class="n">signs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">morse_mask</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">morse_params</span> <span class="o">=</span> <span class="n">Morse</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smrff_types</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tersoff_mask</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span> <span class="o">=</span> <span class="n">Tersoff</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">smrff_types</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">tersoff_form</span><span class="p">)</span>
            <span class="n">sorted_force_2body_symmetry</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span><span class="p">)</span>
            <span class="n">verify_tersoff_2body_symmetry</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.set_all_masks"><a class="viewcode-back" href="../../../codebase.html#squid.forcefields.parameters.Parameters.set_all_masks">[docs]</a>    <span class="k">def</span> <span class="nf">set_all_masks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">set_on</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Either turn all masks to being on or off.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            set_on: *bool*</span>
<span class="sd">                What to set all values to (True/False).</span>

<span class="sd">        **Returns**</span>

<span class="sd">            None</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lj_mask</span> <span class="o">=</span> <span class="n">set_on</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coul_mask</span> <span class="o">=</span> <span class="n">set_on</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tersoff_mask</span> <span class="o">=</span> <span class="n">set_on</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">morse_mask</span> <span class="o">=</span> <span class="n">set_on</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bond_mask</span> <span class="o">=</span> <span class="n">set_on</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angle_mask</span> <span class="o">=</span> <span class="n">set_on</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_mask</span> <span class="o">=</span> <span class="n">set_on</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">smooth_mask</span> <span class="o">=</span> <span class="n">set_on</span></div>

<div class="viewcode-block" id="Parameters.set_mask"><a class="viewcode-back" href="../../../codebase.html#squid.forcefields.parameters.Parameters.set_mask">[docs]</a>    <span class="k">def</span> <span class="nf">set_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Given a style, turn on the respective masks.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            mask: *str*</span>
<span class="sd">                The potential for which masks should be turned on (ex. morse)</span>

<span class="sd">        **Returns**</span>

<span class="sd">            None</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">assert</span> <span class="n">mask</span> <span class="ow">in</span> <span class="n">SUPPORTED_STYLES</span><span class="p">,</span>\
            <span class="s2">&quot;Error - style (</span><span class="si">%s</span><span class="s2">) is not recognized!&quot;</span> <span class="o">%</span> <span class="n">mask</span>
        <span class="k">if</span> <span class="n">mask</span> <span class="o">==</span> <span class="s2">&quot;morse&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">morse_mask</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">mask</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;lj/cut/coul/cut&quot;</span><span class="p">,</span> <span class="s2">&quot;lj/cut/coul/long&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lj_mask</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coul_mask</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">mask</span> <span class="o">==</span> <span class="s2">&quot;tersoff&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tersoff_mask</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">mask</span> <span class="o">==</span> <span class="s2">&quot;OPLS&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lj_mask</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coul_mask</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bond_mask</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">angle_mask</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_mask</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">mask</span> <span class="o">==</span> <span class="s2">&quot;smooth&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">smooth_mask</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Parameters.set_opls_mask"><a class="viewcode-back" href="../../../codebase.html#squid.forcefields.parameters.Parameters.set_opls_mask">[docs]</a>    <span class="k">def</span> <span class="nf">set_opls_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Turn off ALL masks, but leave OPLS ones on.</span>

<span class="sd">        **Returns**</span>

<span class="sd">            None</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># Turn off all masks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_all_masks</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># Turn on only OPLS ones</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lj_mask</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coul_mask</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bond_mask</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angle_mask</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_mask</span> <span class="o">=</span> <span class="kc">True</span></div>

    <span class="k">def</span> <span class="nf">_get_param_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trim_tersoff_2body</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        A unified function to ensure we always read in parameters in the</span>
<span class="sd">        same order throughout the code.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            trim_tersoff_2body: *bool, optional*</span>
<span class="sd">                Whether to trim the tersoff list to remove the 2-body</span>
<span class="sd">                duplicates.</span>

<span class="sd">        **Returns**</span>

<span class="sd">            params: *list, list, objs*</span>
<span class="sd">                A list of lists, each holding all parameter objects associated</span>
<span class="sd">                with some FF.</span>
<span class="sd">            param_strings: *list, str*</span>
<span class="sd">                A list of the names that the params list correlates to.  For</span>
<span class="sd">                example, if param_strings[0] is &quot;COULOMB&quot;, then params[0] is a</span>
<span class="sd">                list of coulomb objects.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">trim_tersoff_2body</span><span class="p">:</span>
            <span class="n">tag_tersoff_for_duplicate_2bodies</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span><span class="p">)</span>

        <span class="n">param_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;COULOMB&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coul_params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coul_mask</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;LENNARD-JONES&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lj_mask</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;TERSOFF&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tersoff_mask</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;MORSE&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">morse_params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">morse_mask</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;BONDS&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bond_params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bond_mask</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;ANGLES&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle_params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle_mask</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;DIHEDRALS&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_mask</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;SMOOTHS&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">smooth_params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">smooth_mask</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="n">params</span><span class="p">,</span> <span class="n">param_strings</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ps</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">param_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                <span class="n">param_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">params</span><span class="p">,</span> <span class="n">param_strings</span>

<div class="viewcode-block" id="Parameters.load_opls"><a class="viewcode-back" href="../../../codebase.html#squid.forcefields.parameters.Parameters.load_opls">[docs]</a>    <span class="k">def</span> <span class="nf">load_opls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Given an OPLS file name, in the Tinker format, parse it and load it</span>
<span class="sd">        into this parameters object.  Note, you should specify restrict before</span>
<span class="sd">        calling this function or else everything in the file will be loaded.</span>
<span class="sd">        If restrict is specified, then restrict_structure will be</span>
<span class="sd">        automatically generated during this function call.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            fname: *str*</span>
<span class="sd">                The path to the opls file.</span>

<span class="sd">        **Returns**</span>

<span class="sd">            None</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fname</span><span class="p">),</span>\
            <span class="s2">&quot;Error - Path (</span><span class="si">%s</span><span class="s2">) does not exist!&quot;</span> <span class="o">%</span> <span class="n">fname</span>

        <span class="c1"># Read in and parse the opls parameter file</span>
        <span class="n">atom_types</span><span class="p">,</span> <span class="n">bond_types</span><span class="p">,</span> <span class="n">angle_types</span><span class="p">,</span> <span class="n">dihedral_types</span> <span class="o">=</span>\
            <span class="n">opls_utils</span><span class="o">.</span><span class="n">parse_pfile</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">translate_AtomID_to_StructID</span> <span class="o">=</span> <span class="p">{</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">]):</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s2">&quot;index2&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">atom_types</span>
            <span class="p">}</span>

            <span class="c1"># Add in special 1-to-1 translation for all other types not</span>
            <span class="c1"># accounted for.  This is because we also handle restictions on</span>
            <span class="c1"># other FFs</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">r</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">translate_AtomID_to_StructID</span><span class="p">:</span>
                    <span class="n">translate_AtomID_to_StructID</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

            <span class="c1"># Add in special translation for * and 0</span>
            <span class="n">translate_AtomID_to_StructID</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span>
            <span class="n">translate_AtomID_to_StructID</span><span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">opls_structure_dict</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">r</span><span class="p">:</span> <span class="n">translate_AtomID_to_StructID</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">)]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">opls_structure_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># For each possible param type, check if it exists and load it</span>
        <span class="n">lj_params</span> <span class="o">=</span> <span class="n">LJ</span><span class="o">.</span><span class="n">load_opls</span><span class="p">(</span>
            <span class="n">atom_types</span><span class="p">,</span> <span class="n">pfile_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">restrict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">lj</span> <span class="ow">in</span> <span class="n">lj_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lj</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lj</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lj_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">lj</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">[</span><span class="n">lj_index</span><span class="p">]</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">lj</span><span class="o">.</span><span class="n">unpack</span><span class="p">())</span>

        <span class="n">coul_params</span> <span class="o">=</span> <span class="n">Coul</span><span class="o">.</span><span class="n">load_opls</span><span class="p">(</span>
            <span class="n">atom_types</span><span class="p">,</span> <span class="n">pfile_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">restrict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">coul</span> <span class="ow">in</span> <span class="n">coul_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">coul</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coul_params</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coul_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coul</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">coul_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coul_params</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">coul</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coul_params</span><span class="p">[</span><span class="n">coul_index</span><span class="p">]</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">coul</span><span class="o">.</span><span class="n">unpack</span><span class="p">())</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">opls_structure_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">restrict_structures</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">restrict_structures</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">v</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">opls_structure_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bond_params</span> <span class="o">+=</span> <span class="n">Bond</span><span class="o">.</span><span class="n">load_opls</span><span class="p">(</span>
            <span class="n">bond_types</span><span class="p">,</span> <span class="n">pfile_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">restrict</span><span class="o">=</span><span class="n">restrict_structures</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angle_params</span> <span class="o">+=</span> <span class="n">Angle</span><span class="o">.</span><span class="n">load_opls</span><span class="p">(</span>
            <span class="n">angle_types</span><span class="p">,</span> <span class="n">pfile_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">restrict</span><span class="o">=</span><span class="n">restrict_structures</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_params</span> <span class="o">+=</span> <span class="n">Dihedral</span><span class="o">.</span><span class="n">load_opls</span><span class="p">(</span>
            <span class="n">dihedral_types</span><span class="p">,</span> <span class="n">pfile_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">restrict</span><span class="o">=</span><span class="n">restrict_structures</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.load_smrff"><a class="viewcode-back" href="../../../codebase.html#squid.forcefields.parameters.Parameters.load_smrff">[docs]</a>    <span class="k">def</span> <span class="nf">load_smrff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        A function to read in a SMRFF parameter file.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            fname: *str*</span>
<span class="sd">                The path to a smrff parameter file.</span>
<span class="sd">                ???.smrff</span>

<span class="sd">        **Returns**</span>

<span class="sd">            None</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fname</span><span class="p">),</span>\
            <span class="s2">&quot;Error - Path (</span><span class="si">%s</span><span class="s2">) does not exist!&quot;</span> <span class="o">%</span> <span class="n">fname</span>
        <span class="c1"># Parse the input file to clean out comments, empty lines, and</span>
        <span class="c1"># trailing whitespace</span>
        <span class="n">raw</span> <span class="o">=</span> <span class="n">smrff_utils</span><span class="o">.</span><span class="n">parse_pfile</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>

        <span class="c1"># For each possible param type, check if it exists and load it</span>
        <span class="n">lj_params</span> <span class="o">=</span> <span class="n">LJ</span><span class="o">.</span><span class="n">load_smrff</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">pfile_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">restrict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">lj</span> <span class="ow">in</span> <span class="n">lj_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lj</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lj</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lj_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">lj</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">[</span><span class="n">lj_index</span><span class="p">]</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">lj</span><span class="o">.</span><span class="n">unpack</span><span class="p">())</span>

        <span class="n">coul_params</span> <span class="o">=</span> <span class="n">Coul</span><span class="o">.</span><span class="n">load_smrff</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">pfile_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                      <span class="n">restrict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">coul</span> <span class="ow">in</span> <span class="n">coul_params</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">coul</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coul_params</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coul_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coul</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">coul_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coul_params</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">coul</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coul_params</span><span class="p">[</span><span class="n">coul_index</span><span class="p">]</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">coul</span><span class="o">.</span><span class="n">unpack</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span> <span class="o">+=</span> <span class="n">Tersoff</span><span class="o">.</span><span class="n">load_smrff</span><span class="p">(</span>
            <span class="n">raw</span><span class="p">,</span> <span class="n">pfile_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">restrict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">)</span>
        <span class="n">verify_tersoff_2body_symmetry</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">morse_params</span> <span class="o">+=</span> <span class="n">Morse</span><span class="o">.</span><span class="n">load_smrff</span><span class="p">(</span>
            <span class="n">raw</span><span class="p">,</span> <span class="n">pfile_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">restrict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smooth_params</span> <span class="o">+=</span> <span class="n">SmoothSinLR</span><span class="o">.</span><span class="n">load_smrff</span><span class="p">(</span>
            <span class="n">raw</span><span class="p">,</span> <span class="n">pfile_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">restrict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smooth_params</span> <span class="o">+=</span> <span class="n">SmoothSinInOut</span><span class="o">.</span><span class="n">load_smrff</span><span class="p">(</span>
            <span class="n">raw</span><span class="p">,</span> <span class="n">pfile_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">restrict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smooth_params</span> <span class="o">+=</span> <span class="n">SmoothSinCoupled</span><span class="o">.</span><span class="n">load_smrff</span><span class="p">(</span>
            <span class="n">raw</span><span class="p">,</span> <span class="n">pfile_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">restrict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.write_smrff"><a class="viewcode-back" href="../../../codebase.html#squid.forcefields.parameters.Parameters.write_smrff">[docs]</a>    <span class="k">def</span> <span class="nf">write_smrff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        A function to save a SMRFF parameter file.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            fname: *str*</span>
<span class="sd">                The file name to save the parameters to.</span>

<span class="sd">        **Returns**</span>

<span class="sd">            None</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">params</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">param_types</span><span class="p">,</span> <span class="n">param_string_identifiers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_param_list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">p_type</span><span class="p">,</span> <span class="n">p_string</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">param_types</span><span class="p">,</span> <span class="n">param_string_identifiers</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">p_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">p_string</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">params</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">p_type</span>
                    <span class="k">if</span> <span class="n">ffh</span><span class="o">.</span><span class="n">check_restriction</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">)])</span>
                <span class="n">params</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">END&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="n">fptr</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">fptr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="n">fptr</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="Parameters.unpack"><a class="viewcode-back" href="../../../codebase.html#squid.forcefields.parameters.Parameters.unpack">[docs]</a>    <span class="k">def</span> <span class="nf">unpack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">with_indices</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">with_bounds</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Unpacks the parameters object into a 1D array for parameterization.</span>
<span class="sd">        This means that the indices are not included during unpacking!  Note,</span>
<span class="sd">        this can be overridden though if needed.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            with_indices: *bool, optional*</span>
<span class="sd">                Whether to also include the indices in the flat array.</span>
<span class="sd">            with_bounds: *bool, optional*</span>
<span class="sd">                Whether to also output the bounds for the parameters.</span>

<span class="sd">        **Returns**</span>

<span class="sd">            flat_array: *list, float/int*</span>
<span class="sd">                A list of floats/ints of our parameters.</span>
<span class="sd">            bounds_lower: *list, float/int*</span>
<span class="sd">                If with_bounds is specified, then the lower bounds are</span>
<span class="sd">                returned.</span>
<span class="sd">            bounds_upper: *list, float/int*</span>
<span class="sd">                If with_bounds is specified, then the upper bounds are</span>
<span class="sd">                returned.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">verify_tersoff_2body_symmetry</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span><span class="p">)</span>

        <span class="n">param_types</span><span class="p">,</span> <span class="n">param_string_identifiers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_param_list</span><span class="p">(</span>
            <span class="n">trim_tersoff_2body</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">out</span><span class="p">,</span> <span class="n">bounds_lower</span><span class="p">,</span> <span class="n">bounds_upper</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">param_type</span> <span class="ow">in</span> <span class="n">param_types</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">param_type</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">ffh</span><span class="o">.</span><span class="n">check_restriction</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">with_bounds</span><span class="p">:</span>
                    <span class="n">local_out</span><span class="p">,</span> <span class="n">local_bounds_l</span><span class="p">,</span> <span class="n">local_bounds_u</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span>
                        <span class="n">with_indices</span><span class="p">,</span> <span class="n">with_bounds</span><span class="o">=</span><span class="n">with_bounds</span><span class="p">)</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="n">local_out</span>
                    <span class="n">bounds_lower</span> <span class="o">+=</span> <span class="n">local_bounds_l</span>
                    <span class="n">bounds_upper</span> <span class="o">+=</span> <span class="n">local_bounds_u</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="n">p</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">with_indices</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">with_bounds</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">out</span><span class="p">,</span> <span class="n">bounds_lower</span><span class="p">,</span> <span class="n">bounds_upper</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="Parameters.pack"><a class="viewcode-back" href="../../../codebase.html#squid.forcefields.parameters.Parameters.pack">[docs]</a>    <span class="k">def</span> <span class="nf">pack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">with_indices</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Packs the parameters object from a 1D array.  NOTE! This is done in</span>
<span class="sd">        primarily for parameterization; which means the 1D array will NOT have</span>
<span class="sd">        the indices in it.  This can be overridden, however, by specifying the</span>
<span class="sd">        with_indices flag.</span>

<span class="sd">        Keep in mind, to maintain symmetry requirements in tersoff (where</span>
<span class="sd">        the two-body parameters are the same between A-B B and B-A A), this</span>
<span class="sd">        function will be tied closely to the unpack function.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            params: *list, float/int*</span>
<span class="sd">                A list of parameters</span>
<span class="sd">            with_indices: *bool, optional*</span>
<span class="sd">                Whether to account for the indices in the flat array.</span>

<span class="sd">        **Returns**</span>

<span class="sd">            None</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">param_types</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_param_list</span><span class="p">(</span><span class="n">trim_tersoff_2body</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">param_type</span> <span class="ow">in</span> <span class="n">param_types</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">param_type</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ffh</span><span class="o">.</span><span class="n">check_restriction</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">):</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">params</span><span class="p">[</span>
                        <span class="n">offset</span><span class="p">:</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">N_params</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">with_indices</span><span class="p">)])</span>
                <span class="n">offset</span> <span class="o">+=</span> <span class="n">p</span><span class="o">.</span><span class="n">N_params</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">with_indices</span><span class="p">)</span>

        <span class="n">sorted_force_2body_symmetry</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.dump_style"><a class="viewcode-back" href="../../../codebase.html#squid.forcefields.parameters.Parameters.dump_style">[docs]</a>    <span class="k">def</span> <span class="nf">dump_style</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tfile_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">tstyle_smrff</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">write_file</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                   <span class="n">in_input_file</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function will dump LAMMPS commands &quot;pair_coeff&quot; for chosen</span>
<span class="sd">        styles.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            style: *str*</span>
<span class="sd">                Whether to ignore the universal bounds, assigned in this</span>
<span class="sd">                smrff.py file.smrff</span>
<span class="sd">            tfile_name: *str*</span>
<span class="sd">                The name of the tersoff file.</span>
<span class="sd">            tstyle_smrff: *bool, optional*</span>
<span class="sd">                Whether to output for SMRFF style (one line allocates memory,</span>
<span class="sd">                the rest overwrites the parameters) or not.</span>
<span class="sd">            write_file: *bool, optional*</span>
<span class="sd">                Whether to write any files (ex. tersoff files) or not.</span>

<span class="sd">        **Returns**</span>
<span class="sd">            lammps_command: *str*</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="n">style</span> <span class="ow">in</span> <span class="n">SUPPORTED_STYLES</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;all&quot;</span><span class="p">],</span>\
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is an undefined function&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">style</span><span class="p">)</span>

        <span class="n">script</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write_tfile</span> <span class="o">=</span> <span class="n">write_file</span>
        <span class="n">local_style</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_smrff_style</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">style</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;lj/cut/coul/cut&quot;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">lj_mask</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coul_mask</span><span class="p">]):</span>
            <span class="k">if</span> <span class="s2">&quot;lj/cut/coul/cut&quot;</span> <span class="ow">in</span> <span class="n">local_style</span><span class="p">:</span>
                <span class="n">script</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dump_lj_cut_coul_cut</span><span class="p">())</span>
                <span class="n">script</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dump_set_charge</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">style</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;lj/cut/coul/long&quot;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">lj_mask</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coul_mask</span><span class="p">]):</span>
            <span class="k">if</span> <span class="s2">&quot;lj/cut/coul/long&quot;</span> <span class="ow">in</span> <span class="n">local_style</span><span class="p">:</span>
                <span class="n">script</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dump_lj_cut_coul_long</span><span class="p">())</span>
                <span class="n">script</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dump_set_charge</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">style</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;morse&quot;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">morse_mask</span><span class="p">:</span>
            <span class="n">script</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dump_morse</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">style</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;smooth&quot;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">smooth_mask</span><span class="p">:</span>
            <span class="n">script</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dump_smooths</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">style</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;tersoff&quot;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tersoff_mask</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tfile_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">tfile_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">system_name</span>
                <span class="k">if</span> <span class="n">tfile_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">tfile_name</span> <span class="o">=</span> <span class="s2">&quot;ters_params&quot;</span>
            <span class="n">script</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dump_tersoff</span><span class="p">(</span><span class="n">tfile_name</span><span class="p">,</span> <span class="n">tstyle_smrff</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">style</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;opls&quot;</span><span class="p">]:</span>
            <span class="n">script</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dump_bonds</span><span class="p">(</span><span class="n">in_input_file</span><span class="o">=</span><span class="n">in_input_file</span><span class="p">))</span>
            <span class="n">script</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dump_angles</span><span class="p">(</span><span class="n">in_input_file</span><span class="o">=</span><span class="n">in_input_file</span><span class="p">))</span>
            <span class="n">script</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dump_dihedrals</span><span class="p">(</span><span class="n">in_input_file</span><span class="o">=</span><span class="n">in_input_file</span><span class="p">))</span>

        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">script</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.mapper"><a class="viewcode-back" href="../../../codebase.html#squid.forcefields.parameters.Parameters.mapper">[docs]</a>    <span class="k">def</span> <span class="nf">mapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        A generalized function to map indices of atom types to structure types.</span>
<span class="sd">        Note, this is generalized and should allow for a wide range of x</span>
<span class="sd">        objects.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            x: *list or tuple or int or str or obj*</span>
<span class="sd">                Some way of identifing the atom type.  Note, if obj, then it</span>
<span class="sd">                will check for a .index, .indices, or .index2s property.</span>

<span class="sd">        **Returns**</span>

<span class="sd">            mapper_obj: *list, str or str*</span>
<span class="sd">                The structure type, as either a list (if bond/angle/dihedral)</span>
<span class="sd">                or a string (if charge/lj).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">ffh</span><span class="o">.</span><span class="n">map_to_lmp_index</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">opls_structure_dict</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.dump_bonds"><a class="viewcode-back" href="../../../codebase.html#squid.forcefields.parameters.Parameters.dump_bonds">[docs]</a>    <span class="k">def</span> <span class="nf">dump_bonds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_input_file</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get a string for lammps input in regards to assigning bond coeffs.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            in_input_file: *bool, optional*</span>
<span class="sd">                Whether to dump the bonds in the input file style format</span>
<span class="sd">                (True) or the data file style format (False)</span>

<span class="sd">        **Returns**</span>

<span class="sd">            coeffs: *str*</span>
<span class="sd">                A string of bond coeffs, with new line characters between</span>
<span class="sd">                different bonds.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">lammps_command</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">opls_structure_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">restrict_structures</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">restrict_structures</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">opls_structure_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">]</span>

        <span class="c1"># Loop through all possible bond parameters</span>
        <span class="n">index</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bond_params</span><span class="p">:</span>
            <span class="c1"># Skip those that are not included</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ffh</span><span class="o">.</span><span class="n">check_restriction</span><span class="p">(</span><span class="n">bond</span><span class="p">,</span> <span class="n">restrict_structures</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="c1"># Get the bond coeff string</span>
            <span class="n">lammps_command</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="s2">&quot;bond_coeff&quot;</span> <span class="k">if</span> <span class="n">in_input_file</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;  </span><span class="si">%d</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">bond</span><span class="o">.</span><span class="n">printer</span><span class="p">()))</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lammps_command</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.dump_angles"><a class="viewcode-back" href="../../../codebase.html#squid.forcefields.parameters.Parameters.dump_angles">[docs]</a>    <span class="k">def</span> <span class="nf">dump_angles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_input_file</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get a string for lammps input in regards to assigning angle coeffs.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            in_input_file: *bool, optional*</span>
<span class="sd">                Whether to dump the bonds in the input file style format</span>
<span class="sd">                (True) or the data file style format (False)</span>

<span class="sd">        **Returns**</span>

<span class="sd">            coeffs: *str*</span>
<span class="sd">                A string of angle coeffs, with new line characters between</span>
<span class="sd">                different angles.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">lammps_command</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">opls_structure_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">restrict_structures</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">restrict_structures</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">opls_structure_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">]</span>

        <span class="c1"># Loop through all possible angle parameters</span>
        <span class="n">index</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle_params</span><span class="p">:</span>
            <span class="c1"># Skip those that are not included</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ffh</span><span class="o">.</span><span class="n">check_restriction</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">restrict_structures</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="c1"># Get the angle coeff string</span>
            <span class="n">lammps_command</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="s2">&quot;angle_coeff&quot;</span> <span class="k">if</span> <span class="n">in_input_file</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot; </span><span class="si">%d</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">angle</span><span class="o">.</span><span class="n">printer</span><span class="p">()))</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lammps_command</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.dump_dihedrals"><a class="viewcode-back" href="../../../codebase.html#squid.forcefields.parameters.Parameters.dump_dihedrals">[docs]</a>    <span class="k">def</span> <span class="nf">dump_dihedrals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_input_file</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get a string for lammps input in regards to assigning dihedral coeffs.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            in_input_file: *bool, optional*</span>
<span class="sd">                Whether to dump the bonds in the input file style format</span>
<span class="sd">                (True) or the data file style format (False)</span>

<span class="sd">        **Returns**</span>

<span class="sd">            coeffs: *str*</span>
<span class="sd">                A string of dihedral coeffs, with new line characters between</span>
<span class="sd">                different dihedrals.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">lammps_command</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">opls_structure_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">restrict_structures</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">restrict_structures</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">opls_structure_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">]</span>

        <span class="c1"># Loop through all possible dihedral parameters</span>
        <span class="n">index</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">dihedral</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dihedral_params</span><span class="p">:</span>
            <span class="c1"># Skip those that are not included</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ffh</span><span class="o">.</span><span class="n">check_restriction</span><span class="p">(</span><span class="n">dihedral</span><span class="p">,</span> <span class="n">restrict_structures</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="c1"># Get the dihedral coeff string</span>
            <span class="n">lammps_command</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="s2">&quot;dihedral_coeff&quot;</span> <span class="k">if</span> <span class="n">in_input_file</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot; </span><span class="si">%d</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">dihedral</span><span class="o">.</span><span class="n">printer</span><span class="p">()))</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lammps_command</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.dump_lj_cut_coul_long"><a class="viewcode-back" href="../../../codebase.html#squid.forcefields.parameters.Parameters.dump_lj_cut_coul_long">[docs]</a>    <span class="k">def</span> <span class="nf">dump_lj_cut_coul_long</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function will get the lammps command line argument for</span>
<span class="sd">        lj/cut/coul/long of everything within the Parameters object.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            None</span>

<span class="sd">        **Returns**</span>

<span class="sd">            cmds: *str*</span>
<span class="sd">                A string, separated with new lines, with pair_coeff for each</span>
<span class="sd">                lj/cut/coul/long command possible within this parameter set.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">lammps_command</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">)):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">ffh</span><span class="o">.</span><span class="n">check_restriction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">ffh</span><span class="o">.</span><span class="n">check_restriction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="n">sigma_ij</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">sigma</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">sigma</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>
                <span class="n">epsilon_ij</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">epsilon</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>
                <span class="n">type_i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">type_j</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">type_i</span><span class="p">,</span> <span class="n">type_j</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">type_i</span><span class="p">,</span> <span class="n">type_j</span><span class="p">])</span>
                <span class="n">lammps_command</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;pair_coeff </span><span class="si">%d</span><span class="s1"> </span><span class="si">%d</span><span class="s1"> lj/cut/coul/long </span><span class="si">%f</span><span class="s1"> </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">type_i</span><span class="p">,</span> <span class="n">type_j</span><span class="p">,</span> <span class="n">epsilon_ij</span><span class="p">,</span> <span class="n">sigma_ij</span><span class="p">))</span>

        <span class="n">lammps_command</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lammps_command</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lammps_command</span></div>

<div class="viewcode-block" id="Parameters.dump_lj_cut_coul_cut"><a class="viewcode-back" href="../../../codebase.html#squid.forcefields.parameters.Parameters.dump_lj_cut_coul_cut">[docs]</a>    <span class="k">def</span> <span class="nf">dump_lj_cut_coul_cut</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function will get the lammps command line argument for</span>
<span class="sd">        lj/cut/coul/cut of everything within the Parameters object.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            None</span>

<span class="sd">        **Returns**</span>

<span class="sd">            cmds: *str*</span>
<span class="sd">                A string, separated with new lines, with pair_coeff for each</span>
<span class="sd">                lj/cut/coul/cut command possible within this parameter set.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">lammps_command</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">)):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">ffh</span><span class="o">.</span><span class="n">check_restriction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">ffh</span><span class="o">.</span><span class="n">check_restriction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="n">sigma_ij</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">sigma</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">sigma</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>
                <span class="n">epsilon_ij</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">epsilon</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>
                <span class="n">type_i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">type_j</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">type_i</span><span class="p">,</span> <span class="n">type_j</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">type_i</span><span class="p">,</span> <span class="n">type_j</span><span class="p">])</span>
                <span class="n">lammps_command</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;pair_coeff </span><span class="si">%d</span><span class="s1"> </span><span class="si">%d</span><span class="s1"> lj/cut/coul/cut </span><span class="si">%f</span><span class="s1"> </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">type_i</span><span class="p">,</span> <span class="n">type_j</span><span class="p">,</span> <span class="n">epsilon_ij</span><span class="p">,</span> <span class="n">sigma_ij</span><span class="p">))</span>

        <span class="n">lammps_command</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lammps_command</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lammps_command</span></div>

<div class="viewcode-block" id="Parameters.dump_smooths"><a class="viewcode-back" href="../../../codebase.html#squid.forcefields.parameters.Parameters.dump_smooths">[docs]</a>    <span class="k">def</span> <span class="nf">dump_smooths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function will get the lammps command line argument for</span>
<span class="sd">        smrff smooths of everything within the Parameters object.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            None</span>

<span class="sd">        **Returns**</span>

<span class="sd">            cmds: *str*</span>
<span class="sd">                A string, separated with new lines, with pair_coeff for each</span>
<span class="sd">                smrff smooth command possible within this parameter set.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">lammps_command</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">smooth</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">smooth_params</span><span class="p">:</span>
            <span class="n">lammps_command</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">smooth</span><span class="o">.</span><span class="n">dump_pair_coeffs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">))</span>
        <span class="n">lammps_command</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lammps_command</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lammps_command</span></div>

<div class="viewcode-block" id="Parameters.dump_tersoff"><a class="viewcode-back" href="../../../codebase.html#squid.forcefields.parameters.Parameters.dump_tersoff">[docs]</a>    <span class="k">def</span> <span class="nf">dump_tersoff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tfile_name</span><span class="p">,</span> <span class="n">tstyle_smrff</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function will get the lammps command line argument for</span>
<span class="sd">        tersoff of everything within the Parameters object.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            tfile_name: *str*</span>
<span class="sd">                The name of the tersoff file.</span>
<span class="sd">            tstyle_smrff: *bool, optional*</span>
<span class="sd">                Whether to output for SMRFF style (one line allocates memory,</span>
<span class="sd">                the rest overwrites the parameters) or not.  If True, this</span>
<span class="sd">                will NOT generate a tersoff file.</span>

<span class="sd">        **Returns**</span>

<span class="sd">            cmds: *str*</span>
<span class="sd">                A string, separated with new lines, with pair_coeff for each</span>
<span class="sd">                tersoff command possible within this parameter set.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">verify_tersoff_2body_symmetry</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span><span class="p">)</span>
        <span class="n">local_tersoff_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">local_tersoff_params</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span>
                <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">indices</span><span class="p">])</span>
            <span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_tfile</span><span class="p">:</span>
            <span class="n">tersoff_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">tfile_name</span> <span class="o">+</span> <span class="s2">&quot;.tersoff&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
            <span class="n">tersoff_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">local_tersoff_params</span><span class="p">]))</span>
            <span class="n">tersoff_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">lammps_command</span> <span class="o">=</span> <span class="s1">&#39;pair_coeff * * tersoff &#39;</span>
        <span class="n">lammps_command</span> <span class="o">+=</span> <span class="n">tfile_name</span> <span class="o">+</span> <span class="s1">&#39;.tersoff &#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tindices</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">local_tersoff_params</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">indices</span><span class="p">]</span>
            <span class="n">lammps_command</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                <span class="n">r</span> <span class="k">if</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">tindices</span> <span class="k">else</span> <span class="s2">&quot;NULL&quot;</span>
                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lammps_command</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tstyle_smrff</span><span class="p">:</span>
            <span class="n">lammps_command</span> <span class="o">=</span> <span class="p">[</span><span class="n">lammps_command</span><span class="p">]</span>
            <span class="n">lammps_command</span> <span class="o">+=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">dump_line</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">local_tersoff_params</span><span class="p">]</span>
            <span class="n">lammps_command</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lammps_command</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">lammps_command</span></div>

<div class="viewcode-block" id="Parameters.dump_morse"><a class="viewcode-back" href="../../../codebase.html#squid.forcefields.parameters.Parameters.dump_morse">[docs]</a>    <span class="k">def</span> <span class="nf">dump_morse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function will get the lammps command line argument for</span>
<span class="sd">        morse of everything within the Parameters object.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            None</span>

<span class="sd">        **Returns**</span>

<span class="sd">            cmds: *str*</span>
<span class="sd">                A string, separated with new lines, with pair_coeff for each</span>
<span class="sd">                morse command possible within this parameter set.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">lammps_command</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">morse_params</span><span class="p">)):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ffh</span><span class="o">.</span><span class="n">check_restriction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">morse_params</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">index_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">morse_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">index_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">morse_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="n">index_i</span><span class="p">,</span> <span class="n">index_j</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">index_i</span><span class="p">,</span> <span class="n">index_j</span><span class="p">])</span>

            <span class="n">D0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">morse_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">D0</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">morse_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">alpha</span>
            <span class="n">r0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">morse_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">r0</span>
            <span class="n">rc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">morse_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">rc</span>
            <span class="k">if</span> <span class="n">rc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">end_of_cmd</span> <span class="o">=</span> <span class="s1">&#39; morse </span><span class="si">%f</span><span class="s1"> </span><span class="si">%f</span><span class="s1"> </span><span class="si">%f</span><span class="s1"> </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">D0</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="n">rc</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">end_of_cmd</span> <span class="o">=</span> <span class="s1">&#39; morse </span><span class="si">%f</span><span class="s1"> </span><span class="si">%f</span><span class="s1"> </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">D0</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">r0</span><span class="p">)</span>
            <span class="n">lammps_command</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="s1">&#39;pair_coeff &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index_i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index_j</span><span class="p">)</span> <span class="o">+</span>
                <span class="n">end_of_cmd</span><span class="p">)</span>
        <span class="n">lammps_command</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lammps_command</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lammps_command</span></div>

<div class="viewcode-block" id="Parameters.dump_set_charge"><a class="viewcode-back" href="../../../codebase.html#squid.forcefields.parameters.Parameters.dump_set_charge">[docs]</a>    <span class="k">def</span> <span class="nf">dump_set_charge</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function will get the lammps command line argument for</span>
<span class="sd">        &quot;set type&quot; of everything within the Parameters object.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            None</span>

<span class="sd">        **Returns**</span>

<span class="sd">            cmds: *str*</span>
<span class="sd">                A string, separated with new lines, with pair_coeff for each</span>
<span class="sd">                morse command possible within this parameter set.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">lammps_command</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coul_params</span><span class="p">)):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ffh</span><span class="o">.</span><span class="n">check_restriction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coul_params</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">charge_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coul_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">charge</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coul_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="n">lammps_command</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="s1">&#39;set type </span><span class="si">%d</span><span class="s1"> charge </span><span class="si">%f</span><span class="s1">&#39;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">charge_i</span><span class="p">))</span>
        <span class="n">lammps_command</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lammps_command</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lammps_command</span></div>

<div class="viewcode-block" id="Parameters.get_smrff_style"><a class="viewcode-back" href="../../../codebase.html#squid.forcefields.parameters.Parameters.get_smrff_style">[docs]</a>    <span class="k">def</span> <span class="nf">get_smrff_style</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This will return the smrff style.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Expand ters to tersoff</span>
        <span class="n">get</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="s2">&quot;tersoff&quot;</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;ters&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;pair_style smrff &quot;</span> <span class="o">+</span>\
            <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">get</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span>
                      <span class="k">for</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">smoothed_pair_potentials</span><span class="p">])</span> <span class="o">+</span>\
            <span class="s2">&quot; smooth &quot;</span> <span class="o">+</span>\
            <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">smoothed_pair_potentials</span><span class="p">])</span></div>

<div class="viewcode-block" id="Parameters.fix"><a class="viewcode-back" href="../../../codebase.html#squid.forcefields.parameters.Parameters.fix">[docs]</a>    <span class="k">def</span> <span class="nf">fix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function will fix a specific style (coul, lj, morse, etc), label</span>
<span class="sd">        (where label is the atom label/type you want to fix), and the component</span>
<span class="sd">        (ex, sigma in LJ).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">style</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">style</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;coul&quot;</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coul_params</span><span class="p">,</span>\
                <span class="s2">&quot;Label </span><span class="si">%s</span><span class="s2"> does not exist in coulomb list!&quot;</span> <span class="o">%</span> <span class="n">label</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coul_params</span><span class="p">)</span> <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="n">label</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">coul_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">style</span> <span class="o">==</span> <span class="s2">&quot;lj&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">,</span>\
                <span class="s2">&quot;Label </span><span class="si">%s</span><span class="s2"> does not exist in lj list!&quot;</span> <span class="o">%</span> <span class="n">label</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">)</span> <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="n">label</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lj_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">style</span> <span class="o">==</span> <span class="s2">&quot;morse&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">morse_params</span><span class="p">,</span>\
                <span class="s2">&quot;Label </span><span class="si">%s</span><span class="s2"> does not exist in morse list!&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">morse_params</span><span class="p">)</span> <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="n">label</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">morse_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">style</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;ters&quot;</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span><span class="p">,</span>\
                <span class="s2">&quot;Label </span><span class="si">%s</span><span class="s2"> does not exist in tersoff list!&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span><span class="p">)</span> <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="n">label</span><span class="p">]</span>
            <span class="n">two_body_strings</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;beta&quot;</span><span class="p">,</span> <span class="s2">&quot;lambda1&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;lambda2&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
                <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">indices</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="n">b</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">==</span> <span class="n">c</span> <span class="ow">and</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">two_body_strings</span><span class="p">:</span>
                    <span class="c1"># We must handle symmetry constraints for</span>
                    <span class="c1"># 2-body parameters!</span>
                    <span class="n">i2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span><span class="o">.</span><span class="n">index</span><span class="p">((</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span><span class="p">[</span><span class="n">i2</span><span class="p">]</span><span class="o">.</span><span class="n">update_2body</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">verify_tersoff_2body_symmetry</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tersoff_params</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Cannot handle the style </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">style</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameters.num_free_parameters"><a class="viewcode-back" href="../../../codebase.html#squid.forcefields.parameters.Parameters.num_free_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">num_free_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function will return the number of unfixed parameters.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">pkg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">with_indices</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">with_bounds</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">pkg</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">([</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">low</span> <span class="o">==</span> <span class="n">val</span> <span class="o">==</span> <span class="n">up</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">up</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">pkg</span><span class="p">)])</span></div></div>


<span class="k">def</span> <span class="nf">run_unit_tests</span><span class="p">():</span>
    <span class="n">TEST_SMRFF_FILE</span> <span class="o">=</span> <span class="s2">&quot;./potentials/junk.smrff&quot;</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">&quot;82&quot;</span><span class="p">,</span> <span class="s2">&quot;86&quot;</span><span class="p">,</span> <span class="s2">&quot;xA&quot;</span><span class="p">,</span> <span class="s2">&quot;xB&quot;</span><span class="p">],</span>
        <span class="n">opls_file</span><span class="o">=</span><span class="n">OPLS_FILE</span><span class="p">,</span>
        <span class="n">smrff_file</span><span class="o">=</span><span class="n">TEST_SMRFF_FILE</span>
    <span class="p">)</span>
    <span class="n">params</span><span class="o">.</span><span class="n">set_all_masks</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">params_s</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">COULOMB</span>
<span class="s1">82 -0.06 C 12.0110</span>
<span class="s1">86 0.00 C 12.0110</span>
<span class="s1">xA 1.12 A 207.2000</span>
<span class="s1">xB -1.12 B 32.0650</span>
<span class="s1">END</span>
<span class="s1">LENNARD-JONES</span>
<span class="s1">82 3.5000 0.0660</span>
<span class="s1">86 3.5500 0.0760</span>
<span class="s1">xA 4.7301 0.1200</span>
<span class="s1">xB 4.0734 1.0000</span>
<span class="s1">END</span>
<span class="s1">TERSOFF</span>
<span class="s1">xA xA xA      3   1.0000   2.0000   21218.2000   35.9740   -0.5722</span>
<span class="s1">         2.0000   0.9321   5.0000   300000.0000   4.0000   0.5000   0.5000   2013.0619</span>


<span class="s1">xA xA xB      3   1.0000   2.0000   50125.5000   1.5467   -0.7817</span>
<span class="s1">         1.0000   1.0000   1.0000   1.0000   4.0000   0.5000   1.0000   1.0000</span>


<span class="s1">xA xB xA      3   1.0000   2.0000   138928.4000   1.8615   -0.7895</span>
<span class="s1">         1.0000   1.0000   1.0000   1.0000   4.0000   0.5000   1.0000   1.0000</span>


<span class="s1">xA xB xB      3   1.0000   0.0000   137831.5000   25.2881   0.5199</span>
<span class="s1">         2.0000   0.1228   0.5212   32831.9500   4.0000   0.5000   3.8233   300000.0000</span>


<span class="s1">xB xA xA      3   1.0000   0.2508   6137.3000   4.9407   -0.8608</span>
<span class="s1">         2.0000   0.1228   0.5212   32831.9500   4.0000   0.5000   3.8233   300000.0000</span>


<span class="s1">xB xA xB      3   1.0000   2.0000   150000.0000   0.6242   0.1138</span>
<span class="s1">         1.0000   1.0000   1.0000   1.0000   4.0000   0.5000   1.0000   1.0000</span>


<span class="s1">xB xB xA      3   1.0000   2.0000   96962.7000   28.1901   0.2540</span>
<span class="s1">         1.0000   1.0000   1.0000   1.0000   4.0000   0.5000   1.0000   1.0000</span>


<span class="s1">xB xB xB      3   1.0000   2.0000   7389.8000   6.6376   -0.8337</span>
<span class="s1">         2.0000   0.0261   5.0000   300000.0000   4.0000   0.5000   5.0000   190979.5870</span>


<span class="s1">END</span>
<span class="s1">MORSE</span>
<span class="s1">xA xA      100.0000000   2.0000000   1.6000000   3.0000000</span>
<span class="s1">xA xB      100.0000000   2.0000000   1.7000000   3.0000000</span>
<span class="s1">xB xB      100.0000000   2.0000000   1.8000000   3.0000000</span>
<span class="s1">END</span>
<span class="s1">BONDS</span>
<span class="s1">13 13 268.000 1.529</span>
<span class="s1">13 47 317.000 1.510</span>
<span class="s1">47 47 549.000 1.340</span>
<span class="s1">END</span>
<span class="s1">ANGLES</span>
<span class="s1">13 13 13 58.350 112.700</span>
<span class="s1">13 13 47 63.000 111.100</span>
<span class="s1">47 13 47 63.000 112.400</span>
<span class="s1">13 47 13 70.000 130.000</span>
<span class="s1">13 47 47 70.000 124.000</span>
<span class="s1">END</span>
<span class="s1">DIHEDRALS</span>
<span class="s1">13 13 13 13 1.300 -0.050 0.200 0.000</span>
<span class="s1">13 13 47 13 2.817 -0.169 0.543 0.000</span>
<span class="s1">13 13 47 47 0.346 0.405 -0.904 0.000</span>
<span class="s1">47 13 47 13 0.000 -8.000 0.000 0.000</span>
<span class="s1">13 47 47 13 0.000 14.000 0.000 0.000</span>
<span class="s1">13 13 13 47 1.300 -0.050 0.200 0.000</span>
<span class="s1">END</span>
<span class="s1">SMOOTHS</span>
<span class="s1">0   xA  xB  4.0 0.5 4.5 r</span>
<span class="s1">0   xA  xB  4.0 0.5 4.5 l</span>
<span class="s1">0   xA  xB  4.0 0.5 4.5 9.0 0.4 9.4</span>
<span class="s1">c0  0   1   xA  xB  2.5 0.5 3.0 4.5 0.5 5.0 6.5 0.5 7.0</span>
<span class="s1">c1  0   1   xA  xB  2.5 0.5 3.0 4.5 0.5 5.0</span>
<span class="s1">c2  0   1   xA  xB  2.5 0.5 3.0 4.5 0.5 5.0</span>
<span class="s1">END</span>
<span class="s1">&#39;&#39;&#39;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">params_s_chk</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">params</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">a</span> <span class="o">==</span> <span class="n">b</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">params_s</span><span class="p">,</span> <span class="n">params_s_chk</span><span class="p">)]),</span>\
        <span class="s2">&quot;Error - String format output of Parameters has changed.&quot;</span>

    <span class="c1"># Generate a random parameter set 1</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">([</span><span class="s2">&quot;xPb&quot;</span><span class="p">,</span> <span class="s2">&quot;xS&quot;</span><span class="p">,</span> <span class="s2">&quot;xSe&quot;</span><span class="p">])</span>
    <span class="n">P</span><span class="o">.</span><span class="n">smrff_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;xPb&quot;</span><span class="p">,</span> <span class="s2">&quot;xS&quot;</span><span class="p">,</span> <span class="s2">&quot;xSe&quot;</span><span class="p">]</span>
    <span class="n">P</span><span class="o">.</span><span class="n">set_smoothed_pair_potentials</span><span class="p">([</span>
        <span class="p">(</span><span class="s2">&quot;morse&quot;</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="s2">&quot;sin_r&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;lj/cut/coul/long&quot;</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="s2">&quot;sin_l&quot;</span><span class="p">)</span>
    <span class="p">])</span>
    <span class="n">P</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">&quot;Pb&quot;</span><span class="p">,</span> <span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;Se&quot;</span><span class="p">],</span>
        <span class="n">signs</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">couple_smooths</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">tersoff_form</span><span class="o">=</span><span class="s2">&quot;original&quot;</span>
    <span class="p">)</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">unpack</span><span class="p">()</span>
    <span class="n">P</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">unpack</span><span class="p">())</span>
    <span class="n">t2</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">unpack</span><span class="p">()</span>
    <span class="n">P</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">unpack</span><span class="p">())</span>
    <span class="n">t3</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">unpack</span><span class="p">()</span>
    <span class="n">EPS</span> <span class="o">=</span> <span class="mf">1E-4</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">EPS</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">)]),</span>\
        <span class="s2">&quot;Error - Failed to pack and unpack.&quot;</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">EPS</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t3</span><span class="p">)]),</span>\
        <span class="s2">&quot;Error - Failed to pack and unpack.&quot;</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">EPS</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span> <span class="n">t3</span><span class="p">)]),</span>\
        <span class="s2">&quot;Error - Failed to pack and unpack.&quot;</span>

    <span class="c1"># Generate a random parameter set 2</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">([</span><span class="s2">&quot;xPb&quot;</span><span class="p">,</span> <span class="s2">&quot;xS&quot;</span><span class="p">])</span>
    <span class="n">P</span><span class="o">.</span><span class="n">smrff_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;xPb&quot;</span><span class="p">,</span> <span class="s2">&quot;xS&quot;</span><span class="p">]</span>
    <span class="n">P</span><span class="o">.</span><span class="n">set_smoothed_pair_potentials</span><span class="p">([</span>
        <span class="p">(</span><span class="s2">&quot;tersoff&quot;</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="s2">&quot;NULL&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;lj/cut/coul/long&quot;</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="s2">&quot;ters_l&quot;</span><span class="p">)</span>
    <span class="p">])</span>
    <span class="n">P</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">&quot;Pb&quot;</span><span class="p">,</span> <span class="s2">&quot;S&quot;</span><span class="p">],</span>
        <span class="n">signs</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">couple_smooths</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">tersoff_form</span><span class="o">=</span><span class="s2">&quot;original&quot;</span>
    <span class="p">)</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">unpack</span><span class="p">()</span>
    <span class="n">P</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">t1</span><span class="p">)</span>
    <span class="n">P</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">unpack</span><span class="p">())</span>
    <span class="n">t2</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">unpack</span><span class="p">()</span>
    <span class="n">P</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">unpack</span><span class="p">())</span>
    <span class="n">t3</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">unpack</span><span class="p">()</span>
    <span class="n">EPS</span> <span class="o">=</span> <span class="mf">1E-4</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">EPS</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">)]),</span>\
        <span class="s2">&quot;Error - Failed to pack and unpack.&quot;</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">EPS</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t3</span><span class="p">)]),</span>\
        <span class="s2">&quot;Error - Failed to pack and unpack.&quot;</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">EPS</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span> <span class="n">t3</span><span class="p">)]),</span>\
        <span class="s2">&quot;Error - Failed to pack and unpack.&quot;</span>

    <span class="n">values</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">with_bounds</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">with_bounds</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">u</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)),</span> <span class="n">values</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">u</span> <span class="o">!=</span> <span class="n">l</span><span class="p">:</span>
            <span class="n">t1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span> <span class="o">+</span> <span class="mf">0.001</span>
    <span class="n">P</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="n">t2</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">unpack</span><span class="p">()</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="o">==</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">t2</span><span class="p">)]),</span>\
        <span class="s2">&quot;Error - pack/unpack failed.&quot;</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">run_unit_tests</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../../../index.html">Table of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../squid.html">Squid</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../console_scripts.html">Console Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples.html">Examples</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Squid 2.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Henry Herbol.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
  </body>
</html>