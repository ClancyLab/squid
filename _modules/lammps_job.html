
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>lammps_job &#8212; Squid 0.0.1 documentation</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Squid 0.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for lammps_job</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The lammps_job module contains .</span>

<span class="sd">- :func:`read`</span>
<span class="sd">- :func:`read_dump`</span>
<span class="sd">- :func:`job`</span>
<span class="sd">- :func:`read_TIP4P_types`</span>
<span class="sd">- :func:`PotEngSurfaceJob`</span>
<span class="sd">- :func:`PotEngSurfaceJob_v2`</span>
<span class="sd">- :func:`OptJob`</span>
<span class="sd">- :func:`thermo_2_text`</span>
<span class="sd">- :func:`read_thermo`</span>
<span class="sd">- :class:`lmp_task`</span>

<span class="sd">------------</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># System imports</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">cPickle</span> <span class="k">as</span> <span class="nn">pickle</span>
<span class="c1"># Clancelot imports</span>
<span class="kn">from</span> <span class="nn">lammps_log</span> <span class="k">import</span> <span class="n">lammps_log</span>
<span class="kn">import</span> <span class="nn">files</span>
<span class="kn">import</span> <span class="nn">sysconst</span>
<span class="kn">import</span> <span class="nn">jobs</span>
<span class="kn">import</span> <span class="nn">structures</span>
<span class="kn">from</span> <span class="nn">joust_task</span> <span class="k">import</span> <span class="n">_jtask</span>

<span class="c1"># This module provides a framework for submitting and reading lammps</span>
<span class="c1"># jobs sent through the NBS queue. LAMMPS is inherently flexible.</span>
<span class="c1"># However, in order to provide a smooth user experience, this module</span>
<span class="c1"># expects certain dump files and formats.</span>
<span class="c1"># 1) The job will be created in lammps/run_name/</span>
<span class="c1"># 2) The log file is named run_name.log</span>
<span class="c1"># 3) The data file is named run_name.data</span>
<span class="c1"># 4) The default dump file is named dump.run_name.lammpstrj</span>
<span class="c1"># 5) The final simulation configuration can be found in final.lammpstrj</span>


<span class="c1"># A function to read both a log file containing thermo information and</span>
<span class="c1"># (optional) a lammpstrj file</span>
<div class="viewcode-block" id="read"><a class="viewcode-back" href="../codebase.html#lammps_job.read">[docs]</a><span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">run_name</span><span class="p">,</span> <span class="n">trj_file</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">xyz_file</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">read_atoms</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
         <span class="n">read_timesteps</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">read_num_atoms</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">read_box_bounds</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    General read in of thermo information from a lammps log file,</span>
<span class="sd">    as well as (optionally) a lammps trajectory file (.lammpstrj).</span>

<span class="sd">    NOTE! This is important. If you plan to use this function, you</span>
<span class="sd">    MUST have &quot;Step&quot; in your LAMMPs Thermo output.</span>

<span class="sd">    **Parameters**</span>

<span class="sd">        run_name: *str*</span>
<span class="sd">            Lammps .log file to be parsed.  Note, this is WITHOUT</span>
<span class="sd">            the extension (ex. test_lmp instead of test_lmp.log).</span>
<span class="sd">        trj_file: *str, optional*</span>
<span class="sd">            Pass the path to a lammps trajectory file.  Relative paths are</span>
<span class="sd">            assumed to be in a subfolder&quot;lammps/RUN_NAME/RUN_NAME.lammpstrj&quot;.</span>
<span class="sd">        xyz_file: *str, optional*</span>
<span class="sd">            Pass the path to a lammps xyz output.  Relative paths are</span>
<span class="sd">            assumed to be in a subfolder &quot;lammps/RUN_NAME/RUN_NAME.xyz&quot;.</span>
<span class="sd">        read_atoms: *bool, optional*</span>
<span class="sd">            Whether to read in the atom information.</span>
<span class="sd">        read_timesteps: *bool, optional*</span>
<span class="sd">            Whether to read in the timesteps (True), or not (False).</span>
<span class="sd">        read_num_atoms: *bool, optional*</span>
<span class="sd">            Whether to read in the number of atoms (True), or not (False).</span>
<span class="sd">        read_box_bounds: *bool, optional*</span>
<span class="sd">            Whether to read in the system box boundaries (True), or</span>
<span class="sd">            not (False).</span>

<span class="sd">    **Returns**</span>

<span class="sd">        lg:</span>
<span class="sd">            Lammps log file, parsed.</span>
<span class="sd">        data_trj:</span>
<span class="sd">            Trajectory file, if it exists.</span>
<span class="sd">        data_xyz:</span>
<span class="sd">            XYZ file, if it exists.</span>

<span class="sd">        NOTE! THE OUTPUT SHOULD BE:</span>

<span class="sd">        data: :class:`results.sim_out`</span>
<span class="sd">            Generic LAMMPs output object containing all parsed results.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Format log file name</span>
    <span class="c1"># Allow absolute paths as filenames</span>
    <span class="k">if</span> <span class="n">run_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">):</span>
        <span class="n">log_path</span> <span class="o">=</span> <span class="n">run_name</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">log_path</span> <span class="o">=</span> <span class="s1">&#39;lammps/</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">.log&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">run_name</span><span class="p">,</span> <span class="n">run_name</span><span class="p">)</span>

    <span class="c1"># Check if log file exists, and open</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">log_path</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Expected lammps log file does not exist </span><span class="se">\</span>
<span class="s1">at </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">log_path</span><span class="p">))</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lg</span> <span class="o">=</span> <span class="n">lammps_log</span><span class="p">(</span><span class="n">log_path</span><span class="p">)</span>
        <span class="n">lg</span><span class="o">.</span><span class="n">last_modified</span> <span class="o">=</span> <span class="n">files</span><span class="o">.</span><span class="n">last_modified</span><span class="p">(</span><span class="n">log_path</span><span class="p">)</span>

    <span class="c1"># If no trj_file selected, try default name of dump.run_name.lammpstrj</span>
    <span class="k">if</span> <span class="n">trj_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">trj_file</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">trj_path</span> <span class="o">=</span> <span class="s1">&#39;lammps/</span><span class="si">%s</span><span class="s1">/dump.</span><span class="si">%s</span><span class="s1">.lammpstrj&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">run_name</span><span class="p">,</span> <span class="n">run_name</span><span class="p">)</span>
        <span class="c1"># Allow absolute paths as filenames</span>
        <span class="k">elif</span> <span class="n">run_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">):</span>
            <span class="n">trj_path</span> <span class="o">=</span> <span class="n">trj_file</span>
        <span class="c1"># Open the specified file in the run_name folder</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">trj_path</span> <span class="o">=</span> <span class="s1">&#39;lammps/</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">run_name</span><span class="p">,</span> <span class="n">trj_file</span><span class="p">)</span>

        <span class="c1"># Try to import lammpstrj file exists</span>
        <span class="n">data_trj</span> <span class="o">=</span> <span class="n">files</span><span class="o">.</span><span class="n">read_lammpstrj</span><span class="p">(</span><span class="n">trj_path</span><span class="p">,</span>
                                        <span class="n">read_atoms</span><span class="o">=</span><span class="n">read_atoms</span><span class="p">,</span>
                                        <span class="n">read_timesteps</span><span class="o">=</span><span class="n">read_timesteps</span><span class="p">,</span>
                                        <span class="n">read_num_atoms</span><span class="o">=</span><span class="n">read_num_atoms</span><span class="p">,</span>
                                        <span class="n">read_box_bounds</span><span class="o">=</span><span class="n">read_box_bounds</span><span class="p">)</span>
        <span class="n">data_trj</span><span class="o">.</span><span class="n">last_modified</span> <span class="o">=</span> <span class="n">files</span><span class="o">.</span><span class="n">last_modified</span><span class="p">(</span><span class="n">trj_path</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">data_trj</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">xyz_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">xyz_file</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">xyz_path</span> <span class="o">=</span> <span class="s1">&#39;lammps/</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">.xyz&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">run_name</span><span class="p">,</span> <span class="n">run_name</span><span class="p">)</span>
        <span class="c1"># Allow absolute paths as filenames</span>
        <span class="k">elif</span> <span class="n">run_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">):</span>
            <span class="n">xyz_path</span> <span class="o">=</span> <span class="n">xyz_file</span>
        <span class="c1"># Open the specified file in the run_name folder</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xyz_path</span> <span class="o">=</span> <span class="s1">&#39;lammps/</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">run_name</span><span class="p">,</span> <span class="n">xyz_file</span><span class="p">)</span>
        <span class="n">data_xyz</span> <span class="o">=</span> <span class="n">files</span><span class="o">.</span><span class="n">read_xyz</span><span class="p">(</span><span class="n">xyz_path</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">data_xyz</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">lg</span><span class="p">,</span> <span class="n">data_trj</span><span class="p">,</span> <span class="n">data_xyz</span></div>


<span class="c1"># A function to read in a generic dump file</span>
<div class="viewcode-block" id="read_dump"><a class="viewcode-back" href="../codebase.html#lammps_job.read_dump">[docs]</a><span class="k">def</span> <span class="nf">read_dump</span><span class="p">(</span><span class="n">fptr</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="s2">&quot;.dump&quot;</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">],</span> <span class="n">extras</span><span class="o">=</span><span class="p">[]):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to read in a generic dump file.  Currently it (1) requires</span>
<span class="sd">    element, x, y, z in the dump.  You can also use xu, yu, and zu if</span>
<span class="sd">    the unwraped flag is set to True.</span>

<span class="sd">    Due to individual preference, the extension was separated.  Thus,</span>
<span class="sd">    if you dump to .xyz, have ext=&quot;.xyz&quot;, etc.</span>

<span class="sd">    **Parameters**</span>

<span class="sd">        fptr: *str*</span>
<span class="sd">            Name of the dump file with NO extension (ex. &#39;run&#39; instead</span>
<span class="sd">            of &#39;run.dump&#39;).  This can also be a relative path.  If no relative</span>
<span class="sd">            path is given, and the file cannot be found, it will default</span>
<span class="sd">            check in lammps/fptr/fptr+ext.</span>
<span class="sd">        ext: *str, optional*</span>
<span class="sd">            The extension for the dump file.  Note, this is default &quot;.dump&quot;</span>
<span class="sd">            but can be anything (ensure you have the &quot;.&quot;).</span>
<span class="sd">        coordinates: *list, str, optional*</span>
<span class="sd">            A list of strings describing how the coordinates are</span>
<span class="sd">            specified (x vs xs vs xu vs xsu)</span>
<span class="sd">        extras: *list, str, optional*</span>
<span class="sd">            An additional list of things you want to read in from the dump</span>
<span class="sd">            file.</span>

<span class="sd">    **Returns**</span>

<span class="sd">        frames: *list, list* :class:`structures.Atom`</span>
<span class="sd">            A list of lists, each holding atom structures.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check if file exists. If not, try subfolder</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fptr</span> <span class="o">+</span> <span class="n">ext</span><span class="p">):</span>
        <span class="n">fptr</span> <span class="o">=</span> <span class="s2">&quot;lammps/</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fptr</span><span class="p">,</span> <span class="n">fptr</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fptr</span> <span class="o">+</span> <span class="n">ext</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;File </span><span class="si">%s</span><span class="s2"> nor </span><span class="si">%s</span><span class="s2"> exists&quot;</span>
                            <span class="o">%</span> <span class="p">(</span><span class="n">fptr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">fptr</span><span class="p">))</span>
    <span class="c1"># Read in the file</span>
    <span class="n">raw_out</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fptr</span> <span class="o">+</span> <span class="n">ext</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="c1"># Read in box bounds here</span>
    <span class="n">s_find</span> <span class="o">=</span> <span class="s2">&quot;ITEM: BOX BOUNDS&quot;</span>
    <span class="n">x_lo_hi</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">y_lo_hi</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">z_lo_hi</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">s_find</span> <span class="ow">in</span> <span class="n">raw_out</span><span class="p">:</span>
        <span class="n">bb</span> <span class="o">=</span> <span class="n">raw_out</span><span class="p">[</span><span class="n">raw_out</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">s_find</span><span class="p">):]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">x_lo_hi</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
        <span class="n">y_lo_hi</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
        <span class="n">z_lo_hi</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bb</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>

    <span class="c1"># Find &quot;ITEM: ATOMS &quot;, this is output</span>
    <span class="n">s_find</span> <span class="o">=</span> <span class="s2">&quot;ITEM: ATOMS &quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s_find</span><span class="p">)</span>
    <span class="c1"># Determine what we have in this output</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="n">raw_out</span><span class="p">[</span><span class="n">raw_out</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">s_find</span><span class="p">):]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">:]</span>
    <span class="n">column</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">values_of_extras</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">headers</span><span class="p">):</span>
        <span class="n">column</span><span class="p">[</span><span class="n">h</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>

    <span class="c1"># If we are getting coordinates, specify</span>
    <span class="n">s_x</span><span class="p">,</span> <span class="n">s_y</span><span class="p">,</span> <span class="n">s_z</span> <span class="o">=</span> <span class="n">coordinates</span>

    <span class="n">frames</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="n">s_find</span> <span class="ow">in</span> <span class="n">raw_out</span><span class="p">:</span>
        <span class="c1"># Set pointer to start of an output line</span>
        <span class="n">raw_out</span> <span class="o">=</span> <span class="n">raw_out</span><span class="p">[</span><span class="n">raw_out</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">s_find</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span><span class="p">:]</span>
        <span class="c1"># Make empty frame to store data</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Get data set into a buffer</span>
        <span class="n">buf</span> <span class="o">=</span> <span class="n">raw_out</span><span class="p">[:</span><span class="n">raw_out</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;ITEM:&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="c1"># Normally last line is blank. But for the last iteration</span>
        <span class="c1"># it isn&#39;t, so don&#39;t skip the data.</span>
        <span class="k">if</span> <span class="n">buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">buf</span> <span class="o">=</span> <span class="n">buf</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># Store data</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">buf</span><span class="p">:</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="s2">&quot;element&quot;</span> <span class="ow">in</span> <span class="n">column</span><span class="p">:</span>
                <span class="n">elem</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">column</span><span class="p">[</span><span class="s2">&quot;element&quot;</span><span class="p">]]</span>
            <span class="k">elif</span> <span class="s2">&quot;type&quot;</span> <span class="ow">in</span> <span class="n">column</span><span class="p">:</span>
                <span class="n">elem</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">column</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Needs either element or type&quot;</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">column</span><span class="p">[</span><span class="n">s_x</span><span class="p">]])</span>
            <span class="n">y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">column</span><span class="p">[</span><span class="n">s_y</span><span class="p">]])</span>
            <span class="n">z</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">column</span><span class="p">[</span><span class="n">s_z</span><span class="p">]])</span>
            <span class="k">if</span> <span class="n">s_x</span> <span class="o">==</span> <span class="s2">&quot;xs&quot;</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="n">x_lo_hi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_lo_hi</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">x_lo_hi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">s_y</span> <span class="o">==</span> <span class="s2">&quot;ys&quot;</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="n">y_lo_hi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_lo_hi</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">y_lo_hi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">s_z</span> <span class="o">==</span> <span class="s2">&quot;zs&quot;</span><span class="p">:</span>
                <span class="n">z</span> <span class="o">=</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="n">z_lo_hi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">z_lo_hi</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">z_lo_hi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;id&quot;</span> <span class="ow">in</span> <span class="n">column</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">column</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="s2">&quot;type&quot;</span> <span class="ow">in</span> <span class="n">column</span><span class="p">:</span>
                <span class="n">a_type</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">column</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">a_type</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">extras</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">column</span><span class="p">:</span>
                    <span class="n">values_of_extras</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">column</span><span class="p">[</span><span class="n">e</span><span class="p">]]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">values_of_extras</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">structures</span><span class="o">.</span><span class="n">Atom</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">type_index</span><span class="o">=</span><span class="n">a_type</span><span class="p">)</span>
            <span class="n">a</span><span class="o">.</span><span class="n">extras</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">values_of_extras</span><span class="p">)</span>
            <span class="n">frame</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">frames</span></div>


<span class="c1"># A function to run an LAMMPS Simulation. Requires a run name and a string</span>
<span class="c1"># of lammps code (run_name and input_script)</span>
<div class="viewcode-block" id="job"><a class="viewcode-back" href="../codebase.html#lammps_job.job">[docs]</a><span class="k">def</span> <span class="nf">job</span><span class="p">(</span><span class="n">run_name</span><span class="p">,</span>
        <span class="n">input_script</span><span class="p">,</span>
        <span class="n">system</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">queue</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">procs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">email</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">pair_coeffs_included</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">hybrid_pair</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">hybrid_angle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">TIP4P</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">no_echo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">redundancy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">lmp_path</span><span class="o">=</span><span class="n">sysconst</span><span class="o">.</span><span class="n">lmp_path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wrapper to submitting a LAMMPs simulation.</span>

<span class="sd">    **Parameters**</span>

<span class="sd">        run_name: *str*</span>
<span class="sd">            Name of the simulation to be run.</span>
<span class="sd">        input_script: *str*</span>
<span class="sd">            Input script for LAMMPs simulation.</span>
<span class="sd">        system: :class:`structures.System`</span>
<span class="sd">            System object for our simulation.</span>
<span class="sd">        queue: *str, optional*</span>
<span class="sd">            What queue to run the simulation on (queueing system dependent).</span>
<span class="sd">        procs: *int, optional*</span>
<span class="sd">            How many processors to run the simulation on.</span>
<span class="sd">        email: *str, optional*</span>
<span class="sd">            An email address for sending job information to.</span>
<span class="sd">        pair_coeffs_included: *bool, optional*</span>
<span class="sd">            Whether we have included the pair coefficients to be written</span>
<span class="sd">            to our lammps data file.</span>
<span class="sd">        hybrid_pair: *bool, optional*</span>
<span class="sd">            Whether to detect different treatments of pairing interactions</span>
<span class="sd">            amongst different atom types(True), or not (False).</span>
<span class="sd">        hybrid_angle: *bool, optional*</span>
<span class="sd">            Whether to detect different treatments of angles amongst different</span>
<span class="sd">            atom types (True), or not (False).</span>
<span class="sd">        TIP4P: *bool, optional*</span>
<span class="sd">            Whether to identify TIP4P settings within the lammps data file and</span>
<span class="sd">            update the input file (True), or not (False).</span>
<span class="sd">        no_echo: *bool, optional*</span>
<span class="sd">            Whether to pipe the terminal output to a file instead of printing.</span>
<span class="sd">        redundancy: *bool, optional*</span>
<span class="sd">            With redundancy on, if the job is submitted and unique_name is on, then</span>
<span class="sd">            if another job of the same name is running, a pointer to that job will</span>
<span class="sd">            instead be returned.</span>
<span class="sd">        lmp_path: *str, optional*</span>
<span class="sd">            The path to the lammps executable. Note, by default this is the</span>
<span class="sd">            one defined during installation, saved in sysconst.lmp_path.</span>

<span class="sd">    **Returns**</span>

<span class="sd">        job: :class:`jobs.Job`</span>
<span class="sd">            If running locally, return the process handle, else return the</span>
<span class="sd">            job container.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">run_name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">31</span> <span class="ow">and</span> <span class="n">queue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Job name too long (</span><span class="si">%d</span><span class="s2">) for NBS. Max character </span><span class="se">\</span>
<span class="s2">length is 31.&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">run_name</span><span class="p">))</span>

    <span class="c1"># Change to correct directory</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;mkdir -p lammps/</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">run_name</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;lammps/</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">run_name</span><span class="p">)</span>

    <span class="c1"># Generate the lammps data file</span>
    <span class="k">if</span> <span class="n">system</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">files</span><span class="o">.</span><span class="n">write_lammps_data</span><span class="p">(</span><span class="n">system</span><span class="p">,</span>
                                <span class="n">pair_coeffs_included</span><span class="o">=</span><span class="n">pair_coeffs_included</span><span class="p">,</span>
                                <span class="n">hybrid_pair</span><span class="o">=</span><span class="n">hybrid_pair</span><span class="p">,</span>
                                <span class="n">hybrid_angle</span><span class="o">=</span><span class="n">hybrid_angle</span><span class="p">)</span>

    <span class="c1"># If TIP4P water is used, read the data file for the correct TIP4P</span>
    <span class="c1"># types then inject into the input script</span>
    <span class="k">if</span> <span class="n">TIP4P</span><span class="p">:</span>
        <span class="n">otype</span><span class="p">,</span> <span class="n">htype</span><span class="p">,</span> <span class="n">btype</span><span class="p">,</span> <span class="n">atype</span> <span class="o">=</span> <span class="n">read_TIP4P_types</span><span class="p">(</span><span class="n">run_name</span> <span class="o">+</span> <span class="s1">&#39;.data&#39;</span><span class="p">)</span>

        <span class="c1"># Looking for TIP4P related strings:</span>
        <span class="n">input_script</span> <span class="o">=</span> <span class="n">input_script</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;TIP4P_otype&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">otype</span><span class="p">))</span>
        <span class="n">input_script</span> <span class="o">=</span> <span class="n">input_script</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;TIP4P_htype&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">htype</span><span class="p">))</span>
        <span class="n">input_script</span> <span class="o">=</span> <span class="n">input_script</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;TIP4P_btype&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">btype</span><span class="p">))</span>
        <span class="n">input_script</span> <span class="o">=</span> <span class="n">input_script</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;TIP4P_atype&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">atype</span><span class="p">))</span>

    <span class="c1"># Write the lammps input script. Expects lines of lammps code</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">run_name</span> <span class="o">+</span> <span class="s1">&#39;.in&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">input_script</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1"># Run the simulation</span>
    <span class="k">if</span> <span class="n">queue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cmd_to_run</span> <span class="o">=</span> <span class="n">sysconst</span><span class="o">.</span><span class="n">lmp_env_vars</span>
        <span class="n">cmd_to_run</span> <span class="o">=</span> <span class="n">cmd_to_run</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="s2"> -in </span><span class="si">%s</span><span class="s2">.in -log </span><span class="si">%s</span><span class="s2">.log&quot;</span>\
            <span class="o">%</span> <span class="p">(</span><span class="n">lmp_path</span><span class="p">,</span> <span class="n">run_name</span><span class="p">,</span> <span class="n">run_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">no_echo</span><span class="p">:</span>
            <span class="n">cmd_to_run</span> <span class="o">+=</span> <span class="s2">&quot; &gt; &quot;</span> <span class="o">+</span> <span class="n">run_name</span> <span class="o">+</span> <span class="s2">&quot;.term.log&quot;</span>

        <span class="n">process_handle</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">cmd_to_run</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">job_handle</span> <span class="o">=</span> <span class="n">jobs</span><span class="o">.</span><span class="n">Job</span><span class="p">(</span><span class="n">run_name</span><span class="p">,</span> <span class="n">process_handle</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cmd_to_run</span> <span class="o">=</span> <span class="n">lmp_path</span> <span class="o">+</span>\
            <span class="s2">&quot; -in &quot;</span> <span class="o">+</span>\
            <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">run_name</span><span class="p">)</span> <span class="o">+</span>\
            <span class="s2">&quot;.in -echo log -log &quot;</span> <span class="o">+</span>\
            <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">run_name</span><span class="p">)</span> <span class="o">+</span>\
            <span class="s2">&quot;.log&quot;</span>
        <span class="n">job_handle</span> <span class="o">=</span> <span class="n">jobs</span><span class="o">.</span><span class="n">submit_job</span><span class="p">(</span><span class="n">run_name</span><span class="p">,</span>
                                     <span class="n">cmd_to_run</span><span class="p">,</span>
                                     <span class="n">procs</span><span class="o">=</span><span class="n">procs</span><span class="p">,</span>
                                     <span class="n">queue</span><span class="o">=</span><span class="n">queue</span><span class="p">,</span>
                                     <span class="n">additional_env_vars</span><span class="o">=</span><span class="n">sysconst</span><span class="o">.</span><span class="n">lmp_env_vars</span><span class="p">,</span>
                                     <span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">,</span>
                                     <span class="n">redundancy</span><span class="o">=</span><span class="n">redundancy</span><span class="p">,</span>
                                     <span class="n">unique_name</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                     <span class="n">preface</span><span class="o">=</span><span class="s2">&quot;mpi&quot;</span><span class="p">)</span>

    <span class="c1"># Copy run script</span>
    <span class="n">fname</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="s1">&#39;/&#39;</span> <span class="ow">in</span> <span class="n">fname</span><span class="p">:</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">fname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="s1">&#39;../../</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">fname</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="c1"># Submitted a job oddly enough that sys.argv[0] is not the original</span>
        <span class="c1"># python file name, so don&#39;t do this</span>
        <span class="k">pass</span>

    <span class="c1"># Return to the appropriate directory</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;../..&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">job_handle</span></div>


<div class="viewcode-block" id="read_TIP4P_types"><a class="viewcode-back" href="../codebase.html#lammps_job.read_TIP4P_types">[docs]</a><span class="k">def</span> <span class="nf">read_TIP4P_types</span><span class="p">(</span><span class="n">data_file</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Used to find the TIP4P water atoms, bond and angle types in the lammps</span>
<span class="sd">    data file. Returns an integer for each of the types. This method looks</span>
<span class="sd">    for particular sequences, which may not be unique under certain</span>
<span class="sd">    circumstances so it should be used with caution.</span>

<span class="sd">    **Parameters**</span>

<span class="sd">        data_file: *str*</span>
<span class="sd">            Lammps data file name.</span>

<span class="sd">    **Returns**</span>

<span class="sd">        otype: *int*</span>
<span class="sd">            The lammps atom type for TIP4P oxygen.</span>
<span class="sd">        htype: *int*</span>
<span class="sd">            The lammps atom type for TIP4P hydrogen.</span>
<span class="sd">        btype: *int*</span>
<span class="sd">            The lammps atom type for TIP4P bond.</span>
<span class="sd">        atype: *int*</span>
<span class="sd">            The lammps atom type for TIP4P angle.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">otype</span><span class="p">,</span> <span class="n">htype</span><span class="p">,</span> <span class="n">btype</span><span class="p">,</span> <span class="n">atype</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>

    <span class="c1"># Iterate file line by line. This reduces the memory required since it</span>
    <span class="c1"># only loads the current line</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">data_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="c1"># Try to parse the strings as a number</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Check for oxygen</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mf">0.162750</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.00001</span> <span class="ow">and</span>
                            <span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">-</span> <span class="mf">3.164350</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.00001</span><span class="p">):</span>
                        <span class="n">otype</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

                    <span class="c1"># Check for hydrogen</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="o">&lt;</span> <span class="mf">0.00001</span> <span class="ow">and</span>
                            <span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span> <span class="o">&lt;</span> <span class="mf">0.00001</span><span class="p">):</span>
                        <span class="n">htype</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

                    <span class="c1"># Check for TIP4P bond</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mf">7777.000000</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.00001</span> <span class="ow">and</span>
                            <span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">-</span> <span class="mf">0.957200</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.00001</span><span class="p">):</span>
                        <span class="n">btype</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

                    <span class="c1"># Check for TIP4P angle</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mf">7777.000000</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.00001</span> <span class="ow">and</span>
                            <span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">-</span> <span class="mf">104.520000</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.00001</span><span class="p">):</span>
                        <span class="n">atype</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="c1"># a[1] or a[2] is not a valid number</span>
                    <span class="k">pass</span>

            <span class="c1"># Check if all types have been found. Return values if found</span>
            <span class="k">if</span> <span class="n">otype</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">htype</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">btype</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">atype</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">otype</span><span class="p">,</span> <span class="n">htype</span><span class="p">,</span> <span class="n">btype</span><span class="p">,</span> <span class="n">atype</span></div>


<div class="viewcode-block" id="PotEngSurfaceJob"><a class="viewcode-back" href="../codebase.html#lammps_job.PotEngSurfaceJob">[docs]</a><span class="k">def</span> <span class="nf">PotEngSurfaceJob</span><span class="p">(</span><span class="n">run_name</span><span class="p">,</span> <span class="n">input_script</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">spanMolecule</span><span class="p">,</span>
                     <span class="n">resolution</span><span class="o">=.</span><span class="mi">1</span><span class="p">,</span> <span class="n">queue</span><span class="o">=</span><span class="s1">&#39;short&#39;</span><span class="p">,</span> <span class="n">procs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                     <span class="n">pair_coeffs_included</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">hybrid_pair</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                     <span class="n">floor</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    TO BE ADDED AGAIN</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="OptJob"><a class="viewcode-back" href="../codebase.html#lammps_job.OptJob">[docs]</a><span class="k">def</span> <span class="nf">OptJob</span><span class="p">(</span><span class="n">run_name</span><span class="p">,</span> <span class="n">input_script</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">spanMolecule</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=.</span><span class="mi">1</span><span class="p">,</span>
           <span class="n">queue</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">procs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">pair_coeffs_included</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
           <span class="n">hybrid_pair</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">orientations</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
           <span class="n">floor</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs a series of lammps jobs in a space defined by domain and resolution,</span>
<span class="sd">    at each position performing a rand_rotation of the spanMolecule. Runs the</span>
<span class="sd">    simulation at that position orienations many times. Each simulation line</span>
<span class="sd">    will be split over split many jobs.</span>

<span class="sd">    **Parameters**</span>

<span class="sd">        run_name: *str*</span>
<span class="sd">            Name of the simulation to be run.</span>
<span class="sd">        input_script: *str*</span>
<span class="sd">            Input script for LAMMPs simulation.</span>
<span class="sd">        system: :class:`structures.System`</span>
<span class="sd">            System object for our simulation.</span>
<span class="sd">        domain: *list, float*</span>
<span class="sd">            A list of 3 elements referring to the XYZ domain in which</span>
<span class="sd">            the molecule spanMolecule will raster across.  Ex. [0.0, 1.0, 1.0]</span>
<span class="sd">            will span over a 1x1 angstrom box in the positive y and z</span>
<span class="sd">            directions from spanMolecule&#39;s original position.</span>
<span class="sd">        spanMolecule: *str*</span>
<span class="sd">            The path to a cml file representing a molecule to be rastered</span>
<span class="sd">            across the surface.</span>
<span class="sd">        resolution: *float, optional*</span>
<span class="sd">            The change in position to be taken during rastering.</span>
<span class="sd">        queue: *str, optional*</span>
<span class="sd">            What queue to run the simulation on (queueing system dependent).</span>
<span class="sd">        procs: *int, optional*</span>
<span class="sd">            How many processors to run the simulation on.</span>
<span class="sd">        email: *str, optional*</span>
<span class="sd">            An email address for sending job information to.</span>
<span class="sd">        pair_coeffs_included: *bool, optional*</span>
<span class="sd">            Whether we have included the pair coefficients to be written to</span>
<span class="sd">            our lammps data file.</span>
<span class="sd">        hybrid_pair: *bool, optional*</span>
<span class="sd">            Whether to detect different treatments of pairing interactions</span>
<span class="sd">            amongst different atom types(True), or not (False).</span>
<span class="sd">        orientations: *int, optional*</span>
<span class="sd">            The number of random orientations to be run at every position.</span>
<span class="sd">        split: *int, optional*</span>
<span class="sd">            The number of optimizations to append to a single lammps</span>
<span class="sd">            simulation.  This is primarily used when batching jobs for</span>
<span class="sd">            the queue.</span>
<span class="sd">        floor: *list, float, optional*</span>
<span class="sd">            A position to set spanMolecule to prior to rastering.</span>

<span class="sd">    **Returns**</span>

<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">run_name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">31</span> <span class="ow">and</span> <span class="n">queue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Job name too long (</span><span class="si">%d</span><span class="s2">) for NBS. Max character </span><span class="se">\</span>
<span class="s2">length is 31.&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">run_name</span><span class="p">))</span>

    <span class="c1"># Change to correct directory</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;mkdir -p lammps/</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">run_name</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;lammps/</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">run_name</span><span class="p">)</span>

    <span class="c1"># Generate the list of positions for the molecule to be tried</span>
    <span class="n">vecList</span> <span class="o">=</span> <span class="n">_GenerateVecList</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span>
                               <span class="n">resolution</span><span class="p">,</span>
                               <span class="n">plotting</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># Find the position in the input script which declares the data file name</span>
    <span class="n">readDataIndex</span> <span class="o">=</span> <span class="n">input_script</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;read_data&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">readDataIndex</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid Input Script: no data read.&quot;</span><span class="p">)</span>
    <span class="n">dotDataIndex</span> <span class="o">=</span> <span class="n">input_script</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;.data&quot;</span><span class="p">)</span>

    <span class="c1"># If the molecule is in the system, in its original position, remove it.</span>
    <span class="k">if</span> <span class="n">system</span><span class="o">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">spanMolecule</span><span class="p">):</span>
        <span class="n">system</span><span class="o">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">spanMolecule</span><span class="p">)</span>

    <span class="n">spanMolecule</span><span class="o">.</span><span class="n">SetCenter</span><span class="p">(</span><span class="n">floor</span><span class="p">)</span>

    <span class="c1"># Pickle uses recursion.  Due to this, large class pickling leads</span>
    <span class="c1"># to crashing when recursion limit is exceeded.  This lets us actually</span>
    <span class="c1"># use pickle here.</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">setrecursionlimit</span><span class="p">(</span><span class="mi">2000</span><span class="p">)</span>
    <span class="c1"># Dump to pickle files all global objects</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;mkdir -p lammps/nbs_scripts&#39;</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;lammps/nbs_scripts&#39;</span><span class="p">)</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">system</span><span class="p">,</span>
                <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;system.pickle&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">))</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">input_script</span><span class="p">,</span>
                <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;inputscript.pickle&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">))</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">readDataIndex</span><span class="p">,</span>
                <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;readdataindex.pickle&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">))</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">dotDataIndex</span><span class="p">,</span>
                <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;dotdataindex.pickle&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">))</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">spanMolecule</span><span class="p">,</span>
                <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;spanmolecule.pickle&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">))</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">pair_coeffs_included</span><span class="p">,</span>
                <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;pair_coeffs_included.pickle&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">))</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">hybrid_pair</span><span class="p">,</span>
                <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;hybrid_pair.pickle&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">))</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">orientations</span><span class="p">,</span>
                <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;orientations.pickle&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">))</span>

    <span class="c1"># For every vector line in vecList, run a job to acquire a processor</span>
    <span class="c1"># to run it, and run a lammps job for each one.</span>
    <span class="n">vecLine</span> <span class="o">=</span> <span class="n">vecList</span>
    <span class="n">newVecs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">split</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">splitNum</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vecLine</span><span class="p">)</span> <span class="o">/</span> <span class="n">split</span>
        <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">a</span> <span class="o">+</span> <span class="n">splitNum</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">vecLine</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">newVecs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vecLine</span><span class="p">[</span><span class="n">a</span><span class="p">:</span><span class="n">a</span> <span class="o">+</span> <span class="n">splitNum</span><span class="p">])</span>
            <span class="n">a</span> <span class="o">+=</span> <span class="n">splitNum</span>
        <span class="n">newVecs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vecLine</span><span class="p">[</span><span class="n">a</span><span class="p">:])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">newVecs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vecLine</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">newVecs</span><span class="p">)):</span>
        <span class="n">lineName</span> <span class="o">=</span> <span class="n">run_name</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">vecLine</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;_sp&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="n">_OptEngLine</span><span class="p">(</span><span class="n">lineName</span><span class="p">,</span>
                    <span class="n">run_name</span><span class="p">,</span>
                    <span class="n">input_script</span><span class="p">,</span>
                    <span class="n">spanMolecule</span><span class="p">,</span>
                    <span class="n">newVecs</span><span class="p">[</span><span class="n">b</span><span class="p">],</span>
                    <span class="n">procs</span><span class="o">=</span><span class="n">procs</span><span class="p">,</span>
                    <span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_OptEngLine</span><span class="p">(</span><span class="n">lineName</span><span class="p">,</span>
                <span class="n">run_name</span><span class="p">,</span>
                <span class="n">input_script</span><span class="p">,</span>
                <span class="n">spanMolecule</span><span class="p">,</span>
                <span class="n">vecLine</span><span class="p">,</span>
                <span class="n">procs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">email</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="n">orientations</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                <span class="n">split</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A helper function to PotEngSurfaceJob_v2(). Writes a python script to be</span>
<span class="sd">    run by the ICSE servers and submits a valid NBS job to run that python</span>
<span class="sd">    script. The ICSE processor which is grabbed will then run a series of</span>
<span class="sd">    lammps runs, each of which involving translating spanMolecule by a</span>
<span class="sd">    vector in vecLine, and then resetting its position after the run.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span> <span class="s2">&quot;Running OptEngLine&quot;</span>
    <span class="n">currdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">vecLine</span><span class="p">,</span>
                <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;vec_&quot;</span> <span class="o">+</span> <span class="n">lineName</span> <span class="o">+</span> <span class="s2">&quot;.pickle&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">))</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">spanMolecule</span><span class="p">,</span>
                <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;spanMolecule_&quot;</span> <span class="o">+</span> <span class="n">lineName</span> <span class="o">+</span> <span class="s2">&quot;.pickle&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">))</span>
    <span class="n">NBS</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">lineName</span> <span class="o">+</span> <span class="s2">&quot;.nbs&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">NBStext</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;#!/bin/sh</span>
<span class="s1">##NBS-name: </span><span class="se">\&#39;</span><span class="s1">&#39;&#39;&#39;</span> <span class="o">+</span> <span class="n">lineName</span> <span class="o">+</span> <span class="s1">&#39;&#39;&#39;</span><span class="se">\&#39;</span><span class="s1"></span>
<span class="s1">##NBS-nproc: &#39;&#39;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">procs</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">##NBS-queue: short</span>
<span class="s1">##NBS-email: &#39;&#39;</span>
<span class="s1">source /fs/home/aec253/.zshrc</span>

<span class="s1"># Shared LAMMPS Library Configuration</span>
<span class="s1">export PYTHONPATH=/fs/home/yma3/Software/lammps_git/python:$PYTHONPATH</span>
<span class="s1">export PYTHONPATH=/fs/home/yma3/Projects/Forcefields/OPLS:$PYTHONPATH</span>
<span class="s1">export LD_LIBRARY_PATH=/fs/home/yma3/Software/lammps_git/src:$LD_LIBRARY_PATH</span>
<span class="s1">export LD_LIBRARY_PATH=/usr/local/mpich2/icse/lib:$LD_LIBRARY_PATH</span>
<span class="s1">export LD_LIBRARY_PATH=/fs/home/yma3/usr/local/lib/fftw3/lib:$LD_LIBRARY_PATH</span>

<span class="s1">&#39;&#39;&#39;</span> <span class="o">+</span> <span class="n">sysconst</span><span class="o">.</span><span class="n">python_path</span> <span class="o">+</span> <span class="s1">&#39;&#39;&#39; -u &#39;&#39;&#39;</span> <span class="o">+</span> <span class="n">lineName</span> <span class="o">+</span> <span class="s1">&#39;&#39;&#39;.py &gt;&gt; &#39;&#39;&#39;</span> <span class="o">+</span> <span class="n">lineName</span> <span class="o">+</span> <span class="s1">&#39;&#39;&#39;.log 2&gt;&amp;1</span>
<span class="s1">&#39;&#39;&#39;</span>
    <span class="n">NBS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">NBStext</span><span class="p">)</span>
    <span class="n">NBS</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">pyScript</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">lineName</span> <span class="o">+</span> <span class="s1">&#39;.py&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">pyScriptText</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;from lammps_job import job</span>
<span class="s1">import cPickle as pickle</span>
<span class="s1">import os</span>
<span class="s1">from merlin import *</span>
<span class="s1">os.chdir(</span><span class="se">\&#39;</span><span class="s1">&#39;&#39;&#39;</span> <span class="o">+</span> <span class="n">currdir</span> <span class="o">+</span> <span class="s1">&#39;&#39;&#39;</span><span class="se">\&#39;</span><span class="s1">)</span>

<span class="s1">run_name = &quot;&#39;&#39;&#39;</span> <span class="o">+</span> <span class="n">run_name</span> <span class="o">+</span> <span class="s1">&#39;&#39;&#39;&quot;</span>
<span class="s1">system = pickle.load(open(&quot;system.pickle&quot;,&quot;rb&quot;))</span>
<span class="s1">vecLine = pickle.load(open(&quot;vec_&quot;+&quot;&#39;&#39;&#39;</span> <span class="o">+</span> <span class="n">lineName</span> <span class="o">+</span> <span class="s1">&#39;&#39;&#39;.pickle&quot;,&quot;rb&quot;))</span>
<span class="s1">input_script = pickle.load(open(&quot;inputscript.pickle&quot;,&quot;rb&quot;))</span>
<span class="s1">readDataIndex = pickle.load(open(&quot;readdataindex.pickle&quot;,&quot;rb&quot;))</span>
<span class="s1">dotDataIndex = pickle.load(open(&quot;dotdataindex.pickle&quot;,&quot;rb&quot;))</span>
<span class="s1">spanMolecule = pickle.load(open(&quot;spanmolecule.pickle&quot;,&quot;rb&quot;))</span>
<span class="s1">pair_coeffs_included = pickle.load(open(&quot;pair_coeffs_included.pickle&quot;,&quot;rb&quot;))</span>
<span class="s1">hybrid_pair = pickle.load(open(&quot;hybrid_pair.pickle&quot;,&quot;rb&quot;))</span>
<span class="s1">orientations = pickle.load(open(&quot;orientations.pickle&quot;,&quot;rb&quot;))</span>


<span class="s1">os.chdir(&quot;..&quot;)</span>
<span class="s1">os.chdir(&quot;..&quot;)</span>
<span class="s1">spanLog = open(&quot;lammps/nbs_scripts/spanLog.txt&quot;,&quot;w&quot;)</span>
<span class="s1">for vec in vecLine:</span>
<span class="s1">    for a in range(orientations):</span>
<span class="s1">        spanLog.write(str(vec)+&quot;at orientation &quot;+str(a)+&quot;</span><span class="se">\\</span><span class="s1">n&quot;)</span>
<span class="s1">        newRunName = run_name +</span><span class="se">\</span>
<span class="s1">                     &quot;_&quot; +</span><span class="se">\</span>
<span class="s1">                     str(vec[0])+</span><span class="se">\</span>
<span class="s1">                     &quot;x&quot; +</span><span class="se">\</span>
<span class="s1">                     str(vec[1]) +</span><span class="se">\</span>
<span class="s1">                     &quot;x&quot; +</span><span class="se">\</span>
<span class="s1">                     (str(vec[2]) +</span><span class="se">\</span>
<span class="s1">                     &quot;_&quot; + str(a))</span>
<span class="s1">        system.name = newRunName</span>
<span class="s1">        spanLog.write(&quot;Pre-Translated at &quot;+`vec`+&quot;: &quot;+`spanMolecule`+&quot;</span><span class="se">\\</span><span class="s1">n&quot;)</span>
<span class="s1">        spanMolecule.randRotateInPlace()</span>
<span class="s1">        newInputScript = input_script[:readDataIndex+10] + newRunName +</span><span class="se">\</span>
<span class="s1">                         input_script[dotDataIndex:]</span>
<span class="s1">        spanMolecule.translate(vec)</span>
<span class="s1">        spanLog.write(&quot;Post-Translated at &quot;+`vec`+&quot;: &quot;+`spanMolecule`+&quot;</span><span class="se">\\</span><span class="s1">n&quot;)</span>
<span class="s1">        system.add(spanMolecule)</span>
<span class="s1">        print &quot;Running job &quot; + newRunName</span>
<span class="s1">        job(newRunName, newInputScript, system,</span>
<span class="s1">            pair_coeffs_included=pair_coeffs_included, hybrid_pair=hybrid_pair,</span>
<span class="s1">            hybrid_angle=False)</span>
<span class="s1">        system.Remove(spanMolecule)</span>
<span class="s1">        spanMolecule.translate([-vec[0],-vec[1],-vec[2]])</span>
<span class="s1">        #if vecLine.index(vec)&gt;5:</span>
<span class="s1">            #break</span>
<span class="s1">spanLog.close()&#39;&#39;&#39;</span>

    <span class="n">pyScript</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pyScriptText</span><span class="p">)</span>
    <span class="n">pyScript</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;jsub &quot;</span> <span class="o">+</span> <span class="n">lineName</span> <span class="o">+</span> <span class="s2">&quot;.nbs&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_GenerateVecList</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span>
                     <span class="n">resolution</span><span class="p">,</span>
                     <span class="n">plotting</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="n">assortBy</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A helper-function to generate a 2D-list of all translate vectors</span>
<span class="sd">    which should be tried by PotEngSurfaceJob. domain is an domain</span>
<span class="sd">    over which to be spanned (square prismatically) and resolution is</span>
<span class="sd">    the resolution at which the domain should be spanned.</span>
<span class="sd">    If plotting a 2d surface using this method, set plotting to True</span>
<span class="sd">    and the result will be a 3d-list, the outer of whihch will hold</span>
<span class="sd">    individual column&#39;s data.</span>
<span class="sd">    Precondition:</span>
<span class="sd">    domain must be a 3-element list of ints or floats,</span>
<span class="sd">    and resolution must be a positive int or float.</span>
<span class="sd">    plotting is a bool, or is not passed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Initialize position lists</span>
    <span class="n">xList</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
    <span class="n">yList</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
    <span class="n">zList</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
    <span class="n">vecList</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Fill position lists with multiples of resolution up to the</span>
    <span class="c1"># maximum domain size</span>
    <span class="k">while</span> <span class="nb">abs</span><span class="p">(</span><span class="n">xList</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">resolution</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">domain</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">xList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xList</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">resolution</span><span class="p">)</span>
    <span class="k">while</span> <span class="nb">abs</span><span class="p">(</span><span class="n">yList</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">resolution</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">domain</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">yList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yList</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">resolution</span><span class="p">)</span>
    <span class="k">while</span> <span class="nb">abs</span><span class="p">(</span><span class="n">zList</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">resolution</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">domain</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
        <span class="n">zList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">zList</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">resolution</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">plotting</span><span class="p">:</span>
        <span class="c1"># Loop through all elements of all lists and add all of these</span>
        <span class="c1"># points to posList</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xList</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">yList</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">zList</span><span class="p">:</span>
                    <span class="n">vecList</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">assortBy</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xList</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">yList</span><span class="p">:</span>
                <span class="n">addList</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">zList</span><span class="p">:</span>
                    <span class="n">addList</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">])</span>
                <span class="n">vecList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">addList</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">assortBy</span> <span class="o">==</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">zList</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xList</span><span class="p">:</span>
                <span class="n">addList</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">yList</span><span class="p">:</span>
                    <span class="n">addList</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">])</span>
                <span class="n">vecList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">addList</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">assortBy</span> <span class="o">==</span> <span class="s1">&#39;z&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">yList</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">zList</span><span class="p">:</span>
                <span class="n">addList</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xList</span><span class="p">:</span>
                    <span class="n">addList</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">])</span>
                <span class="n">vecList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">addList</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">vecList</span>


<span class="c1"># A function to extract thermo output from lammps log files</span>
<span class="c1"># Automatically removes duplicate timesteps</span>
<span class="c1"># Adapted from log2txt.py from the lammps distribution</span>
<span class="c1"># Syntax:  log_file output_file X Y ...</span>
<span class="c1">#          log_file = LAMMPS log file</span>
<span class="c1">#          output_file = text file to create</span>
<span class="c1">#          X Y ... = columns to include (optional), X,Y are thermo keywords</span>
<span class="c1">#                    if no columns listed, all columns are included</span>
<span class="c1"># Author:  Steve Plimpton (Sandia), sjplimp at sandia.gov</span>
<span class="c1"># Modified by Yaset Acevedo to use updated log.py included in clancelot</span>
<div class="viewcode-block" id="thermo_2_text"><a class="viewcode-back" href="../codebase.html#lammps_job.thermo_2_text">[docs]</a><span class="k">def</span> <span class="nf">thermo_2_text</span><span class="p">(</span><span class="n">run_name</span><span class="p">,</span> <span class="o">*</span><span class="n">properties</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This will convert a lammps .log file to a parsed .txt file, isolating</span>
<span class="sd">    the thermo output.</span>

<span class="sd">    **Parameters**</span>

<span class="sd">        run_name: *str*</span>
<span class="sd">            Lammps .log file to be parsed.  Note, this is WITHOUT the</span>
<span class="sd">            extension (ex. test_lmp instead of test_lmp.log).</span>
<span class="sd">        properties: *str*</span>
<span class="sd">            A sequence of lammps thermo keywords to minimize output .txt file.</span>

<span class="sd">    **Example**</span>

<span class="sd">        &gt;&gt;&gt; thermo_2_text(&quot;test_run&quot;, &quot;Time&quot;, &quot;KE&quot;)</span>

<span class="sd">    **Returns**</span>

<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Format log_file as needed</span>
    <span class="n">log_file</span> <span class="o">=</span> <span class="s1">&#39;lammps/</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">.log&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">run_name</span><span class="p">,</span> <span class="n">run_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">log_file</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;No log file </span><span class="si">%s</span><span class="s2"> exists in </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">log_file</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()))</span>

    <span class="c1"># Format output file name</span>
    <span class="n">output_file</span> <span class="o">=</span> <span class="s1">&#39;lammps/</span><span class="si">%s</span><span class="s1">/thermo.txt&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">run_name</span><span class="p">)</span>

    <span class="c1"># Import log file</span>
    <span class="n">lg</span> <span class="o">=</span> <span class="n">lammps_log</span><span class="p">(</span><span class="n">log_file</span><span class="p">)</span>

    <span class="c1"># If no properties specified, print out all properties</span>
    <span class="k">if</span> <span class="n">properties</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">lg</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>

    <span class="c1"># Only print out selected properties</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;lg.write(output_file,&quot;</span>
        <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">:</span>
            <span class="nb">str</span> <span class="o">+=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">word</span> <span class="o">+</span> <span class="s1">&#39;&quot;,&#39;</span>
        <span class="nb">str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
        <span class="nb">eval</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span></div>


<span class="c1"># A function to return thermo output from lammps log files</span>
<div class="viewcode-block" id="read_thermo"><a class="viewcode-back" href="../codebase.html#lammps_job.read_thermo">[docs]</a><span class="k">def</span> <span class="nf">read_thermo</span><span class="p">(</span><span class="n">run_name</span><span class="p">,</span> <span class="o">*</span><span class="n">properties</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read in thermo output from a lammps log file.</span>

<span class="sd">    **Parameters**</span>

<span class="sd">        run_name: *str*</span>
<span class="sd">            Lammps .log file to be parsed.  Note, this is WITHOUT the</span>
<span class="sd">            extension (ex. test_lmp instead of test_lmp.log).</span>
<span class="sd">        properties: *str*</span>
<span class="sd">            A sequence of lammps thermo keywords to be parsed, only used</span>
<span class="sd">            when all is not required.</span>

<span class="sd">    **Returns**</span>

<span class="sd">        lj: :class:`lammps_log`</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Format log_file as needed</span>
    <span class="n">log_file</span> <span class="o">=</span> <span class="s1">&#39;lammps/</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">.log&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">run_name</span><span class="p">,</span> <span class="n">run_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">log_file</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;No log file </span><span class="si">%s</span><span class="s2"> exists in </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">log_file</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()))</span>

    <span class="c1"># Import log file</span>
    <span class="n">lg</span> <span class="o">=</span> <span class="n">lammps_log</span><span class="p">(</span><span class="n">log_file</span><span class="p">)</span>
    <span class="c1"># lg.last_modified = files.last_modified(log_path)</span>

    <span class="c1"># Print all property names</span>
    <span class="n">names</span> <span class="o">=</span> <span class="n">lg</span><span class="o">.</span><span class="n">names</span>
    <span class="n">txt</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">lg</span></div>


<div class="viewcode-block" id="lmp_task"><a class="viewcode-back" href="../codebase.html#lammps_job.lmp_task">[docs]</a><span class="k">class</span> <span class="nc">lmp_task</span><span class="p">(</span><span class="n">_jtask</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The LAMMPs task object for JOUST.  This allows for the automation of some</span>
<span class="sd">    workflows.</span>

<span class="sd">    **Parameters**</span>

<span class="sd">        task_name: *str*</span>
<span class="sd">            The name of this task.</span>
<span class="sd">        system: :class:`structures.System`</span>
<span class="sd">            A system object to be used for this simulation.</span>
<span class="sd">        queue: *str, optional*</span>
<span class="sd">            Queue you are submitting to (queueing system dependent).</span>
<span class="sd">        procs: *int, optional*</span>
<span class="sd">            Number of processors requested.</span>
<span class="sd">        mem: *float, optional*</span>
<span class="sd">            Amount of memory you&#39;re requesting.</span>
<span class="sd">        priority: *int, optional*</span>
<span class="sd">            Priority of the simulation (queueing system dependent).  Priority</span>
<span class="sd">            ranges (in NBS) from a low of 1 (start running whenever) to a</span>
<span class="sd">            high of 255 (start running ASAP).</span>
<span class="sd">        xhosts: *list, str or str, optional*</span>
<span class="sd">            Which processors you want to run the job on.</span>
<span class="sd">        callback: *func, optional*</span>
<span class="sd">            A function to be run at the end of the task (only if conditional</span>
<span class="sd">            is not met).</span>

<span class="sd">    **Returns**</span>

<span class="sd">        task: *task*</span>
<span class="sd">            This task object.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="lmp_task.run"><a class="viewcode-back" href="../codebase.html#lammps_job.lmp_task.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Start the LAMMPs simulation specified by this task.</span>

<span class="sd">        **Returns**</span>

<span class="sd">            sim_handle: :class:`jobs.Job`</span>
<span class="sd">                A Job container for the simulation that was submitted.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">job</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_name</span><span class="p">,</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">input_script</span><span class="p">,</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="p">,</span>
                   <span class="n">queue</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="p">,</span>
                   <span class="n">procs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">procs</span><span class="p">,</span>
                   <span class="n">email</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">email</span><span class="p">,</span>
                   <span class="n">pair_coeffs_included</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pair_coeffs_included</span><span class="p">,</span>
                   <span class="n">hybrid_pair</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hybrid_pair</span><span class="p">,</span>
                   <span class="n">hybrid_angle</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hybrid_angle</span><span class="p">,</span>
                   <span class="n">no_echo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">no_echo</span><span class="p">)</span></div>

<div class="viewcode-block" id="lmp_task.set_parameters"><a class="viewcode-back" href="../codebase.html#lammps_job.lmp_task.set_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">set_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_script</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">pair_coeffs_included</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">hybrid_pair</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                       <span class="n">hybrid_angle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">trj_file</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">xyz_file</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                       <span class="n">read_atoms</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">read_timesteps</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                       <span class="n">read_num_atoms</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">read_box_bounds</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set parameters for the LAMMPs task.</span>

<span class="sd">        **Parameters**</span>

<span class="sd">            input_script: *str*</span>
<span class="sd">                Input script for LAMMPs simulation.</span>
<span class="sd">            email: *str, optional*</span>
<span class="sd">                An email address for sending job information to.</span>
<span class="sd">            pair_coeffs_included: *bool, optional*</span>
<span class="sd">                Whether we have included the pair coefficients to be written</span>
<span class="sd">                to our lammps data file.</span>
<span class="sd">            hybrid_pair: *bool, optional*</span>
<span class="sd">                Whether to detect different treatments of pairing interactions</span>
<span class="sd">                amongs different atom types(True), or not (False).</span>
<span class="sd">            hybrid_angle: *bool, optional*</span>
<span class="sd">                Whether to detect different treatments of angles amongst</span>
<span class="sd">                different atom types (True), or not (False).</span>
<span class="sd">            trj_file: *str, optional*</span>
<span class="sd">                Pass the path to a lammps trajectory file.  Relative paths</span>
<span class="sd">                are assumed to be in a</span>
<span class="sd">                subfolder &quot;lammps/RUN_NAME/RUN_NAME.lammpstrj&quot;.</span>
<span class="sd">            read_atoms: *bool, optional*</span>
<span class="sd">                Whether to read in the atom information.</span>
<span class="sd">            read_timesteps: *bool, optional*</span>
<span class="sd">                Whether to read in the timesteps (True), or not (False).</span>
<span class="sd">            read_num_atoms: *bool, optional*</span>
<span class="sd">                Whether to read in the number of atoms (True), or not (False).</span>
<span class="sd">            read_box_bounds: *bool, optional*</span>
<span class="sd">                Whether to read in the system box boundaries (True), or</span>
<span class="sd">                not (False).</span>

<span class="sd">        **Returns**</span>

<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_script</span> <span class="o">=</span> <span class="n">input_script</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">email</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pair_coeffs_included</span> <span class="o">=</span> <span class="n">pair_coeffs_included</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hybrid_pair</span> <span class="o">=</span> <span class="n">hybrid_pair</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hybrid_angle</span> <span class="o">=</span> <span class="n">hybrid_angle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trj_file</span> <span class="o">=</span> <span class="n">trj_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xyz_file</span> <span class="o">=</span> <span class="n">xyz_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_atoms</span> <span class="o">=</span> <span class="n">read_atoms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_timesteps</span> <span class="o">=</span> <span class="n">read_timesteps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_num_atoms</span> <span class="o">=</span> <span class="n">read_num_atoms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_box_bounds</span> <span class="o">=</span> <span class="n">read_box_bounds</span></div>

<div class="viewcode-block" id="lmp_task.read_results"><a class="viewcode-back" href="../codebase.html#lammps_job.lmp_task.read_results">[docs]</a>    <span class="k">def</span> <span class="nf">read_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse the output of the simulation that was just run.</span>

<span class="sd">        ** Returns**</span>

<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_name</span><span class="p">,</span> <span class="n">trj_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trj_file</span><span class="p">,</span>
                         <span class="n">xyz_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xyz_file</span><span class="p">,</span>
                         <span class="n">read_atoms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_atoms</span><span class="p">,</span>
                         <span class="n">read_timesteps</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_timesteps</span><span class="p">,</span>
                         <span class="n">read_num_atoms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_num_atoms</span><span class="p">,</span>
                         <span class="n">read_box_bounds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_box_bounds</span><span class="p">)</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../squid.html">Squid</a></li>
<li class="toctree-l1"><a class="reference internal" href="../codebase.html">Codebase</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Squid 0.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Henry Herbol.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.6.
    </div>
  </body>
</html>