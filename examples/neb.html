
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Nudged Elastic Band Demo &#8212; Squid 2.0.0 documentation</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Squid 2.0.0 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="nudged-elastic-band-demo">
<h1>Nudged Elastic Band Demo<a class="headerlink" href="#nudged-elastic-band-demo" title="Permalink to this headline">Â¶</a></h1>
<p>The below code shows how one can generate a reaction pathway, and ultimately run NEB on it to find the minimum energy pathway (MEP).  Note, the endpoints and NEB should use the same DFT level of theory, otherwise your endpoints may not remain local minima within the potential energy surface.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">squid</span> <span class="kn">import</span> <span class="n">orca</span>
<span class="kn">from</span> <span class="nn">squid</span> <span class="kn">import</span> <span class="n">files</span>
<span class="kn">from</span> <span class="nn">squid</span> <span class="kn">import</span> <span class="n">geometry</span>
<span class="kn">from</span> <span class="nn">squid.calcs</span> <span class="kn">import</span> <span class="n">NEB</span>
<span class="kn">from</span> <span class="nn">squid</span> <span class="kn">import</span> <span class="n">structures</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c1"># In this example we will generate the full CNH-HCN isomerization using</span>
    <span class="c1"># only squid.  Then we optimize the endpoints in DFT, smooth the frames,</span>
    <span class="c1"># and subsequently run NEB</span>

    <span class="c1"># Step 1 - Generate the bad initial guess</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Step 1 - Generate the bad initial guess...&quot;</span><span class="p">)</span>
    <span class="n">H_coords</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>
    <span class="n">CNH_frames</span> <span class="o">=</span> <span class="p">[[</span>
        <span class="n">structures</span><span class="o">.</span><span class="n">Atom</span><span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">structures</span><span class="o">.</span><span class="n">Atom</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">structures</span><span class="o">.</span><span class="n">Atom</span><span class="p">(</span><span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">H_coords</span>
    <span class="p">]</span>
    <span class="c1"># Save initial frames</span>
    <span class="n">files</span><span class="o">.</span><span class="n">write_xyz</span><span class="p">(</span><span class="n">CNH_frames</span><span class="p">,</span> <span class="s2">&quot;bad_guess.xyz&quot;</span><span class="p">)</span>

    <span class="c1"># Step 2 - Optimize the endpoints</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Step 2 - Optimize endpoints...&quot;</span><span class="p">)</span>
    <span class="n">frame_start_job</span> <span class="o">=</span> <span class="n">orca</span><span class="o">.</span><span class="n">job</span><span class="p">(</span>
        <span class="s2">&quot;frame_start&quot;</span><span class="p">,</span> <span class="s2">&quot;! HF-3c Opt&quot;</span><span class="p">,</span> <span class="n">atoms</span><span class="o">=</span><span class="n">CNH_frames</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">queue</span><span class="o">=</span><span class="bp">None</span>
    <span class="p">)</span>
    <span class="n">frame_last_job</span> <span class="o">=</span> <span class="n">orca</span><span class="o">.</span><span class="n">job</span><span class="p">(</span>
        <span class="s2">&quot;frame_last&quot;</span><span class="p">,</span> <span class="s2">&quot;! HF-3c Opt&quot;</span><span class="p">,</span> <span class="n">atoms</span><span class="o">=</span><span class="n">CNH_frames</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">queue</span><span class="o">=</span><span class="bp">None</span>
    <span class="p">)</span>
    <span class="c1"># Wait</span>
    <span class="n">frame_start_job</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
    <span class="n">frame_last_job</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

    <span class="c1"># Step 3 - Read in the final coordiantes, and update the band</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Step 3 - Store better endpoints...&quot;</span><span class="p">)</span>
    <span class="n">CNH_frames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">orca</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;frame_start&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">atoms</span>
    <span class="n">CNH_frames</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">orca</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;frame_last&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">atoms</span>
    <span class="c1"># Save better endpoints</span>
    <span class="n">files</span><span class="o">.</span><span class="n">write_xyz</span><span class="p">(</span><span class="n">CNH_frames</span><span class="p">,</span> <span class="s2">&quot;better_guess.xyz&quot;</span><span class="p">)</span>

    <span class="c1"># Step 4 - Smooth out the band to 10 frames</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Step 4 - Smooth out the band...&quot;</span><span class="p">)</span>
    <span class="n">CNH_frames</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">smooth_xyz</span><span class="p">(</span>
        <span class="n">CNH_frames</span><span class="p">,</span> <span class="n">N_frames</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">use_procrustes</span><span class="o">=</span><span class="bp">True</span>
    <span class="p">)</span>
    <span class="c1"># Save smoothed band</span>
    <span class="n">files</span><span class="o">.</span><span class="n">write_xyz</span><span class="p">(</span><span class="n">CNH_frames</span><span class="p">,</span> <span class="s2">&quot;smoothed_guess.xyz&quot;</span><span class="p">)</span>

    <span class="c1"># Step 5 - Run NEB</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Step 5 - Run NEB...&quot;</span><span class="p">)</span>
    <span class="n">neb_handle</span> <span class="o">=</span> <span class="n">NEB</span><span class="p">(</span>
        <span class="s2">&quot;CNH&quot;</span><span class="p">,</span> <span class="n">CNH_frames</span><span class="p">,</span> <span class="s2">&quot;! HF-3c&quot;</span><span class="p">,</span>
        <span class="n">procs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">queue</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ci_neb</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">CNH_frames</span> <span class="o">=</span> <span class="n">neb_handle</span><span class="o">.</span><span class="n">optimize</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># Save final band</span>
    <span class="n">files</span><span class="o">.</span><span class="n">write_xyz</span><span class="p">(</span><span class="n">CNH_frames</span><span class="p">,</span> <span class="s2">&quot;final.xyz&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Example output is as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>------------------------------------------------------------------------------------------
Run_Name = CNH
DFT Package = orca
Spring Constant for NEB: 0.00367453 Ha/Ang = 0.1 eV/Ang
Running Climbing Image, starting at iteration 5

Running neb with optimization method LBFGS
        step_size = 1
        step_size_adjustment = 0.5
        max_step = 0.04
        Using numerical optimization starting hessian approximation.
        Will reset stored parameters and gradients when stepped bad.
        Will reset step_size after 20 good steps.
        Will accelerate step_size after 20 good steps.
        Will use procrustes to remove rigid rotations and translations
Convergence Criteria:
        g_rms = 0.001 (Ha/Ang) = 0.0272144 (eV/Ang)
        g_max = 0.001 (Ha/Ang) = 0.0272144 (eV/Ang)
        maxiter = 1000
---------------------------------------------
Step    RMS_F (eV/Ang)  MAX_F (eV/Ang)  MAX_E (kT_300)  Energies (kT_300)
----
0       29.3377         43.5945         223.9           -92.232 + 209.7 201.3 215.5 215.5 223.9 166.9 147.0 147.0 -24.8
1       17.6454         30.5193         180.9           -92.232 + 131.0 103.4 180.9 141.9 160.8  87.5  82.3  85.4 -24.8
2       16.7374         28.5847         172.2           -92.232 + 126.9  99.1 172.2 137.6 157.3  84.4  79.1  81.9 -24.8
3       9.4617          14.7017         130.7           -92.232 +  94.2  67.9 111.6 107.4 130.7  62.6  54.4  55.6 -24.8
4       8.8876          14.0481         128.4           -92.232 +  90.8  65.3 108.5 105.3 128.4  61.1  51.9  53.9 -24.8
5       5.2199          9.3786          113.3           -92.232 +  62.7  48.6  90.5  92.7 113.3  52.3  31.6  46.2 -24.8
6       4.7052          8.7159          111.4           -92.232 +  56.6  46.6  87.3  91.3 111.4  51.5  27.0  44.8 -24.8
7       3.3773          6.7696          109.1           -92.232 +  36.6  42.5  80.3  88.9 109.1  50.3  12.0  40.9 -24.8
8       2.6741          5.0084          109.0           -92.232 +  22.4  41.4  78.7  88.5 109.0  50.2   0.2  37.7 -24.8
9       2.0768          3.5014          110.2           -92.232 +  11.7  41.3  78.1  88.8 110.2  50.3 -10.0  34.1 -24.8
10      1.1286          2.9791          112.4           -92.232 +   8.6  40.5  76.3  88.8 112.4  50.2 -16.0  26.9 -24.8
11      0.8364          2.6607          113.2           -92.232 +   8.1  40.5  76.1  89.0 113.2  50.3 -17.1  24.5 -24.8
12      0.5762          1.2051          114.7           -92.232 +   8.1  40.4  75.9  89.5 114.7  50.5 -17.7  21.3 -24.8
13      0.4408          0.797           115.6           -92.232 +   7.7  40.4  75.8  89.7 115.6  50.6 -18.1  21.2 -24.8
14      0.9462          2.1528          116.2           -92.232 +   7.9  40.5  75.9  89.7 116.2  51.0 -17.7  20.6 -24.8
15      0.5642          1.2538          116.3           -92.232 +   7.8  40.4  75.7  89.7 116.3  50.4 -17.8  20.5 -24.8
16      1.3633          3.5182          116.2           -92.232 +   7.7  40.6  75.9  90.1 116.2  50.4 -17.8  20.7 -24.8
17      0.8048          1.859           116.4           -92.232 +   8.0  40.5  75.2  89.8 116.4  50.5 -17.8  18.6 -24.8
18      2.0416          5.3815          116.3           -92.232 +  10.5  40.7  75.1  90.3 116.3  51.9 -17.7  17.1 -24.8
19      1.8103          6.4053          116.4           -92.232 +  12.7  40.6  74.8  89.3 116.4  49.7 -16.9  14.8 -24.8
20      1.652           5.8429          116.4           -92.232 +  11.9  40.6  74.8  89.3 116.4  49.7 -17.0  14.8 -24.8
21      0.1428          0.3475          116.3           -92.232 +   7.7  40.5  74.7  89.7 116.3  49.9 -17.9  15.5 -24.8
22      0.0558          0.1432          116.3           -92.232 +   7.7  40.5  74.7  89.7 116.3  49.9 -17.9  15.5 -24.8
23      0.0377          0.1146          116.3           -92.232 +   7.7  40.5  74.7  89.8 116.3  49.9 -17.9  15.5 -24.8
24      0.0229          0.0525          116.3           -92.232 +   7.7  40.5  74.7  89.8 116.3  49.9 -17.9  15.4 -24.8

NEB converged the RMS force.
------------------------------------------------------------------------------------------
</pre></div>
</div>
<p>TODO - THIS IS OLD DOCUMENTATION, UPDATE GRAPH!</p>
<p>With the following graph made using:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>scanDFT neb_test-^-%d 1 10 -neb neb_test-0-0,neb_test-0-11 -c ^,0,34 -t &quot;NEB of CNH Isomerization&quot; -lx &quot;Reaction Coordinate&quot; -ly &quot;Energy (kT_300)&quot; -u kT_300
</pre></div>
</div>
<img alt="../_images/zoomed_plot_scaled.png" src="../_images/zoomed_plot_scaled.png" />
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../index.html">Table of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../squid.html">Squid</a></li>
<li class="toctree-l1"><a class="reference internal" href="../codebase.html">Codebase</a></li>
<li class="toctree-l1"><a class="reference internal" href="../console_scripts.html">Console Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a></li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/examples/neb.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Squid 2.0.0 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Henry Herbol.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
  </body>
</html>